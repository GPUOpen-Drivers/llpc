; NOTE: Assertions have been autogenerated by utils/update_test_checks.py UTC_ARGS: --tool cross-module-inline --version 3
; RUN: cross-module-inline %s %S/inc/link-existing-global-name.ll --link inline_fun | FileCheck %s
;
; Link multiple times and check that the global is copied over only once, even if it is renamed.

@glob = external global float

declare i32 @inline_fun()

define i32 @main() {
; CHECK-LABEL: define i32 @main() {
; CHECK-NEXT:    [[RESULT_I2:%.*]] = load i32, ptr @"glob.cloned.{{.*}}", align 4
; CHECK-NEXT:    [[RESULT_I1:%.*]] = load i32, ptr @"glob.cloned.{{.*}}", align 4
; CHECK-NEXT:    [[RESULT_I:%.*]] = load i32, ptr @"glob.cloned.{{.*}}", align 4
; CHECK-NEXT:    [[A:%.*]] = add i32 [[RESULT_I2]], [[RESULT_I1]]
; CHECK-NEXT:    [[B:%.*]] = add i32 [[A]], [[RESULT_I]]
; CHECK-NEXT:    ret i32 [[B]]
;
  %result = call i32 @inline_fun()
  %result2 = call i32 @inline_fun()
  %result3 = call i32 @inline_fun()

  %a = add i32 %result, %result2
  %b = add i32 %a, %result3
  ret i32 %b
}
