; NOTE: Assertions have been autogenerated by tool/update_llpc_test_checks.py UTC_ARGS: --tool lgc --check-pal-metadata
; RUN: lgc -o - --mcpu=gfx1100 -filetype=asm %s | FileCheck -check-prefixes=CHECK %s

define spir_func float @fn(float %value, i32 %index) !lgc.shaderstage !0 {
.entry:
  %r = call float (...) @lgc.create.subgroup.shuffle.f32(float %value, i32 %index)
  ret float %r
}

declare float @lgc.create.subgroup.shuffle.f32(...)

; ShaderStageCompute
!0 = !{i32 7}

; Setting Threadgroup Dimensions to 64 x 1 x 1
!llpc.compute.mode = !{!1}
!1 = !{i32 64, i32 1, i32 1}

; CHECK-LABEL: fn:
; CHECK:         s_waitcnt vmcnt(0) expcnt(0) lgkmcnt(0)
; CHECK-NEXT:    s_waitcnt_vscnt null, 0x0
; CHECK-NEXT:    v_lshlrev_b32_e32 v2, 2, v1
; CHECK-NEXT:    v_permlane64_b32 v3, v0
; CHECK-NEXT:    v_mbcnt_lo_u32_b32 v4, -1, 0
; CHECK-NEXT:    ds_bpermute_b32 v0, v2, v0
; CHECK-NEXT:    ds_bpermute_b32 v2, v2, v3
; CHECK-NEXT:    v_mbcnt_hi_u32_b32 v3, -1, v4
; CHECK-NEXT:    s_delay_alu instid0(VALU_DEP_1) | instskip(NEXT) | instid1(VALU_DEP_1)
; CHECK-NEXT:    v_xor_b32_e32 v1, v3, v1
; CHECK-NEXT:    v_and_b32_e32 v1, 32, v1
; CHECK-NEXT:    s_delay_alu instid0(VALU_DEP_1)
; CHECK-NEXT:    v_cmp_eq_u32_e32 vcc, 0, v1
; CHECK-NEXT:    s_waitcnt lgkmcnt(0)
; CHECK-NEXT:    v_cndmask_b32_e32 v0, v2, v0, vcc
; CHECK-NEXT:    s_setpc_b64 s[30:31]
;
; CHECK-LABEL: .amdgpu_pal_metadata
; CHECK-NEXT: ---
; CHECK-NEXT: amdpal.pipelines:
; CHECK-NEXT:   - .api:            !str ''
; CHECK-NEXT:     .hardware_stages:
; CHECK-NEXT:       .cs:
; CHECK-NEXT:         .sgpr_limit:     0x6a
; CHECK-NEXT:         .threadgroup_dimensions:
; CHECK-NEXT:           - 0x40
; CHECK-NEXT:           - 0x1
; CHECK-NEXT:           - 0x1
; CHECK-NEXT:         .vgpr_limit:     0x100
; CHECK-NEXT:         .wavefront_size: 0x40
; CHECK-NEXT:     .internal_pipeline_hash:
; CHECK-NEXT:       - 0
; CHECK-NEXT:       - 0
; CHECK-NEXT:     .registers:
; CHECK-NEXT:       0x2e07 (COMPUTE_NUM_THREAD_X): 0x40
; CHECK-NEXT:       0x2e08 (COMPUTE_NUM_THREAD_Y): 0x1
; CHECK-NEXT:       0x2e09 (COMPUTE_NUM_THREAD_Z): 0x1
; CHECK-NEXT:       0x2e12 (COMPUTE_PGM_RSRC1): 0x40ac0101
; CHECK-NEXT:       0x2e13 (COMPUTE_PGM_RSRC2): 0x7a0
; CHECK-NEXT:       0x2e28 (COMPUTE_PGM_RSRC3): 0
; CHECK-NEXT:       0x2e2a (COMPUTE_SHADER_CHKSUM): 0
; CHECK-NEXT:       0x2e40 (COMPUTE_USER_DATA_0): 0x10000000
; CHECK-NEXT:       0x2e42 (COMPUTE_USER_DATA_2): 0x10000006
; CHECK-NEXT:       0x2e4f (COMPUTE_USER_DATA_15): 0x10000002
; CHECK-NEXT:     .shader_functions:
; CHECK-NEXT:       fn:
; CHECK-NEXT:         .lds_size:       0
; CHECK-NEXT:         .sgpr_count:     0x22
; CHECK-NEXT:         .stack_frame_size_in_bytes: 0
; CHECK-NEXT:         .vgpr_count:     0x5
; CHECK-NEXT:     .shaders:
; CHECK-NEXT:       .compute:
; CHECK-NEXT:         .api_shader_hash:
; CHECK-NEXT:           - 0
; CHECK-NEXT:           - 0
; CHECK-NEXT:         .hardware_mapping:
; CHECK-NEXT:           - .cs
; CHECK-NEXT:     .spill_threshold: 0xffffffff
; CHECK-NEXT:     .type:           Cs
; CHECK-NEXT:     .user_data_limit: 0
; CHECK-NEXT: amdpal.version:
; CHECK-NEXT:   - 0x2
; CHECK-NEXT:   - 0x6
; CHECK-NEXT: ...
