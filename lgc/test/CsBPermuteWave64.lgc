; NOTE: Assertions have been autogenerated by tool/update_llpc_test_checks.py UTC_ARGS: --tool lgc
; RUN: lgc -o - --mcpu=gfx1100 -filetype=asm %s | FileCheck -check-prefixes=CHECK %s

define spir_func float @fn(float %value, i32 %index) !lgc.shaderstage !0 {
.entry:
  %r = call float (...) @lgc.create.subgroup.shuffle.f32(float %value, i32 %index)
  ret float %r
}

declare float @lgc.create.subgroup.shuffle.f32(...)

; ShaderStage::Compute
!0 = !{i32 7}

; Setting Threadgroup Dimensions to 64 x 1 x 1
!llpc.compute.mode = !{!1}
!1 = !{i32 64, i32 1, i32 1}

; CHECK-LABEL: fn:
; CHECK:         s_waitcnt vmcnt(0) expcnt(0) lgkmcnt(0)
; CHECK-NEXT:    s_xor_saveexec_b64 s[0:1], -1
; CHECK-NEXT:    scratch_store_b32 off, v2, s32
; CHECK-NEXT:    s_mov_b64 exec, s[0:1]
; CHECK-NEXT:    v_lshlrev_b32_e32 v3, 2, v1
; CHECK-NEXT:    s_or_saveexec_b64 s[0:1], -1
; CHECK-NEXT:    v_permlane64_b32 v2, v0
; CHECK-NEXT:    ds_bpermute_b32 v2, v3, v2
; CHECK-NEXT:    s_mov_b64 exec, s[0:1]
; CHECK-NEXT:    v_mbcnt_lo_u32_b32 v4, -1, 0
; CHECK-NEXT:    ds_bpermute_b32 v0, v3, v0
; CHECK-NEXT:    v_mbcnt_hi_u32_b32 v3, -1, v4
; CHECK-NEXT:    s_delay_alu instid0(VALU_DEP_1) | instskip(SKIP_2) | instid1(VALU_DEP_2)
; CHECK-NEXT:    v_xor_b32_e32 v1, v3, v1
; CHECK-NEXT:    s_waitcnt lgkmcnt(1)
; CHECK-NEXT:    v_mov_b32_e32 v3, v2
; CHECK-NEXT:    v_and_b32_e32 v1, 32, v1
; CHECK-NEXT:    s_delay_alu instid0(VALU_DEP_1) | instskip(SKIP_1) | instid1(VALU_DEP_3)
; CHECK-NEXT:    v_cmp_eq_u32_e32 vcc, 0, v1
; CHECK-NEXT:    s_waitcnt lgkmcnt(0)
; CHECK-NEXT:    v_cndmask_b32_e32 v0, v3, v0, vcc
; CHECK-NEXT:    s_xor_saveexec_b64 s[0:1], -1
; CHECK-NEXT:    scratch_load_b32 v2, off, s32
; CHECK-NEXT:    s_mov_b64 exec, s[0:1]
; CHECK-NEXT:    s_waitcnt vmcnt(0)
; CHECK-NEXT:    s_setpc_b64 s[30:31]
