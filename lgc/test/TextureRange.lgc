
; RUN: lgc %s -print-after=lgc-builder-replayer -o /dev/null 2>&1 - <%s | FileCheck --check-prefixes=CHECK %s

; CHECK: [[descTable:%[0-9]+]] = call i8 addrspace(4)* @lgc.descriptor.table.addr(i32 1
; CHECK: %{{.*}} = getelementptr i8, i8 addrspace(4)* [[descTable]], i32 32

; RUN: lgc -mcpu=gfx1030 -o - - <%s | FileCheck --check-prefixes=SHADER_TEST %s
; SHADER_TEST: s_load_dwordx8 [[desc:.*]], {{.*}}, 0x20
; SHADER_TEST: image_sample {{.*}}, {{.*}}, [[desc]], {{.*}} dmask:0xf


; ModuleID = 'lgcPipeline'
target datalayout = "e-p:64:64-p1:64:64-p2:32:32-p3:32:32-p4:64:64-p5:32:32-p6:32:32-i64:64-v16:16-v24:32-v32:32-v48:64-v96:128-v192:256-v256:256-v512:512-v1024:1024-v2048:2048-n32:64-S32-A5-G1-ni:7"
target triple = "amdgcn--amdpal"

; Function Attrs: nounwind
define dllexport spir_func void @lgc.shader.VS.VSMain() local_unnamed_addr #0 !spirv.ExecutionModel !11 !lgc.shaderstage !12 {
.entry:
  ret void
}

; Function Attrs: nounwind
define dllexport spir_func void @lgc.shader.FS.PSMain() local_unnamed_addr #0 !spirv.ExecutionModel !13 !lgc.shaderstage !14 {
.entry:
  %0 = call <2 x float> (...) @lgc.create.read.generic.input.v2f32(i32 0, i32 0, i32 0, i32 0, i32 16, i32 undef)
  %1 = call <4 x i32> addrspace(4)* (...) @lgc.create.get.desc.ptr.p4v4i32(i32 2, i32 -2147483648, i32 0)
  %2 = call i32 (...) @lgc.create.get.desc.stride.i32(i32 2, i32 -2147483648, i32 0)
  %3 = load <4 x i32>, <4 x i32> addrspace(4)* %1, align 16
  %4 = call <8 x i32> addrspace(4)* (...) @lgc.create.get.desc.ptr.p4v8i32(i32 1, i32 -1073741824, i32 1)
  %5 = call i32 (...) @lgc.create.get.desc.stride.i32(i32 1, i32 -1073741824, i32 1)
  %6 = load <8 x i32>, <8 x i32> addrspace(4)* %4, align 32
  %7 = call reassoc nnan nsz arcp contract afn <4 x float> (...) @lgc.create.image.sample.v4f32(i32 1, i32 512, <8 x i32> %6, <4 x i32> %3, i32 1, <2 x float> %0)
  call void (...) @lgc.create.write.generic.output(<4 x float> %7, i32 0, i32 0, i32 0, i32 0, i32 0, i32 undef)
  ret void
}

; Function Attrs: nounwind readonly willreturn
declare <2 x float> @lgc.create.read.generic.input.v2f32(...) local_unnamed_addr #1

; Function Attrs: nounwind readnone
declare <4 x i32> addrspace(4)* @lgc.create.get.desc.ptr.p4v4i32(...) local_unnamed_addr #2

; Function Attrs: nounwind readnone
declare i32 @lgc.create.get.desc.stride.i32(...) local_unnamed_addr #2

; Function Attrs: nounwind readnone
declare <8 x i32> addrspace(4)* @lgc.create.get.desc.ptr.p4v8i32(...) local_unnamed_addr #2

; Function Attrs: nounwind readonly willreturn
declare <4 x float> @lgc.create.image.sample.v4f32(...) local_unnamed_addr #1

; Function Attrs: nounwind
declare void @lgc.create.write.generic.output(...) local_unnamed_addr #0

attributes #0 = { nounwind }
attributes #1 = { nounwind readonly willreturn }
attributes #2 = { nounwind readnone }

!lgc.client = !{!0}
!lgc.options = !{!1}
!lgc.options.VS = !{!2}
!lgc.options.FS = !{!3}
!lgc.user.data.nodes = !{!4, !5, !6, !7}
!lgc.color.export.formats = !{!8}
!lgc.input.assembly.state = !{!9}
!amdgpu.pal.metadata.msgpack = !{!10}

!0 = !{!"Vulkan"}
!1 = !{i32 1255961814, i32 -1189218036, i32 -727621017, i32 -123054272, i32 0, i32 0, i32 0, i32 0, i32 0, i32 0, i32 0, i32 1, i32 0, i32 0, i32 2, i32 0, i32 0, i32 0, i32 1}
!2 = !{i32 -64684466, i32 1801624907, i32 0, i32 0, i32 0, i32 0, i32 0, i32 0, i32 0, i32 0, i32 0, i32 64, i32 0, i32 0, i32 3, i32 0, i32 0, i32 0, i32 0, i32 0, i32 0, i32 20, i32 1800}
!3 = !{i32 795232573, i32 -1800339224, i32 0, i32 0, i32 0, i32 0, i32 0, i32 0, i32 0, i32 0, i32 0, i32 64, i32 0, i32 0, i32 3, i32 0, i32 0, i32 0, i32 0, i32 0, i32 0, i32 20, i32 1800}
!4 = !{!"DescriptorTableVaPtr", i32 0, i32 1, i32 1}
!5 = !{!"DescriptorResource", i32 0, i32 16, i32 -1073741824, i32 0, i32 8}
!6 = !{!"DescriptorTableVaPtr", i32 1, i32 1, i32 1}
!7 = !{!"DescriptorSampler", i32 0, i32 4, i32 -2147483648, i32 0, i32 4}
!8 = !{i32 10}
!9 = !{i32 0, i32 3}
!10 = !{!"\82\B0amdpal.pipelines\91\84\AA.registers\80\B0.spill_threshold\CE\FF\FF\FF\FF\B0.user_data_limit\00\AF.xgl_cache_info\82\B3.128_bit_cache_hash\92\CF\96|\A4)b \EF\E1\CF\E0oY\96\\\8AQ\D0\AD.llpc_version\A453.5\AEamdpal.version\92\02\03"}
!11 = !{i32 0}
!12 = !{i32 1}
!13 = !{i32 4}
!14 = !{i32 6}
