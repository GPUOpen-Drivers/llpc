; NOTE: Assertions have been autogenerated by utils/update_test_checks.py UTC_ARGS: --tool lgc --version 4
; RUN: lgc -mcpu=gfx1030 -o - -passes="require<lgc-pipeline-state>,lgc-patch-entry-point-mutate" %s | FileCheck --check-prefixes=CHECK %s

%_rgen_1.Frame = type { ptr addrspace(7), ptr addrspace(7), i32 }

; Function Attrs: alwaysinline nounwind
define spir_func void @_rgen_1({} %state, i32 %rcr) #0 !spirv.ExecutionModel !15 !lgc.shaderstage !16 !continuation !18 !lgc.cps !17 {
; CHECK-LABEL: define amdgpu_cs_chain void @_rgen_1(
; CHECK-SAME: i32 inreg [[GLOBALTABLE:%.*]], ptr addrspace(4) inreg [[NUMWORKGROUPSPTR:%.*]], i32 inreg [[USERDATA0:%.*]], i32 inreg [[USERDATA1:%.*]], i32 inreg [[USERDATA2:%.*]], i32 inreg [[USERDATA3:%.*]], i32 inreg [[USERDATA4:%.*]], i32 inreg [[USERDATA5:%.*]], i32 inreg [[PAD6:%.*]], i32 inreg [[PAD7:%.*]], i32 inreg [[PAD8:%.*]], i32 inreg [[PAD9:%.*]], i32 inreg [[PAD10:%.*]], i32 inreg [[PAD11:%.*]], i32 inreg [[SPILLTABLE:%.*]], <3 x i32> inreg [[WORKGROUPID:%.*]], i32 inreg [[MULTIDISPATCHINFO:%.*]], <3 x i32> [[LOCALINVOCATIONID:%.*]], i32 [[VCR:%.*]], ptr addrspace(5) [[VSP:%.*]], i32 [[RCR:%.*]]) #[[ATTR0:[0-9]+]] align 64 !spirv.ExecutionModel !15 !lgc.shaderstage [[META16:![0-9]+]] !continuation [[META17:![0-9]+]] !lgc.cps [[META18:![0-9]+]] {
; CHECK-NEXT:  .entry:
; CHECK-NEXT:    [[TMP0:%.*]] = alloca i32, align 4, addrspace(5)
; CHECK-NEXT:    [[TMP1:%.*]] = call i64 @llvm.amdgcn.s.getpc()
; CHECK-NEXT:    [[TMP2:%.*]] = bitcast i64 [[TMP1]] to <2 x i32>
; CHECK-NEXT:    [[TMP3:%.*]] = insertelement <2 x i32> [[TMP2]], i32 [[SPILLTABLE]], i64 0
; CHECK-NEXT:    [[TMP4:%.*]] = bitcast <2 x i32> [[TMP3]] to i64
; CHECK-NEXT:    [[TMP5:%.*]] = inttoptr i64 [[TMP4]] to ptr addrspace(4)
; CHECK-NEXT:    [[TMP6:%.*]] = call i64 @llvm.amdgcn.s.getpc()
; CHECK-NEXT:    [[TMP7:%.*]] = bitcast i64 [[TMP6]] to <2 x i32>
; CHECK-NEXT:    [[TMP8:%.*]] = ptrtoint ptr addrspace(5) [[VSP]] to i32
; CHECK-NEXT:    store i32 [[TMP8]], ptr addrspace(5) [[TMP0]], align 4
; CHECK-NEXT:    [[TMP9:%.*]] = load i32, ptr addrspace(5) [[TMP0]], align 4
; CHECK-NEXT:    [[TMP10:%.*]] = add i32 [[TMP9]], 96
; CHECK-NEXT:    store i32 [[TMP10]], ptr addrspace(5) [[TMP0]], align 4
; CHECK-NEXT:    [[TMP11:%.*]] = call i64 @llvm.amdgcn.s.getpc()
; CHECK-NEXT:    [[TMP12:%.*]] = bitcast i64 [[TMP11]] to <2 x i32>
; CHECK-NEXT:    [[TMP13:%.*]] = call i64 @llvm.amdgcn.s.getpc()
; CHECK-NEXT:    [[TMP14:%.*]] = bitcast i64 [[TMP13]] to <2 x i32>
; CHECK-NEXT:    [[TMP15:%.*]] = call i64 @llvm.amdgcn.s.getpc()
; CHECK-NEXT:    [[TMP16:%.*]] = bitcast i64 [[TMP15]] to <2 x i32>
; CHECK-NEXT:    [[TMP17:%.*]] = insertelement <2 x i32> [[TMP16]], i32 [[USERDATA5]], i64 0
; CHECK-NEXT:    [[TMP18:%.*]] = bitcast <2 x i32> [[TMP17]] to i64
; CHECK-NEXT:    [[TMP19:%.*]] = inttoptr i64 [[TMP18]] to ptr addrspace(4)
; CHECK-NEXT:    [[TMP20:%.*]] = getelementptr i8, ptr addrspace(4) [[TMP19]], i32 0
; CHECK-NEXT:    [[TMP21:%.*]] = load <2 x i32>, ptr addrspace(4) [[TMP20]], align 8
; CHECK-NEXT:    [[TMP22:%.*]] = extractelement <2 x i32> [[TMP21]], i64 0
; CHECK-NEXT:    [[TMP23:%.*]] = extractelement <2 x i32> [[TMP21]], i64 1
; CHECK-NEXT:    [[TMP24:%.*]] = insertelement <4 x i32> poison, i32 [[TMP22]], i64 0
; CHECK-NEXT:    [[TMP25:%.*]] = and i32 [[TMP23]], 65535
; CHECK-NEXT:    [[TMP26:%.*]] = insertelement <4 x i32> [[TMP24]], i32 [[TMP25]], i64 1
; CHECK-NEXT:    [[TMP27:%.*]] = insertelement <4 x i32> [[TMP26]], i32 -1, i64 2
; CHECK-NEXT:    [[TMP28:%.*]] = insertelement <4 x i32> [[TMP27]], i32 553734060, i64 3
; CHECK-NEXT:    [[TMP29:%.*]] = call ptr addrspace(7) @lgc.buffer.desc.to.ptr(<4 x i32> [[TMP28]])
; CHECK-NEXT:    [[TMP30:%.*]] = insertelement <2 x i32> [[TMP14]], i32 [[USERDATA0]], i64 0
; CHECK-NEXT:    [[TMP31:%.*]] = bitcast <2 x i32> [[TMP30]] to i64
; CHECK-NEXT:    [[TMP32:%.*]] = inttoptr i64 [[TMP31]] to ptr addrspace(4)
; CHECK-NEXT:    [[TMP33:%.*]] = getelementptr i8, ptr addrspace(4) [[TMP32]], i32 32
; CHECK-NEXT:    [[TMP34:%.*]] = load <4 x i32>, ptr addrspace(4) [[TMP33]], align 16
; CHECK-NEXT:    [[TMP35:%.*]] = call ptr addrspace(7) @lgc.buffer.desc.to.ptr(<4 x i32> [[TMP34]])
; CHECK-NEXT:    [[TMP36:%.*]] = inttoptr i32 [[TMP9]] to ptr addrspace(5)
; CHECK-NEXT:    [[TMP37:%.*]] = getelementptr i8, ptr addrspace(5) [[TMP36]], i32 0
; CHECK-NEXT:    store ptr addrspace(7) [[TMP35]], ptr addrspace(5) [[TMP37]], align 32
; CHECK-NEXT:    [[TMP38:%.*]] = insertelement <2 x i32> [[TMP12]], i32 [[USERDATA0]], i64 0
; CHECK-NEXT:    [[TMP39:%.*]] = bitcast <2 x i32> [[TMP38]] to i64
; CHECK-NEXT:    [[TMP40:%.*]] = inttoptr i64 [[TMP39]] to ptr addrspace(4)
; CHECK-NEXT:    [[TMP41:%.*]] = getelementptr i8, ptr addrspace(4) [[TMP40]], i32 48
; CHECK-NEXT:    [[TMP42:%.*]] = load <4 x i32>, ptr addrspace(4) [[TMP41]], align 16
; CHECK-NEXT:    [[TMP43:%.*]] = call ptr addrspace(7) @lgc.buffer.desc.to.ptr(<4 x i32> [[TMP42]])
; CHECK-NEXT:    [[TMP44:%.*]] = add i32 [[TMP9]], 32
; CHECK-NEXT:    [[TMP45:%.*]] = inttoptr i32 [[TMP44]] to ptr addrspace(5)
; CHECK-NEXT:    [[TMP46:%.*]] = getelementptr i8, ptr addrspace(5) [[TMP45]], i32 0
; CHECK-NEXT:    store ptr addrspace(7) [[TMP43]], ptr addrspace(5) [[TMP46]], align 32
; CHECK-NEXT:    [[TMP47:%.*]] = load volatile i32, ptr addrspace(7) [[TMP43]], align 4
; CHECK-NEXT:    [[TMP48:%.*]] = add i32 [[TMP9]], 64
; CHECK-NEXT:    [[TMP49:%.*]] = inttoptr i32 [[TMP48]] to ptr addrspace(5)
; CHECK-NEXT:    [[TMP50:%.*]] = getelementptr i8, ptr addrspace(5) [[TMP49]], i32 0
; CHECK-NEXT:    store i32 [[TMP47]], ptr addrspace(5) [[TMP50]], align 4
; CHECK-NEXT:    [[TMP51:%.*]] = add i32 [[TMP47]], -37
; CHECK-NEXT:    [[TMP52:%.*]] = getelementptr inbounds i8, ptr addrspace(7) [[TMP29]], i32 52
; CHECK-NEXT:    [[TMP53:%.*]] = load i64, ptr addrspace(7) [[TMP52]], align 8
; CHECK-NEXT:    [[TMP54:%.*]] = getelementptr inbounds i8, ptr addrspace(7) [[TMP29]], i32 60
; CHECK-NEXT:    [[TMP55:%.*]] = load i32, ptr addrspace(7) [[TMP54]], align 4
; CHECK-NEXT:    [[TMP56:%.*]] = mul i32 [[TMP51]], [[TMP55]]
; CHECK-NEXT:    [[TMP57:%.*]] = inttoptr i64 [[TMP53]] to ptr addrspace(1)
; CHECK-NEXT:    [[TMP58:%.*]] = sext i32 [[TMP56]] to i64
; CHECK-NEXT:    [[TMP59:%.*]] = getelementptr i8, ptr addrspace(1) [[TMP57]], i64 [[TMP58]]
; CHECK-NEXT:    [[TMP60:%.*]] = load i64, ptr addrspace(1) [[TMP59]], align 8
; CHECK-NEXT:    [[TMP61:%.*]] = inttoptr i64 [[TMP60]] to ptr
; CHECK-NEXT:    [[TMP62:%.*]] = ptrtoint ptr [[TMP61]] to i32
; CHECK-NEXT:    [[TMP63:%.*]] = or i32 [[TMP62]], 1
; CHECK-NEXT:    [[TMP64:%.*]] = inttoptr i32 [[TMP63]] to ptr
; CHECK-NEXT:    [[TMP65:%.*]] = load i32, ptr addrspace(5) [[TMP0]], align 4
; CHECK-NEXT:    [[TMP66:%.*]] = inttoptr i32 [[TMP65]] to ptr addrspace(5)
; CHECK-NEXT:    br label [[TAIL_BLOCK:%.*]]
; CHECK:       tail.block:
; CHECK-NEXT:    [[TMP67:%.*]] = insertvalue { <3 x i32>, i32, ptr addrspace(5), i32, i32, i32 } poison, <3 x i32> [[LOCALINVOCATIONID]], 0
; CHECK-NEXT:    [[TMP68:%.*]] = insertvalue { <3 x i32>, i32, ptr addrspace(5), i32, i32, i32 } [[TMP67]], i32 [[TMP63]], 1
; CHECK-NEXT:    [[TMP69:%.*]] = insertvalue { <3 x i32>, i32, ptr addrspace(5), i32, i32, i32 } [[TMP68]], ptr addrspace(5) [[TMP66]], 2
; CHECK-NEXT:    [[TMP70:%.*]] = insertvalue { <3 x i32>, i32, ptr addrspace(5), i32, i32, i32 } [[TMP69]], i32 add (i32 ptrtoint (ptr @_rgen_1.resume.0 to i32), i32 1), 3
; CHECK-NEXT:    [[TMP71:%.*]] = insertvalue { <3 x i32>, i32, ptr addrspace(5), i32, i32, i32 } [[TMP70]], i32 undef, 4
; CHECK-NEXT:    [[TMP72:%.*]] = insertvalue { <3 x i32>, i32, ptr addrspace(5), i32, i32, i32 } [[TMP71]], i32 [[TMP51]], 5
; CHECK-NEXT:    [[TMP73:%.*]] = extractvalue { <3 x i32>, i32, ptr addrspace(5), i32, i32, i32 } [[TMP72]], 1
; CHECK-NEXT:    [[TMP74:%.*]] = call i32 @llvm.amdgcn.set.inactive.chain.arg.i32(i32 [[TMP73]], i32 [[VCR]])
; CHECK-NEXT:    [[TMP75:%.*]] = and i32 [[TMP74]], 7
; CHECK-NEXT:    [[TMP76:%.*]] = icmp ne i32 [[TMP75]], 0
; CHECK-NEXT:    [[TMP77:%.*]] = call i32 @llvm.amdgcn.ballot.i32(i1 [[TMP76]])
; CHECK-NEXT:    [[TMP78:%.*]] = icmp eq i32 [[TMP75]], 3
; CHECK-NEXT:    [[TMP79:%.*]] = call i32 @llvm.amdgcn.ballot.i32(i1 [[TMP78]])
; CHECK-NEXT:    [[TMP80:%.*]] = icmp ne i32 [[TMP79]], 0
; CHECK-NEXT:    [[TMP81:%.*]] = select i1 [[TMP80]], i32 [[TMP79]], i32 [[TMP77]]
; CHECK-NEXT:    [[TMP82:%.*]] = icmp eq i32 [[TMP75]], 2
; CHECK-NEXT:    [[TMP83:%.*]] = call i32 @llvm.amdgcn.ballot.i32(i1 [[TMP82]])
; CHECK-NEXT:    [[TMP84:%.*]] = icmp ne i32 [[TMP83]], 0
; CHECK-NEXT:    [[TMP85:%.*]] = select i1 [[TMP84]], i32 [[TMP83]], i32 [[TMP81]]
; CHECK-NEXT:    [[TMP86:%.*]] = icmp eq i32 [[TMP75]], 1
; CHECK-NEXT:    [[TMP87:%.*]] = call i32 @llvm.amdgcn.ballot.i32(i1 [[TMP86]])
; CHECK-NEXT:    [[TMP88:%.*]] = icmp ne i32 [[TMP87]], 0
; CHECK-NEXT:    [[TMP89:%.*]] = select i1 [[TMP88]], i32 [[TMP87]], i32 [[TMP85]]
; CHECK-NEXT:    [[TMP90:%.*]] = call i32 @llvm.cttz.i32(i32 [[TMP89]], i1 true)
; CHECK-NEXT:    [[TMP91:%.*]] = call i32 @llvm.amdgcn.readlane(i32 [[TMP74]], i32 [[TMP90]])
; CHECK-NEXT:    [[TMP92:%.*]] = icmp eq i32 [[TMP74]], [[TMP91]]
; CHECK-NEXT:    [[TMP93:%.*]] = call i32 @llvm.amdgcn.ballot.i32(i1 [[TMP92]])
; CHECK-NEXT:    [[TMP94:%.*]] = call i32 @llvm.amdgcn.wwm.i32(i32 [[TMP91]])
; CHECK-NEXT:    [[TMP95:%.*]] = call i32 @llvm.amdgcn.wwm.i32(i32 [[TMP93]])
; CHECK-NEXT:    [[TMP96:%.*]] = and i32 [[TMP94]], -64
; CHECK-NEXT:    [[TMP97:%.*]] = insertelement <2 x i32> [[TMP7]], i32 [[TMP96]], i64 0
; CHECK-NEXT:    [[TMP98:%.*]] = bitcast <2 x i32> [[TMP97]] to i64
; CHECK-NEXT:    [[TMP99:%.*]] = inttoptr i64 [[TMP98]] to ptr
; CHECK-NEXT:    [[TMP100:%.*]] = ptrtoint ptr addrspace(4) [[NUMWORKGROUPSPTR]] to i64
; CHECK-NEXT:    [[TMP101:%.*]] = bitcast i64 [[TMP100]] to <2 x i32>
; CHECK-NEXT:    [[TMP102:%.*]] = extractelement <2 x i32> [[TMP101]], i64 0
; CHECK-NEXT:    [[TMP103:%.*]] = extractelement <2 x i32> [[TMP101]], i64 1
; CHECK-NEXT:    [[TMP104:%.*]] = extractelement <3 x i32> [[WORKGROUPID]], i64 0
; CHECK-NEXT:    [[TMP105:%.*]] = extractelement <3 x i32> [[WORKGROUPID]], i64 1
; CHECK-NEXT:    [[TMP106:%.*]] = extractelement <3 x i32> [[WORKGROUPID]], i64 2
; CHECK-NEXT:    [[TMP107:%.*]] = insertelement <20 x i32> poison, i32 [[GLOBALTABLE]], i64 0
; CHECK-NEXT:    [[TMP108:%.*]] = insertelement <20 x i32> [[TMP107]], i32 [[TMP102]], i64 1
; CHECK-NEXT:    [[TMP109:%.*]] = insertelement <20 x i32> [[TMP108]], i32 [[TMP103]], i64 2
; CHECK-NEXT:    [[TMP110:%.*]] = insertelement <20 x i32> [[TMP109]], i32 [[USERDATA0]], i64 3
; CHECK-NEXT:    [[TMP111:%.*]] = insertelement <20 x i32> [[TMP110]], i32 [[USERDATA1]], i64 4
; CHECK-NEXT:    [[TMP112:%.*]] = insertelement <20 x i32> [[TMP111]], i32 [[USERDATA2]], i64 5
; CHECK-NEXT:    [[TMP113:%.*]] = insertelement <20 x i32> [[TMP112]], i32 [[USERDATA3]], i64 6
; CHECK-NEXT:    [[TMP114:%.*]] = insertelement <20 x i32> [[TMP113]], i32 [[USERDATA4]], i64 7
; CHECK-NEXT:    [[TMP115:%.*]] = insertelement <20 x i32> [[TMP114]], i32 [[USERDATA5]], i64 8
; CHECK-NEXT:    [[TMP116:%.*]] = insertelement <20 x i32> [[TMP115]], i32 [[PAD6]], i64 9
; CHECK-NEXT:    [[TMP117:%.*]] = insertelement <20 x i32> [[TMP116]], i32 [[PAD7]], i64 10
; CHECK-NEXT:    [[TMP118:%.*]] = insertelement <20 x i32> [[TMP117]], i32 [[PAD8]], i64 11
; CHECK-NEXT:    [[TMP119:%.*]] = insertelement <20 x i32> [[TMP118]], i32 [[PAD9]], i64 12
; CHECK-NEXT:    [[TMP120:%.*]] = insertelement <20 x i32> [[TMP119]], i32 [[PAD10]], i64 13
; CHECK-NEXT:    [[TMP121:%.*]] = insertelement <20 x i32> [[TMP120]], i32 [[PAD11]], i64 14
; CHECK-NEXT:    [[TMP122:%.*]] = insertelement <20 x i32> [[TMP121]], i32 [[SPILLTABLE]], i64 15
; CHECK-NEXT:    [[TMP123:%.*]] = insertelement <20 x i32> [[TMP122]], i32 [[TMP104]], i64 16
; CHECK-NEXT:    [[TMP124:%.*]] = insertelement <20 x i32> [[TMP123]], i32 [[TMP105]], i64 17
; CHECK-NEXT:    [[TMP125:%.*]] = insertelement <20 x i32> [[TMP124]], i32 [[TMP106]], i64 18
; CHECK-NEXT:    [[TMP126:%.*]] = insertelement <20 x i32> [[TMP125]], i32 [[MULTIDISPATCHINFO]], i64 19
; CHECK-NEXT:    call void (ptr, i32, <20 x i32>, { <3 x i32>, i32, ptr addrspace(5), i32, i32, i32 }, i32, ...) @llvm.amdgcn.cs.chain.p0.i32.v20i32.sl_v3i32i32p5i32i32i32s(ptr inreg [[TMP99]], i32 inreg [[TMP95]], <20 x i32> inreg [[TMP126]], { <3 x i32>, i32, ptr addrspace(5), i32, i32, i32 } [[TMP72]], i32 0)
; CHECK-NEXT:    unreachable
;
.entry:
  %0 = call ptr addrspace(32) @lgc.cps.alloc(i32 96)
  %1 = call i64 @llvm.amdgcn.s.getpc()
  %2 = bitcast i64 %1 to <2 x i32>
  %3 = call i64 @llvm.amdgcn.s.getpc()
  %4 = bitcast i64 %3 to <2 x i32>
  %5 = call i64 @llvm.amdgcn.s.getpc()
  %6 = bitcast i64 %5 to <2 x i32>
  %7 = call i32 @lgc.load.user.data__i32(i32 20)
  %8 = insertelement <2 x i32> %6, i32 %7, i64 0
  %9 = bitcast <2 x i32> %8 to i64
  %10 = inttoptr i64 %9 to ptr addrspace(4)
  %11 = getelementptr i8, ptr addrspace(4) %10, i32 0
  %12 = load <2 x i32>, ptr addrspace(4) %11, align 8
  %13 = extractelement <2 x i32> %12, i64 0
  %14 = extractelement <2 x i32> %12, i64 1
  %15 = insertelement <4 x i32> poison, i32 %13, i64 0
  %16 = and i32 %14, 65535
  %17 = insertelement <4 x i32> %15, i32 %16, i64 1
  %18 = insertelement <4 x i32> %17, i32 -1, i64 2
  %19 = insertelement <4 x i32> %18, i32 553734060, i64 3
  %20 = call ptr addrspace(7) @lgc.buffer.desc.to.ptr(<4 x i32> %19)
  %21 = call i32 @lgc.load.user.data__i32(i32 0)
  %22 = insertelement <2 x i32> %4, i32 %21, i64 0
  %23 = bitcast <2 x i32> %22 to i64
  %24 = inttoptr i64 %23 to ptr addrspace(4)
  %25 = getelementptr i8, ptr addrspace(4) %24, i32 32
  %26 = load <4 x i32>, ptr addrspace(4) %25, align 16
  %27 = call ptr addrspace(7) @lgc.buffer.desc.to.ptr(<4 x i32> %26)
  %28 = getelementptr inbounds %_rgen_1.Frame, ptr addrspace(32) %0, i32 0, i32 0
  store ptr addrspace(7) %27, ptr addrspace(32) %28, align 32
  %29 = call i32 @lgc.load.user.data__i32(i32 0)
  %30 = insertelement <2 x i32> %2, i32 %29, i64 0
  %31 = bitcast <2 x i32> %30 to i64
  %32 = inttoptr i64 %31 to ptr addrspace(4)
  %33 = getelementptr i8, ptr addrspace(4) %32, i32 48
  %34 = load <4 x i32>, ptr addrspace(4) %33, align 16
  %35 = call ptr addrspace(7) @lgc.buffer.desc.to.ptr(<4 x i32> %34)
  %36 = getelementptr inbounds %_rgen_1.Frame, ptr addrspace(32) %0, i32 0, i32 1
  store ptr addrspace(7) %35, ptr addrspace(32) %36, align 32
  %37 = load volatile i32, ptr addrspace(7) %35, align 4
  %38 = getelementptr inbounds %_rgen_1.Frame, ptr addrspace(32) %0, i32 0, i32 2
  store i32 %37, ptr addrspace(32) %38, align 4
  %39 = add i32 %37, -37
  %40 = getelementptr inbounds i8, ptr addrspace(7) %20, i32 52
  %41 = load i64, ptr addrspace(7) %40, align 8
  %42 = getelementptr inbounds i8, ptr addrspace(7) %20, i32 60
  %43 = load i32, ptr addrspace(7) %42, align 4
  %44 = mul i32 %39, %43
  %45 = inttoptr i64 %41 to ptr addrspace(1)
  %46 = sext i32 %44 to i64
  %47 = getelementptr i8, ptr addrspace(1) %45, i64 %46
  %48 = load i64, ptr addrspace(1) %47, align 8
  %49 = inttoptr i64 %48 to ptr
  %50 = ptrtoint ptr %49 to i32
  %51 = or i32 %50, 1
  %52 = inttoptr i32 %51 to ptr
  %53 = call i32 (...) @lgc.cps.as.continuation.reference__i32(ptr @_rgen_1.resume.0)
  call void (...) @lgc.cps.jump(i32 %51, i32 2, {} poison, i32 %53, [1 x i32] undef, i32 %39)
  unreachable
}

define void @_rgen_1.resume.0({} %0, i32 %1, [1 x i32] %2) !spirv.ExecutionModel !15 !lgc.shaderstage !16 !continuation !18 !lgc.cps !17 {
; CHECK-LABEL: define amdgpu_cs_chain void @_rgen_1.resume.0(
; CHECK-SAME: i32 inreg [[GLOBALTABLE:%.*]], ptr addrspace(4) inreg [[NUMWORKGROUPSPTR:%.*]], i32 inreg [[USERDATA0:%.*]], i32 inreg [[USERDATA1:%.*]], i32 inreg [[USERDATA2:%.*]], i32 inreg [[USERDATA3:%.*]], i32 inreg [[USERDATA4:%.*]], i32 inreg [[USERDATA5:%.*]], i32 inreg [[PAD6:%.*]], i32 inreg [[PAD7:%.*]], i32 inreg [[PAD8:%.*]], i32 inreg [[PAD9:%.*]], i32 inreg [[PAD10:%.*]], i32 inreg [[PAD11:%.*]], i32 inreg [[SPILLTABLE:%.*]], <3 x i32> inreg [[WORKGROUPID:%.*]], i32 inreg [[MULTIDISPATCHINFO:%.*]], <3 x i32> [[LOCALINVOCATIONID:%.*]], i32 [[VCR:%.*]], ptr addrspace(5) [[VSP:%.*]], i32 [[TMP0:%.*]], [1 x i32] [[TMP1:%.*]]) #[[ATTR1:[0-9]+]] align 64 !spirv.ExecutionModel !15 !lgc.shaderstage [[META16]] !continuation [[META17]] !lgc.cps [[META18]] {
; CHECK-NEXT:  entryresume.0:
; CHECK-NEXT:    [[TMP2:%.*]] = alloca i32, align 4, addrspace(5)
; CHECK-NEXT:    [[TMP3:%.*]] = call i64 @llvm.amdgcn.s.getpc()
; CHECK-NEXT:    [[TMP4:%.*]] = bitcast i64 [[TMP3]] to <2 x i32>
; CHECK-NEXT:    [[TMP5:%.*]] = insertelement <2 x i32> [[TMP4]], i32 [[SPILLTABLE]], i64 0
; CHECK-NEXT:    [[TMP6:%.*]] = bitcast <2 x i32> [[TMP5]] to i64
; CHECK-NEXT:    [[TMP7:%.*]] = inttoptr i64 [[TMP6]] to ptr addrspace(4)
; CHECK-NEXT:    [[TMP8:%.*]] = call i64 @llvm.amdgcn.s.getpc()
; CHECK-NEXT:    [[TMP9:%.*]] = bitcast i64 [[TMP8]] to <2 x i32>
; CHECK-NEXT:    [[TMP10:%.*]] = ptrtoint ptr addrspace(5) [[VSP]] to i32
; CHECK-NEXT:    store i32 [[TMP10]], ptr addrspace(5) [[TMP2]], align 4
; CHECK-NEXT:    [[TMP11:%.*]] = load i32, ptr addrspace(5) [[TMP2]], align 4
; CHECK-NEXT:    [[TMP12:%.*]] = add i32 [[TMP11]], -96
; CHECK-NEXT:    [[TMP13:%.*]] = add i32 [[TMP12]], 64
; CHECK-NEXT:    [[TMP14:%.*]] = inttoptr i32 [[TMP13]] to ptr addrspace(5)
; CHECK-NEXT:    [[TMP15:%.*]] = getelementptr i8, ptr addrspace(5) [[TMP14]], i32 0
; CHECK-NEXT:    [[DOTRELOAD6:%.*]] = load i32, ptr addrspace(5) [[TMP15]], align 4
; CHECK-NEXT:    [[TMP16:%.*]] = add i32 [[TMP12]], 32
; CHECK-NEXT:    [[TMP17:%.*]] = inttoptr i32 [[TMP16]] to ptr addrspace(5)
; CHECK-NEXT:    [[TMP18:%.*]] = getelementptr i8, ptr addrspace(5) [[TMP17]], i32 0
; CHECK-NEXT:    [[DOTRELOAD3:%.*]] = load ptr addrspace(7), ptr addrspace(5) [[TMP18]], align 32
; CHECK-NEXT:    [[TMP19:%.*]] = inttoptr i32 [[TMP12]] to ptr addrspace(5)
; CHECK-NEXT:    [[TMP20:%.*]] = getelementptr i8, ptr addrspace(5) [[TMP19]], i32 0
; CHECK-NEXT:    [[DOTRELOAD:%.*]] = load ptr addrspace(7), ptr addrspace(5) [[TMP20]], align 32
; CHECK-NEXT:    [[TMP21:%.*]] = mul i32 [[USERDATA5]], 96
; CHECK-NEXT:    [[TMP22:%.*]] = add i32 [[TMP12]], [[TMP21]]
; CHECK-NEXT:    [[TMP23:%.*]] = inttoptr i32 [[TMP22]] to ptr addrspace(5)
; CHECK-NEXT:    [[TMP24:%.*]] = getelementptr i8, ptr addrspace(5) [[TMP23]], i32 0
; CHECK-NEXT:    [[DUMMY_RELOAD:%.*]] = load ptr addrspace(7), ptr addrspace(5) [[TMP24]], align 32
; CHECK-NEXT:    [[TMP25:%.*]] = load volatile i32, ptr addrspace(7) [[DOTRELOAD3]], align 4
; CHECK-NEXT:    [[TMP26:%.*]] = icmp eq i32 [[DOTRELOAD6]], [[TMP25]]
; CHECK-NEXT:    [[TMP27:%.*]] = zext i1 [[TMP26]] to i32
; CHECK-NEXT:    store i32 [[TMP27]], ptr addrspace(7) [[DOTRELOAD]], align 4
; CHECK-NEXT:    br label [[TAIL_BLOCK:%.*]]
; CHECK:       tail.block:
; CHECK-NEXT:    [[TMP28:%.*]] = insertvalue { <3 x i32>, i32, ptr addrspace(5) } poison, <3 x i32> [[LOCALINVOCATIONID]], 0
; CHECK-NEXT:    [[TMP29:%.*]] = insertvalue { <3 x i32>, i32, ptr addrspace(5) } [[TMP28]], i32 0, 1
; CHECK-NEXT:    [[TMP30:%.*]] = insertvalue { <3 x i32>, i32, ptr addrspace(5) } [[TMP29]], ptr addrspace(5) poison, 2
; CHECK-NEXT:    [[TMP31:%.*]] = extractvalue { <3 x i32>, i32, ptr addrspace(5) } [[TMP30]], 1
; CHECK-NEXT:    [[TMP32:%.*]] = call i32 @llvm.amdgcn.set.inactive.chain.arg.i32(i32 [[TMP31]], i32 [[VCR]])
; CHECK-NEXT:    [[TMP33:%.*]] = and i32 [[TMP32]], 7
; CHECK-NEXT:    [[TMP34:%.*]] = icmp ne i32 [[TMP33]], 0
; CHECK-NEXT:    [[TMP35:%.*]] = call i32 @llvm.amdgcn.ballot.i32(i1 [[TMP34]])
; CHECK-NEXT:    [[TMP36:%.*]] = icmp eq i32 [[TMP33]], 3
; CHECK-NEXT:    [[TMP37:%.*]] = call i32 @llvm.amdgcn.ballot.i32(i1 [[TMP36]])
; CHECK-NEXT:    [[TMP38:%.*]] = icmp ne i32 [[TMP37]], 0
; CHECK-NEXT:    [[TMP39:%.*]] = select i1 [[TMP38]], i32 [[TMP37]], i32 [[TMP35]]
; CHECK-NEXT:    [[TMP40:%.*]] = icmp eq i32 [[TMP33]], 2
; CHECK-NEXT:    [[TMP41:%.*]] = call i32 @llvm.amdgcn.ballot.i32(i1 [[TMP40]])
; CHECK-NEXT:    [[TMP42:%.*]] = icmp ne i32 [[TMP41]], 0
; CHECK-NEXT:    [[TMP43:%.*]] = select i1 [[TMP42]], i32 [[TMP41]], i32 [[TMP39]]
; CHECK-NEXT:    [[TMP44:%.*]] = icmp eq i32 [[TMP33]], 1
; CHECK-NEXT:    [[TMP45:%.*]] = call i32 @llvm.amdgcn.ballot.i32(i1 [[TMP44]])
; CHECK-NEXT:    [[TMP46:%.*]] = icmp ne i32 [[TMP45]], 0
; CHECK-NEXT:    [[TMP47:%.*]] = select i1 [[TMP46]], i32 [[TMP45]], i32 [[TMP43]]
; CHECK-NEXT:    [[TMP48:%.*]] = call i32 @llvm.cttz.i32(i32 [[TMP47]], i1 true)
; CHECK-NEXT:    [[TMP49:%.*]] = call i32 @llvm.amdgcn.readlane(i32 [[TMP32]], i32 [[TMP48]])
; CHECK-NEXT:    [[TMP50:%.*]] = icmp eq i32 [[TMP32]], [[TMP49]]
; CHECK-NEXT:    [[TMP51:%.*]] = call i32 @llvm.amdgcn.ballot.i32(i1 [[TMP50]])
; CHECK-NEXT:    [[TMP52:%.*]] = call i32 @llvm.amdgcn.wwm.i32(i32 [[TMP49]])
; CHECK-NEXT:    [[TMP53:%.*]] = call i32 @llvm.amdgcn.wwm.i32(i32 [[TMP51]])
; CHECK-NEXT:    [[TMP54:%.*]] = icmp eq i32 [[TMP52]], 0
; CHECK-NEXT:    br i1 [[TMP54]], label [[RET_BLOCK:%.*]], label [[CHAIN_BLOCK:%.*]]
; CHECK:       chain.block:
; CHECK-NEXT:    [[TMP55:%.*]] = and i32 [[TMP52]], -64
; CHECK-NEXT:    [[TMP56:%.*]] = insertelement <2 x i32> [[TMP9]], i32 [[TMP55]], i64 0
; CHECK-NEXT:    [[TMP57:%.*]] = bitcast <2 x i32> [[TMP56]] to i64
; CHECK-NEXT:    [[TMP58:%.*]] = inttoptr i64 [[TMP57]] to ptr
; CHECK-NEXT:    [[TMP59:%.*]] = ptrtoint ptr addrspace(4) [[NUMWORKGROUPSPTR]] to i64
; CHECK-NEXT:    [[TMP60:%.*]] = bitcast i64 [[TMP59]] to <2 x i32>
; CHECK-NEXT:    [[TMP61:%.*]] = extractelement <2 x i32> [[TMP60]], i64 0
; CHECK-NEXT:    [[TMP62:%.*]] = extractelement <2 x i32> [[TMP60]], i64 1
; CHECK-NEXT:    [[TMP63:%.*]] = extractelement <3 x i32> [[WORKGROUPID]], i64 0
; CHECK-NEXT:    [[TMP64:%.*]] = extractelement <3 x i32> [[WORKGROUPID]], i64 1
; CHECK-NEXT:    [[TMP65:%.*]] = extractelement <3 x i32> [[WORKGROUPID]], i64 2
; CHECK-NEXT:    [[TMP66:%.*]] = insertelement <20 x i32> poison, i32 [[GLOBALTABLE]], i64 0
; CHECK-NEXT:    [[TMP67:%.*]] = insertelement <20 x i32> [[TMP66]], i32 [[TMP61]], i64 1
; CHECK-NEXT:    [[TMP68:%.*]] = insertelement <20 x i32> [[TMP67]], i32 [[TMP62]], i64 2
; CHECK-NEXT:    [[TMP69:%.*]] = insertelement <20 x i32> [[TMP68]], i32 [[USERDATA0]], i64 3
; CHECK-NEXT:    [[TMP70:%.*]] = insertelement <20 x i32> [[TMP69]], i32 [[USERDATA1]], i64 4
; CHECK-NEXT:    [[TMP71:%.*]] = insertelement <20 x i32> [[TMP70]], i32 [[USERDATA2]], i64 5
; CHECK-NEXT:    [[TMP72:%.*]] = insertelement <20 x i32> [[TMP71]], i32 [[USERDATA3]], i64 6
; CHECK-NEXT:    [[TMP73:%.*]] = insertelement <20 x i32> [[TMP72]], i32 [[USERDATA4]], i64 7
; CHECK-NEXT:    [[TMP74:%.*]] = insertelement <20 x i32> [[TMP73]], i32 [[USERDATA5]], i64 8
; CHECK-NEXT:    [[TMP75:%.*]] = insertelement <20 x i32> [[TMP74]], i32 [[PAD6]], i64 9
; CHECK-NEXT:    [[TMP76:%.*]] = insertelement <20 x i32> [[TMP75]], i32 [[PAD7]], i64 10
; CHECK-NEXT:    [[TMP77:%.*]] = insertelement <20 x i32> [[TMP76]], i32 [[PAD8]], i64 11
; CHECK-NEXT:    [[TMP78:%.*]] = insertelement <20 x i32> [[TMP77]], i32 [[PAD9]], i64 12
; CHECK-NEXT:    [[TMP79:%.*]] = insertelement <20 x i32> [[TMP78]], i32 [[PAD10]], i64 13
; CHECK-NEXT:    [[TMP80:%.*]] = insertelement <20 x i32> [[TMP79]], i32 [[PAD11]], i64 14
; CHECK-NEXT:    [[TMP81:%.*]] = insertelement <20 x i32> [[TMP80]], i32 [[SPILLTABLE]], i64 15
; CHECK-NEXT:    [[TMP82:%.*]] = insertelement <20 x i32> [[TMP81]], i32 [[TMP63]], i64 16
; CHECK-NEXT:    [[TMP83:%.*]] = insertelement <20 x i32> [[TMP82]], i32 [[TMP64]], i64 17
; CHECK-NEXT:    [[TMP84:%.*]] = insertelement <20 x i32> [[TMP83]], i32 [[TMP65]], i64 18
; CHECK-NEXT:    [[TMP85:%.*]] = insertelement <20 x i32> [[TMP84]], i32 [[MULTIDISPATCHINFO]], i64 19
; CHECK-NEXT:    call void (ptr, i32, <20 x i32>, { <3 x i32>, i32, ptr addrspace(5) }, i32, ...) @llvm.amdgcn.cs.chain.p0.i32.v20i32.sl_v3i32i32p5s(ptr inreg [[TMP58]], i32 inreg [[TMP53]], <20 x i32> inreg [[TMP85]], { <3 x i32>, i32, ptr addrspace(5) } [[TMP30]], i32 0)
; CHECK-NEXT:    unreachable
; CHECK:       ret.block:
; CHECK-NEXT:    ret void
;
entryresume.0:
  %3 = call ptr addrspace(32) @lgc.cps.peek(i32 96)
  %4 = getelementptr inbounds %_rgen_1.Frame, ptr addrspace(32) %3, i32 0, i32 2
  %.reload6 = load i32, ptr addrspace(32) %4, align 4
  %5 = getelementptr inbounds %_rgen_1.Frame, ptr addrspace(32) %3, i32 0, i32 1
  %.reload3 = load ptr addrspace(7), ptr addrspace(32) %5, align 32
  %6 = getelementptr inbounds %_rgen_1.Frame, ptr addrspace(32) %3, i32 0, i32 0
  %.reload = load ptr addrspace(7), ptr addrspace(32) %6, align 32
  %dummy.udata = call i32 @lgc.load.user.data__i32(i32 20)
  %dummy.gep = getelementptr inbounds %_rgen_1.Frame, ptr addrspace(32) %3, i32 %dummy.udata, i32 0
  %dummy.reload = load ptr addrspace(7), ptr addrspace(32) %dummy.gep, align 32
  %7 = load volatile i32, ptr addrspace(7) %.reload3, align 4
  %8 = icmp eq i32 %.reload6, %7
  %9 = zext i1 %8 to i32
  store i32 %9, ptr addrspace(7) %.reload, align 4
  ret void
}

; Function Attrs: nounwind willreturn memory(none)
declare i32 @lgc.load.user.data__i32(i32) #1

; Function Attrs: nocallback nofree nosync nounwind speculatable willreturn memory(none)
declare i64 @llvm.amdgcn.s.getpc() #2

; Function Attrs: nounwind willreturn memory(none)
declare ptr addrspace(7) @lgc.buffer.desc.to.ptr(<4 x i32>) #1

; Function Attrs: nounwind willreturn memory(inaccessiblemem: readwrite)
declare ptr addrspace(32) @lgc.cps.alloc(i32) #6

; Function Attrs: nounwind willreturn
declare i32 @lgc.cps.as.continuation.reference__i32(...) #3

; Function Attrs: noreturn
declare void @lgc.cps.jump(...) #5

; Function Attrs: nounwind willreturn memory(inaccessiblemem: read)
declare ptr addrspace(32) @lgc.cps.peek(i32) #7

attributes #0 = { alwaysinline nounwind "target-features"=",+wavefrontsize32" }
attributes #1 = { nounwind willreturn memory(none) }
attributes #2 = { nocallback nofree nosync nounwind speculatable willreturn memory(none) }
attributes #3 = { nounwind willreturn }
attributes #4 = { nounwind }
attributes #5 = { noreturn }
attributes #6 = { nounwind willreturn memory(inaccessiblemem: readwrite) }
attributes #7 = { nounwind willreturn memory(inaccessiblemem: read) }

!llpc.compute.mode = !{!0}
!lgc.client = !{!1}
!lgc.options = !{!2}
!lgc.options.CS = !{!3}
!lgc.user.data.nodes = !{!4, !5, !6, !7, !8, !9, !10, !11, !12, !13}
!amdgpu.pal.metadata.msgpack = !{!14}

!0 = !{i32 8, i32 4, i32 1}
!1 = !{!"Vulkan"}
!2 = !{i32 262875531, i32 502344192, i32 854861601, i32 -1595331954, i32 0, i32 0, i32 0, i32 0, i32 0, i32 0, i32 0, i32 0, i32 0, i32 0, i32 0, i32 0, i32 0, i32 -1, i32 0, i32 0, i32 0, i32 0, i32 0, i32 0, i32 0, i32 0, i32 0, i32 0, i32 0, i32 0, i32 16777216, i32 0, i32 0, i32 2}
!3 = !{i32 0, i32 0, i32 0, i32 0, i32 0, i32 0, i32 0, i32 192, i32 0, i32 0, i32 32, i32 64, i32 0, i32 0, i32 3, i32 0, i32 0, i32 0, i32 0, i32 0, i32 0, i32 20, i32 1800, i32 0, i32 0, i32 1}
!4 = !{!"DescriptorTableVaPtr", i32 7, i32 0, i32 0, i32 1, i32 4}
!5 = !{!"DescriptorBuffer", i32 6, i32 0, i32 0, i32 4, i64 0, i32 0, i32 4}
!6 = !{!"DescriptorBuffer", i32 6, i32 0, i32 4, i32 4, i64 0, i32 1, i32 4}
!7 = !{!"DescriptorBuffer", i32 6, i32 0, i32 8, i32 4, i64 0, i32 2, i32 4}
!8 = !{!"DescriptorBuffer", i32 6, i32 0, i32 12, i32 4, i64 0, i32 3, i32 4}
!9 = !{!"StreamOutTableVaPtr", i32 11, i32 0, i32 1, i32 1, i32 0}
!10 = !{!"DescriptorTableVaPtr", i32 7, i32 0, i32 5, i32 1, i32 3}
!11 = !{!"DescriptorBufferCompact", i32 10, i32 0, i32 0, i32 2, i64 93, i32 17, i32 2}
!12 = !{!"DescriptorBuffer", i32 6, i32 0, i32 2, i32 4, i64 93, i32 0, i32 4}
!13 = !{!"DescriptorBuffer", i32 6, i32 0, i32 6, i32 4, i64 93, i32 1, i32 4}
!14 = !{!"\82\B0amdpal.pipelines\91\83\B0.spill_threshold\CD\FF\FF\B0.user_data_limit\00\AF.xgl_cache_info\82\B3.128_bit_cache_hash\92\CF\C4jyX\05\E6M\0F\CF\03b\DD\05\C5\B6\DB\B9\AD.llpc_version\A467.0\AEamdpal.version\92\03\00"}
!15 = !{i32 5313}
!16 = !{i32 7}
!17 = !{i32 1}
!18 = !{ptr @_rgen_1}

;
;
;
;.
; CHECK: [[META16]] = !{i32 7}
; CHECK: [[META17]] = !{ptr @_rgen_1}
; CHECK: [[META18]] = !{i32 1}
;.
