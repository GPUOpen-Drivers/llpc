; NOTE: Assertions have been autogenerated by utils/update_test_checks.py UTC_ARGS: --tool lgc
; RUN: lgc -o - -passes=lgc-lower-cooperative-matrix %s | FileCheck --check-prefixes=CHECK %s

define <8 x float> @test_f16_ab_layout(ptr addrspace(7) %ptr) !spirv.ExecutionModel !8 !lgc.shaderstage !9 {
; CHECK-LABEL: @test_f16_ab_layout(
; CHECK-NEXT:    [[TMP1:%.*]] = call i32 @llvm.amdgcn.mbcnt.lo(i32 -1, i32 0)
; CHECK-NEXT:    [[TMP2:%.*]] = call i32 @llvm.amdgcn.mbcnt.hi(i32 -1, i32 [[TMP1]])
; CHECK-NEXT:    [[TMP3:%.*]] = srem i32 [[TMP2]], 16
; CHECK-NEXT:    [[TMP4:%.*]] = add i32 0, [[TMP3]]
; CHECK-NEXT:    [[TMP5:%.*]] = add i32 [[TMP4]], 0
; CHECK-NEXT:    [[TMP6:%.*]] = add i32 [[TMP5]], 0
; CHECK-NEXT:    [[TMP7:%.*]] = getelementptr half, ptr addrspace(7) [[PTR:%.*]], i32 [[TMP6]]
; CHECK-NEXT:    [[A1:%.*]] = load half, ptr addrspace(7) [[TMP7]], align 2
; CHECK-NEXT:    [[TMP8:%.*]] = insertelement <16 x half> poison, half [[A1]], i64 0
; CHECK-NEXT:    [[TMP9:%.*]] = add i32 [[TMP4]], 160
; CHECK-NEXT:    [[TMP10:%.*]] = add i32 [[TMP9]], 0
; CHECK-NEXT:    [[TMP11:%.*]] = getelementptr half, ptr addrspace(7) [[PTR]], i32 [[TMP10]]
; CHECK-NEXT:    [[A2:%.*]] = load half, ptr addrspace(7) [[TMP11]], align 2
; CHECK-NEXT:    [[TMP12:%.*]] = insertelement <16 x half> [[TMP8]], half [[A2]], i64 1
; CHECK-NEXT:    [[TMP13:%.*]] = add i32 [[TMP4]], 320
; CHECK-NEXT:    [[TMP14:%.*]] = add i32 [[TMP13]], 0
; CHECK-NEXT:    [[TMP15:%.*]] = getelementptr half, ptr addrspace(7) [[PTR]], i32 [[TMP14]]
; CHECK-NEXT:    [[A3:%.*]] = load half, ptr addrspace(7) [[TMP15]], align 2
; CHECK-NEXT:    [[TMP16:%.*]] = insertelement <16 x half> [[TMP12]], half [[A3]], i64 2
; CHECK-NEXT:    [[TMP17:%.*]] = add i32 [[TMP4]], 480
; CHECK-NEXT:    [[TMP18:%.*]] = add i32 [[TMP17]], 0
; CHECK-NEXT:    [[TMP19:%.*]] = getelementptr half, ptr addrspace(7) [[PTR]], i32 [[TMP18]]
; CHECK-NEXT:    [[A4:%.*]] = load half, ptr addrspace(7) [[TMP19]], align 2
; CHECK-NEXT:    [[TMP20:%.*]] = insertelement <16 x half> [[TMP16]], half [[A4]], i64 3
; CHECK-NEXT:    [[TMP21:%.*]] = add i32 [[TMP4]], 640
; CHECK-NEXT:    [[TMP22:%.*]] = add i32 [[TMP21]], 0
; CHECK-NEXT:    [[TMP23:%.*]] = getelementptr half, ptr addrspace(7) [[PTR]], i32 [[TMP22]]
; CHECK-NEXT:    [[A5:%.*]] = load half, ptr addrspace(7) [[TMP23]], align 2
; CHECK-NEXT:    [[TMP24:%.*]] = insertelement <16 x half> [[TMP20]], half [[A5]], i64 4
; CHECK-NEXT:    [[TMP25:%.*]] = add i32 [[TMP4]], 800
; CHECK-NEXT:    [[TMP26:%.*]] = add i32 [[TMP25]], 0
; CHECK-NEXT:    [[TMP27:%.*]] = getelementptr half, ptr addrspace(7) [[PTR]], i32 [[TMP26]]
; CHECK-NEXT:    [[A6:%.*]] = load half, ptr addrspace(7) [[TMP27]], align 2
; CHECK-NEXT:    [[TMP28:%.*]] = insertelement <16 x half> [[TMP24]], half [[A6]], i64 5
; CHECK-NEXT:    [[TMP29:%.*]] = add i32 [[TMP4]], 960
; CHECK-NEXT:    [[TMP30:%.*]] = add i32 [[TMP29]], 0
; CHECK-NEXT:    [[TMP31:%.*]] = getelementptr half, ptr addrspace(7) [[PTR]], i32 [[TMP30]]
; CHECK-NEXT:    [[A7:%.*]] = load half, ptr addrspace(7) [[TMP31]], align 2
; CHECK-NEXT:    [[TMP32:%.*]] = insertelement <16 x half> [[TMP28]], half [[A7]], i64 6
; CHECK-NEXT:    [[TMP33:%.*]] = add i32 [[TMP4]], 1120
; CHECK-NEXT:    [[TMP34:%.*]] = add i32 [[TMP33]], 0
; CHECK-NEXT:    [[TMP35:%.*]] = getelementptr half, ptr addrspace(7) [[PTR]], i32 [[TMP34]]
; CHECK-NEXT:    [[A8:%.*]] = load half, ptr addrspace(7) [[TMP35]], align 2
; CHECK-NEXT:    [[TMP36:%.*]] = insertelement <16 x half> [[TMP32]], half [[A8]], i64 7
; CHECK-NEXT:    [[TMP37:%.*]] = add i32 [[TMP4]], 1280
; CHECK-NEXT:    [[TMP38:%.*]] = add i32 [[TMP37]], 0
; CHECK-NEXT:    [[TMP39:%.*]] = getelementptr half, ptr addrspace(7) [[PTR]], i32 [[TMP38]]
; CHECK-NEXT:    [[A9:%.*]] = load half, ptr addrspace(7) [[TMP39]], align 2
; CHECK-NEXT:    [[TMP40:%.*]] = insertelement <16 x half> [[TMP36]], half [[A9]], i64 8
; CHECK-NEXT:    [[TMP41:%.*]] = add i32 [[TMP4]], 1440
; CHECK-NEXT:    [[TMP42:%.*]] = add i32 [[TMP41]], 0
; CHECK-NEXT:    [[TMP43:%.*]] = getelementptr half, ptr addrspace(7) [[PTR]], i32 [[TMP42]]
; CHECK-NEXT:    [[A10:%.*]] = load half, ptr addrspace(7) [[TMP43]], align 2
; CHECK-NEXT:    [[TMP44:%.*]] = insertelement <16 x half> [[TMP40]], half [[A10]], i64 9
; CHECK-NEXT:    [[TMP45:%.*]] = add i32 [[TMP4]], 1600
; CHECK-NEXT:    [[TMP46:%.*]] = add i32 [[TMP45]], 0
; CHECK-NEXT:    [[TMP47:%.*]] = getelementptr half, ptr addrspace(7) [[PTR]], i32 [[TMP46]]
; CHECK-NEXT:    [[A11:%.*]] = load half, ptr addrspace(7) [[TMP47]], align 2
; CHECK-NEXT:    [[TMP48:%.*]] = insertelement <16 x half> [[TMP44]], half [[A11]], i64 10
; CHECK-NEXT:    [[TMP49:%.*]] = add i32 [[TMP4]], 1760
; CHECK-NEXT:    [[TMP50:%.*]] = add i32 [[TMP49]], 0
; CHECK-NEXT:    [[TMP51:%.*]] = getelementptr half, ptr addrspace(7) [[PTR]], i32 [[TMP50]]
; CHECK-NEXT:    [[A12:%.*]] = load half, ptr addrspace(7) [[TMP51]], align 2
; CHECK-NEXT:    [[TMP52:%.*]] = insertelement <16 x half> [[TMP48]], half [[A12]], i64 11
; CHECK-NEXT:    [[TMP53:%.*]] = add i32 [[TMP4]], 1920
; CHECK-NEXT:    [[TMP54:%.*]] = add i32 [[TMP53]], 0
; CHECK-NEXT:    [[TMP55:%.*]] = getelementptr half, ptr addrspace(7) [[PTR]], i32 [[TMP54]]
; CHECK-NEXT:    [[A13:%.*]] = load half, ptr addrspace(7) [[TMP55]], align 2
; CHECK-NEXT:    [[TMP56:%.*]] = insertelement <16 x half> [[TMP52]], half [[A13]], i64 12
; CHECK-NEXT:    [[TMP57:%.*]] = add i32 [[TMP4]], 2080
; CHECK-NEXT:    [[TMP58:%.*]] = add i32 [[TMP57]], 0
; CHECK-NEXT:    [[TMP59:%.*]] = getelementptr half, ptr addrspace(7) [[PTR]], i32 [[TMP58]]
; CHECK-NEXT:    [[A14:%.*]] = load half, ptr addrspace(7) [[TMP59]], align 2
; CHECK-NEXT:    [[TMP60:%.*]] = insertelement <16 x half> [[TMP56]], half [[A14]], i64 13
; CHECK-NEXT:    [[TMP61:%.*]] = add i32 [[TMP4]], 2240
; CHECK-NEXT:    [[TMP62:%.*]] = add i32 [[TMP61]], 0
; CHECK-NEXT:    [[TMP63:%.*]] = getelementptr half, ptr addrspace(7) [[PTR]], i32 [[TMP62]]
; CHECK-NEXT:    [[A15:%.*]] = load half, ptr addrspace(7) [[TMP63]], align 2
; CHECK-NEXT:    [[TMP64:%.*]] = insertelement <16 x half> [[TMP60]], half [[A15]], i64 14
; CHECK-NEXT:    [[TMP65:%.*]] = add i32 [[TMP4]], 2400
; CHECK-NEXT:    [[TMP66:%.*]] = add i32 [[TMP65]], 0
; CHECK-NEXT:    [[TMP67:%.*]] = getelementptr half, ptr addrspace(7) [[PTR]], i32 [[TMP66]]
; CHECK-NEXT:    [[A16:%.*]] = load half, ptr addrspace(7) [[TMP67]], align 2
; CHECK-NEXT:    [[TMP68:%.*]] = insertelement <16 x half> [[TMP64]], half [[A16]], i64 15
; CHECK-NEXT:    [[TMP69:%.*]] = bitcast <16 x half> [[TMP68]] to <8 x float>
; CHECK-NEXT:    ret <8 x float> [[TMP69]]
;
  %a = call <8 x float> @lgc.cooperative.matrix.load.v8f32.p7.i32.i1.i32.i32.i32(ptr addrspace(7) %ptr, i32 320, i1 false, i32 1, i32 0, i32 0)
  ret <8 x float> %a
}

define <8 x float> @test_f16_cd_layout(ptr addrspace(7) %ptr) !spirv.ExecutionModel !8 !lgc.shaderstage !9 {
; CHECK-LABEL: @test_f16_cd_layout(
; CHECK-NEXT:    [[TMP1:%.*]] = call i32 @llvm.amdgcn.mbcnt.lo(i32 -1, i32 0)
; CHECK-NEXT:    [[TMP2:%.*]] = call i32 @llvm.amdgcn.mbcnt.hi(i32 -1, i32 [[TMP1]])
; CHECK-NEXT:    [[TMP3:%.*]] = srem i32 [[TMP2]], 16
; CHECK-NEXT:    [[TMP4:%.*]] = udiv i32 [[TMP2]], 16
; CHECK-NEXT:    [[TMP5:%.*]] = mul i32 [[TMP4]], 160
; CHECK-NEXT:    [[TMP6:%.*]] = add i32 [[TMP5]], [[TMP3]]
; CHECK-NEXT:    [[TMP7:%.*]] = add i32 [[TMP6]], 0
; CHECK-NEXT:    [[TMP8:%.*]] = add i32 [[TMP7]], 0
; CHECK-NEXT:    [[TMP9:%.*]] = getelementptr half, ptr addrspace(7) [[PTR:%.*]], i32 [[TMP8]]
; CHECK-NEXT:    [[A1:%.*]] = load half, ptr addrspace(7) [[TMP9]], align 2
; CHECK-NEXT:    [[TMP10:%.*]] = insertelement <4 x half> poison, half [[A1]], i64 0
; CHECK-NEXT:    [[TMP11:%.*]] = add i32 [[TMP6]], 640
; CHECK-NEXT:    [[TMP12:%.*]] = add i32 [[TMP11]], 0
; CHECK-NEXT:    [[TMP13:%.*]] = getelementptr half, ptr addrspace(7) [[PTR]], i32 [[TMP12]]
; CHECK-NEXT:    [[A2:%.*]] = load half, ptr addrspace(7) [[TMP13]], align 2
; CHECK-NEXT:    [[TMP14:%.*]] = insertelement <4 x half> [[TMP10]], half [[A2]], i64 1
; CHECK-NEXT:    [[TMP15:%.*]] = add i32 [[TMP6]], 1280
; CHECK-NEXT:    [[TMP16:%.*]] = add i32 [[TMP15]], 0
; CHECK-NEXT:    [[TMP17:%.*]] = getelementptr half, ptr addrspace(7) [[PTR]], i32 [[TMP16]]
; CHECK-NEXT:    [[A3:%.*]] = load half, ptr addrspace(7) [[TMP17]], align 2
; CHECK-NEXT:    [[TMP18:%.*]] = insertelement <4 x half> [[TMP14]], half [[A3]], i64 2
; CHECK-NEXT:    [[TMP19:%.*]] = add i32 [[TMP6]], 1920
; CHECK-NEXT:    [[TMP20:%.*]] = add i32 [[TMP19]], 0
; CHECK-NEXT:    [[TMP21:%.*]] = getelementptr half, ptr addrspace(7) [[PTR]], i32 [[TMP20]]
; CHECK-NEXT:    [[A4:%.*]] = load half, ptr addrspace(7) [[TMP21]], align 2
; CHECK-NEXT:    [[TMP22:%.*]] = insertelement <4 x half> [[TMP18]], half [[A4]], i64 3
; CHECK-NEXT:    [[TMP23:%.*]] = shufflevector <4 x half> [[TMP22]], <4 x half> poison, <16 x i32> <i32 0, i32 poison, i32 1, i32 poison, i32 2, i32 poison, i32 3, i32 poison, i32 4, i32 poison, i32 5, i32 poison, i32 6, i32 poison, i32 7, i32 poison>
; CHECK-NEXT:    [[TMP24:%.*]] = bitcast <16 x half> [[TMP23]] to <8 x float>
; CHECK-NEXT:    ret <8 x float> [[TMP24]]
;
  %a = call <8 x float> @lgc.cooperative.matrix.load.v8f32.p7.i32.i1.i32.i32.i32(ptr addrspace(7) %ptr, i32 320, i1 false, i32 1, i32 1, i32 0)
  ret <8 x float> %a
}

define <8 x i32> @test_i16_ab_layout(ptr addrspace(7) %ptr) !spirv.ExecutionModel !8 !lgc.shaderstage !9 {
; CHECK-LABEL: @test_i16_ab_layout(
; CHECK-NEXT:    [[TMP1:%.*]] = call i32 @llvm.amdgcn.mbcnt.lo(i32 -1, i32 0)
; CHECK-NEXT:    [[TMP2:%.*]] = call i32 @llvm.amdgcn.mbcnt.hi(i32 -1, i32 [[TMP1]])
; CHECK-NEXT:    [[TMP3:%.*]] = srem i32 [[TMP2]], 16
; CHECK-NEXT:    [[TMP4:%.*]] = add i32 0, [[TMP3]]
; CHECK-NEXT:    [[TMP5:%.*]] = add i32 [[TMP4]], 0
; CHECK-NEXT:    [[TMP6:%.*]] = add i32 [[TMP5]], 0
; CHECK-NEXT:    [[TMP7:%.*]] = getelementptr i16, ptr addrspace(7) [[PTR:%.*]], i32 [[TMP6]]
; CHECK-NEXT:    [[A1:%.*]] = load i16, ptr addrspace(7) [[TMP7]], align 2
; CHECK-NEXT:    [[TMP8:%.*]] = insertelement <16 x i16> poison, i16 [[A1]], i64 0
; CHECK-NEXT:    [[TMP9:%.*]] = add i32 [[TMP4]], 160
; CHECK-NEXT:    [[TMP10:%.*]] = add i32 [[TMP9]], 0
; CHECK-NEXT:    [[TMP11:%.*]] = getelementptr i16, ptr addrspace(7) [[PTR]], i32 [[TMP10]]
; CHECK-NEXT:    [[A2:%.*]] = load i16, ptr addrspace(7) [[TMP11]], align 2
; CHECK-NEXT:    [[TMP12:%.*]] = insertelement <16 x i16> [[TMP8]], i16 [[A2]], i64 1
; CHECK-NEXT:    [[TMP13:%.*]] = add i32 [[TMP4]], 320
; CHECK-NEXT:    [[TMP14:%.*]] = add i32 [[TMP13]], 0
; CHECK-NEXT:    [[TMP15:%.*]] = getelementptr i16, ptr addrspace(7) [[PTR]], i32 [[TMP14]]
; CHECK-NEXT:    [[A3:%.*]] = load i16, ptr addrspace(7) [[TMP15]], align 2
; CHECK-NEXT:    [[TMP16:%.*]] = insertelement <16 x i16> [[TMP12]], i16 [[A3]], i64 2
; CHECK-NEXT:    [[TMP17:%.*]] = add i32 [[TMP4]], 480
; CHECK-NEXT:    [[TMP18:%.*]] = add i32 [[TMP17]], 0
; CHECK-NEXT:    [[TMP19:%.*]] = getelementptr i16, ptr addrspace(7) [[PTR]], i32 [[TMP18]]
; CHECK-NEXT:    [[A4:%.*]] = load i16, ptr addrspace(7) [[TMP19]], align 2
; CHECK-NEXT:    [[TMP20:%.*]] = insertelement <16 x i16> [[TMP16]], i16 [[A4]], i64 3
; CHECK-NEXT:    [[TMP21:%.*]] = add i32 [[TMP4]], 640
; CHECK-NEXT:    [[TMP22:%.*]] = add i32 [[TMP21]], 0
; CHECK-NEXT:    [[TMP23:%.*]] = getelementptr i16, ptr addrspace(7) [[PTR]], i32 [[TMP22]]
; CHECK-NEXT:    [[A5:%.*]] = load i16, ptr addrspace(7) [[TMP23]], align 2
; CHECK-NEXT:    [[TMP24:%.*]] = insertelement <16 x i16> [[TMP20]], i16 [[A5]], i64 4
; CHECK-NEXT:    [[TMP25:%.*]] = add i32 [[TMP4]], 800
; CHECK-NEXT:    [[TMP26:%.*]] = add i32 [[TMP25]], 0
; CHECK-NEXT:    [[TMP27:%.*]] = getelementptr i16, ptr addrspace(7) [[PTR]], i32 [[TMP26]]
; CHECK-NEXT:    [[A6:%.*]] = load i16, ptr addrspace(7) [[TMP27]], align 2
; CHECK-NEXT:    [[TMP28:%.*]] = insertelement <16 x i16> [[TMP24]], i16 [[A6]], i64 5
; CHECK-NEXT:    [[TMP29:%.*]] = add i32 [[TMP4]], 960
; CHECK-NEXT:    [[TMP30:%.*]] = add i32 [[TMP29]], 0
; CHECK-NEXT:    [[TMP31:%.*]] = getelementptr i16, ptr addrspace(7) [[PTR]], i32 [[TMP30]]
; CHECK-NEXT:    [[A7:%.*]] = load i16, ptr addrspace(7) [[TMP31]], align 2
; CHECK-NEXT:    [[TMP32:%.*]] = insertelement <16 x i16> [[TMP28]], i16 [[A7]], i64 6
; CHECK-NEXT:    [[TMP33:%.*]] = add i32 [[TMP4]], 1120
; CHECK-NEXT:    [[TMP34:%.*]] = add i32 [[TMP33]], 0
; CHECK-NEXT:    [[TMP35:%.*]] = getelementptr i16, ptr addrspace(7) [[PTR]], i32 [[TMP34]]
; CHECK-NEXT:    [[A8:%.*]] = load i16, ptr addrspace(7) [[TMP35]], align 2
; CHECK-NEXT:    [[TMP36:%.*]] = insertelement <16 x i16> [[TMP32]], i16 [[A8]], i64 7
; CHECK-NEXT:    [[TMP37:%.*]] = add i32 [[TMP4]], 1280
; CHECK-NEXT:    [[TMP38:%.*]] = add i32 [[TMP37]], 0
; CHECK-NEXT:    [[TMP39:%.*]] = getelementptr i16, ptr addrspace(7) [[PTR]], i32 [[TMP38]]
; CHECK-NEXT:    [[A9:%.*]] = load i16, ptr addrspace(7) [[TMP39]], align 2
; CHECK-NEXT:    [[TMP40:%.*]] = insertelement <16 x i16> [[TMP36]], i16 [[A9]], i64 8
; CHECK-NEXT:    [[TMP41:%.*]] = add i32 [[TMP4]], 1440
; CHECK-NEXT:    [[TMP42:%.*]] = add i32 [[TMP41]], 0
; CHECK-NEXT:    [[TMP43:%.*]] = getelementptr i16, ptr addrspace(7) [[PTR]], i32 [[TMP42]]
; CHECK-NEXT:    [[A10:%.*]] = load i16, ptr addrspace(7) [[TMP43]], align 2
; CHECK-NEXT:    [[TMP44:%.*]] = insertelement <16 x i16> [[TMP40]], i16 [[A10]], i64 9
; CHECK-NEXT:    [[TMP45:%.*]] = add i32 [[TMP4]], 1600
; CHECK-NEXT:    [[TMP46:%.*]] = add i32 [[TMP45]], 0
; CHECK-NEXT:    [[TMP47:%.*]] = getelementptr i16, ptr addrspace(7) [[PTR]], i32 [[TMP46]]
; CHECK-NEXT:    [[A11:%.*]] = load i16, ptr addrspace(7) [[TMP47]], align 2
; CHECK-NEXT:    [[TMP48:%.*]] = insertelement <16 x i16> [[TMP44]], i16 [[A11]], i64 10
; CHECK-NEXT:    [[TMP49:%.*]] = add i32 [[TMP4]], 1760
; CHECK-NEXT:    [[TMP50:%.*]] = add i32 [[TMP49]], 0
; CHECK-NEXT:    [[TMP51:%.*]] = getelementptr i16, ptr addrspace(7) [[PTR]], i32 [[TMP50]]
; CHECK-NEXT:    [[A12:%.*]] = load i16, ptr addrspace(7) [[TMP51]], align 2
; CHECK-NEXT:    [[TMP52:%.*]] = insertelement <16 x i16> [[TMP48]], i16 [[A12]], i64 11
; CHECK-NEXT:    [[TMP53:%.*]] = add i32 [[TMP4]], 1920
; CHECK-NEXT:    [[TMP54:%.*]] = add i32 [[TMP53]], 0
; CHECK-NEXT:    [[TMP55:%.*]] = getelementptr i16, ptr addrspace(7) [[PTR]], i32 [[TMP54]]
; CHECK-NEXT:    [[A13:%.*]] = load i16, ptr addrspace(7) [[TMP55]], align 2
; CHECK-NEXT:    [[TMP56:%.*]] = insertelement <16 x i16> [[TMP52]], i16 [[A13]], i64 12
; CHECK-NEXT:    [[TMP57:%.*]] = add i32 [[TMP4]], 2080
; CHECK-NEXT:    [[TMP58:%.*]] = add i32 [[TMP57]], 0
; CHECK-NEXT:    [[TMP59:%.*]] = getelementptr i16, ptr addrspace(7) [[PTR]], i32 [[TMP58]]
; CHECK-NEXT:    [[A14:%.*]] = load i16, ptr addrspace(7) [[TMP59]], align 2
; CHECK-NEXT:    [[TMP60:%.*]] = insertelement <16 x i16> [[TMP56]], i16 [[A14]], i64 13
; CHECK-NEXT:    [[TMP61:%.*]] = add i32 [[TMP4]], 2240
; CHECK-NEXT:    [[TMP62:%.*]] = add i32 [[TMP61]], 0
; CHECK-NEXT:    [[TMP63:%.*]] = getelementptr i16, ptr addrspace(7) [[PTR]], i32 [[TMP62]]
; CHECK-NEXT:    [[A15:%.*]] = load i16, ptr addrspace(7) [[TMP63]], align 2
; CHECK-NEXT:    [[TMP64:%.*]] = insertelement <16 x i16> [[TMP60]], i16 [[A15]], i64 14
; CHECK-NEXT:    [[TMP65:%.*]] = add i32 [[TMP4]], 2400
; CHECK-NEXT:    [[TMP66:%.*]] = add i32 [[TMP65]], 0
; CHECK-NEXT:    [[TMP67:%.*]] = getelementptr i16, ptr addrspace(7) [[PTR]], i32 [[TMP66]]
; CHECK-NEXT:    [[A16:%.*]] = load i16, ptr addrspace(7) [[TMP67]], align 2
; CHECK-NEXT:    [[TMP68:%.*]] = insertelement <16 x i16> [[TMP64]], i16 [[A16]], i64 15
; CHECK-NEXT:    [[TMP69:%.*]] = bitcast <16 x i16> [[TMP68]] to <8 x i32>
; CHECK-NEXT:    ret <8 x i32> [[TMP69]]
;
  %a = call <8 x i32> @lgc.cooperative.matrix.load.v8i32.p7.i32.i1.i32.i32.i32(ptr addrspace(7) %ptr, i32 320, i1 false, i32 4, i32 0, i32 0)
  ret <8 x i32> %a
}

define <8 x i32> @test_i16_cd_layout(ptr addrspace(7) %ptr) !spirv.ExecutionModel !8 !lgc.shaderstage !9 {
; CHECK-LABEL: @test_i16_cd_layout(
; CHECK-NEXT:    [[TMP1:%.*]] = call i32 @llvm.amdgcn.mbcnt.lo(i32 -1, i32 0)
; CHECK-NEXT:    [[TMP2:%.*]] = call i32 @llvm.amdgcn.mbcnt.hi(i32 -1, i32 [[TMP1]])
; CHECK-NEXT:    [[TMP3:%.*]] = srem i32 [[TMP2]], 16
; CHECK-NEXT:    [[TMP4:%.*]] = udiv i32 [[TMP2]], 16
; CHECK-NEXT:    [[TMP5:%.*]] = mul i32 [[TMP4]], 160
; CHECK-NEXT:    [[TMP6:%.*]] = add i32 [[TMP5]], [[TMP3]]
; CHECK-NEXT:    [[TMP7:%.*]] = add i32 [[TMP6]], 0
; CHECK-NEXT:    [[TMP8:%.*]] = add i32 [[TMP7]], 0
; CHECK-NEXT:    [[TMP9:%.*]] = getelementptr i16, ptr addrspace(7) [[PTR:%.*]], i32 [[TMP8]]
; CHECK-NEXT:    [[A1:%.*]] = load i16, ptr addrspace(7) [[TMP9]], align 2
; CHECK-NEXT:    [[TMP10:%.*]] = insertelement <4 x i16> poison, i16 [[A1]], i64 0
; CHECK-NEXT:    [[TMP11:%.*]] = add i32 [[TMP6]], 640
; CHECK-NEXT:    [[TMP12:%.*]] = add i32 [[TMP11]], 0
; CHECK-NEXT:    [[TMP13:%.*]] = getelementptr i16, ptr addrspace(7) [[PTR]], i32 [[TMP12]]
; CHECK-NEXT:    [[A2:%.*]] = load i16, ptr addrspace(7) [[TMP13]], align 2
; CHECK-NEXT:    [[TMP14:%.*]] = insertelement <4 x i16> [[TMP10]], i16 [[A2]], i64 1
; CHECK-NEXT:    [[TMP15:%.*]] = add i32 [[TMP6]], 1280
; CHECK-NEXT:    [[TMP16:%.*]] = add i32 [[TMP15]], 0
; CHECK-NEXT:    [[TMP17:%.*]] = getelementptr i16, ptr addrspace(7) [[PTR]], i32 [[TMP16]]
; CHECK-NEXT:    [[A3:%.*]] = load i16, ptr addrspace(7) [[TMP17]], align 2
; CHECK-NEXT:    [[TMP18:%.*]] = insertelement <4 x i16> [[TMP14]], i16 [[A3]], i64 2
; CHECK-NEXT:    [[TMP19:%.*]] = add i32 [[TMP6]], 1920
; CHECK-NEXT:    [[TMP20:%.*]] = add i32 [[TMP19]], 0
; CHECK-NEXT:    [[TMP21:%.*]] = getelementptr i16, ptr addrspace(7) [[PTR]], i32 [[TMP20]]
; CHECK-NEXT:    [[A4:%.*]] = load i16, ptr addrspace(7) [[TMP21]], align 2
; CHECK-NEXT:    [[TMP22:%.*]] = insertelement <4 x i16> [[TMP18]], i16 [[A4]], i64 3
; CHECK-NEXT:    [[TMP23:%.*]] = shufflevector <4 x i16> [[TMP22]], <4 x i16> poison, <16 x i32> <i32 0, i32 poison, i32 1, i32 poison, i32 2, i32 poison, i32 3, i32 poison, i32 4, i32 poison, i32 5, i32 poison, i32 6, i32 poison, i32 7, i32 poison>
; CHECK-NEXT:    [[TMP24:%.*]] = bitcast <16 x i16> [[TMP23]] to <8 x i32>
; CHECK-NEXT:    ret <8 x i32> [[TMP24]]
;
  %a = call <8 x i32> @lgc.cooperative.matrix.load.v8i32.p7.i32.i1.i32.i32.i32(ptr addrspace(7) %ptr, i32 320, i1 false, i32 4, i32 1, i32 0)
  ret <8 x i32> %a
}

define <8 x float> @test_f32_cd_layout(ptr addrspace(7) %ptr) !spirv.ExecutionModel !8 !lgc.shaderstage !9 {
; CHECK-LABEL: @test_f32_cd_layout(
; CHECK-NEXT:    [[TMP1:%.*]] = call i32 @llvm.amdgcn.mbcnt.lo(i32 -1, i32 0)
; CHECK-NEXT:    [[TMP2:%.*]] = call i32 @llvm.amdgcn.mbcnt.hi(i32 -1, i32 [[TMP1]])
; CHECK-NEXT:    [[TMP3:%.*]] = srem i32 [[TMP2]], 16
; CHECK-NEXT:    [[TMP4:%.*]] = udiv i32 [[TMP2]], 16
; CHECK-NEXT:    [[TMP5:%.*]] = mul i32 [[TMP4]], 160
; CHECK-NEXT:    [[TMP6:%.*]] = add i32 [[TMP5]], [[TMP3]]
; CHECK-NEXT:    [[TMP7:%.*]] = add i32 [[TMP6]], 0
; CHECK-NEXT:    [[TMP8:%.*]] = add i32 [[TMP7]], 0
; CHECK-NEXT:    [[TMP9:%.*]] = getelementptr float, ptr addrspace(7) [[PTR:%.*]], i32 [[TMP8]]
; CHECK-NEXT:    [[A1:%.*]] = load float, ptr addrspace(7) [[TMP9]], align 4
; CHECK-NEXT:    [[TMP10:%.*]] = insertelement <4 x float> poison, float [[A1]], i64 0
; CHECK-NEXT:    [[TMP11:%.*]] = add i32 [[TMP6]], 640
; CHECK-NEXT:    [[TMP12:%.*]] = add i32 [[TMP11]], 0
; CHECK-NEXT:    [[TMP13:%.*]] = getelementptr float, ptr addrspace(7) [[PTR]], i32 [[TMP12]]
; CHECK-NEXT:    [[A2:%.*]] = load float, ptr addrspace(7) [[TMP13]], align 4
; CHECK-NEXT:    [[TMP14:%.*]] = insertelement <4 x float> [[TMP10]], float [[A2]], i64 1
; CHECK-NEXT:    [[TMP15:%.*]] = add i32 [[TMP6]], 1280
; CHECK-NEXT:    [[TMP16:%.*]] = add i32 [[TMP15]], 0
; CHECK-NEXT:    [[TMP17:%.*]] = getelementptr float, ptr addrspace(7) [[PTR]], i32 [[TMP16]]
; CHECK-NEXT:    [[A3:%.*]] = load float, ptr addrspace(7) [[TMP17]], align 4
; CHECK-NEXT:    [[TMP18:%.*]] = insertelement <4 x float> [[TMP14]], float [[A3]], i64 2
; CHECK-NEXT:    [[TMP19:%.*]] = add i32 [[TMP6]], 1920
; CHECK-NEXT:    [[TMP20:%.*]] = add i32 [[TMP19]], 0
; CHECK-NEXT:    [[TMP21:%.*]] = getelementptr float, ptr addrspace(7) [[PTR]], i32 [[TMP20]]
; CHECK-NEXT:    [[A4:%.*]] = load float, ptr addrspace(7) [[TMP21]], align 4
; CHECK-NEXT:    [[TMP22:%.*]] = insertelement <4 x float> [[TMP18]], float [[A4]], i64 3
; CHECK-NEXT:    [[TMP23:%.*]] = shufflevector <4 x float> [[TMP22]], <4 x float> poison, <8 x i32> <i32 0, i32 1, i32 2, i32 3, i32 4, i32 5, i32 6, i32 7>
; CHECK-NEXT:    ret <8 x float> [[TMP23]]
;
  %a = call <8 x float> @lgc.cooperative.matrix.load.v8f32.p7.i32.i1.i32.i32.i32(ptr addrspace(7) %ptr, i32 640, i1 false, i32 2, i32 1, i32 0)
  ret <8 x float> %a
}

define <8 x i32> @test_i32_cd_layout(ptr addrspace(7) %ptr) !spirv.ExecutionModel !8 !lgc.shaderstage !9 {
; CHECK-LABEL: @test_i32_cd_layout(
; CHECK-NEXT:    [[TMP1:%.*]] = call i32 @llvm.amdgcn.mbcnt.lo(i32 -1, i32 0)
; CHECK-NEXT:    [[TMP2:%.*]] = call i32 @llvm.amdgcn.mbcnt.hi(i32 -1, i32 [[TMP1]])
; CHECK-NEXT:    [[TMP3:%.*]] = srem i32 [[TMP2]], 16
; CHECK-NEXT:    [[TMP4:%.*]] = udiv i32 [[TMP2]], 16
; CHECK-NEXT:    [[TMP5:%.*]] = mul i32 [[TMP4]], 160
; CHECK-NEXT:    [[TMP6:%.*]] = add i32 [[TMP5]], [[TMP3]]
; CHECK-NEXT:    [[TMP7:%.*]] = add i32 [[TMP6]], 0
; CHECK-NEXT:    [[TMP8:%.*]] = add i32 [[TMP7]], 0
; CHECK-NEXT:    [[TMP9:%.*]] = getelementptr i32, ptr addrspace(7) [[PTR:%.*]], i32 [[TMP8]]
; CHECK-NEXT:    [[A1:%.*]] = load i32, ptr addrspace(7) [[TMP9]], align 4
; CHECK-NEXT:    [[TMP10:%.*]] = insertelement <4 x i32> poison, i32 [[A1]], i64 0
; CHECK-NEXT:    [[TMP11:%.*]] = add i32 [[TMP6]], 640
; CHECK-NEXT:    [[TMP12:%.*]] = add i32 [[TMP11]], 0
; CHECK-NEXT:    [[TMP13:%.*]] = getelementptr i32, ptr addrspace(7) [[PTR]], i32 [[TMP12]]
; CHECK-NEXT:    [[A2:%.*]] = load i32, ptr addrspace(7) [[TMP13]], align 4
; CHECK-NEXT:    [[TMP14:%.*]] = insertelement <4 x i32> [[TMP10]], i32 [[A2]], i64 1
; CHECK-NEXT:    [[TMP15:%.*]] = add i32 [[TMP6]], 1280
; CHECK-NEXT:    [[TMP16:%.*]] = add i32 [[TMP15]], 0
; CHECK-NEXT:    [[TMP17:%.*]] = getelementptr i32, ptr addrspace(7) [[PTR]], i32 [[TMP16]]
; CHECK-NEXT:    [[A3:%.*]] = load i32, ptr addrspace(7) [[TMP17]], align 4
; CHECK-NEXT:    [[TMP18:%.*]] = insertelement <4 x i32> [[TMP14]], i32 [[A3]], i64 2
; CHECK-NEXT:    [[TMP19:%.*]] = add i32 [[TMP6]], 1920
; CHECK-NEXT:    [[TMP20:%.*]] = add i32 [[TMP19]], 0
; CHECK-NEXT:    [[TMP21:%.*]] = getelementptr i32, ptr addrspace(7) [[PTR]], i32 [[TMP20]]
; CHECK-NEXT:    [[A4:%.*]] = load i32, ptr addrspace(7) [[TMP21]], align 4
; CHECK-NEXT:    [[TMP22:%.*]] = insertelement <4 x i32> [[TMP18]], i32 [[A4]], i64 3
; CHECK-NEXT:    [[TMP23:%.*]] = shufflevector <4 x i32> [[TMP22]], <4 x i32> poison, <8 x i32> <i32 0, i32 1, i32 2, i32 3, i32 4, i32 5, i32 6, i32 7>
; CHECK-NEXT:    ret <8 x i32> [[TMP23]]
;
  %a = call <8 x i32> @lgc.cooperative.matrix.load.v8i32.p7.i32.i1.i32.i32.i32(ptr addrspace(7) %ptr, i32 640, i1 false, i32 5, i32 1, i32 0)
  ret <8 x i32> %a
}

declare <8 x float> @lgc.cooperative.matrix.load.v8f32.p7.i32.i1.i32.i32.i32(ptr addrspace(7), i32, i1, i32, i32, i32)
declare <8 x i32> @lgc.cooperative.matrix.load.v8i32.p7.i32.i1.i32.i32.i32(ptr addrspace(7), i32, i1, i32, i32, i32)

!llpc.compute.mode = !{!0}
!lgc.client = !{!1}
!lgc.options = !{!2}
!lgc.options.CS = !{!3}

!0 = !{i32 128, i32 2, i32 1}
!1 = !{!"Vulkan"}
!2 = !{i32 -2108299168, i32 -1199997545, i32 1667044824, i32 -422575072, i32 1, i32 0, i32 0, i32 0, i32 0, i32 0, i32 0, i32 0, i32 0, i32 0, i32 1, i32 0, i32 0, i32 -1}
!3 = !{i32 219437737, i32 -1317595285, i32 0, i32 0, i32 0, i32 0, i32 0, i32 0, i32 0, i32 0, i32 64, i32 64, i32 0, i32 0, i32 3, i32 0, i32 0, i32 0, i32 0, i32 0, i32 0, i32 20, i32 1800}
!8 = !{i32 5}
!9 = !{i32 7}
