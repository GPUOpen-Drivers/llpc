; NOTE: Assertions have been autogenerated by utils/update_test_checks.py UTC_ARGS: --tool lgc
; RUN: lgc -o - -passes=lgc-lower-cooperative-matrix %s | FileCheck --check-prefixes=CHECK %s

define void @test_f16_ab_layout(ptr addrspace(7) %ptr, <8 x float> %a) !spirv.ExecutionModel !8 !lgc.shaderstage !9 {
; CHECK-LABEL: @test_f16_ab_layout(
; CHECK-NEXT:    [[TMP1:%.*]] = call i32 @llvm.amdgcn.mbcnt.lo(i32 -1, i32 0)
; CHECK-NEXT:    [[TMP2:%.*]] = call i32 @llvm.amdgcn.mbcnt.hi(i32 -1, i32 [[TMP1]])
; CHECK-NEXT:    [[TMP3:%.*]] = srem i32 [[TMP2]], 16
; CHECK-NEXT:    [[TMP4:%.*]] = add i32 0, [[TMP3]]
; CHECK-NEXT:    [[TMP5:%.*]] = bitcast <8 x float> [[A:%.*]] to <16 x half>
; CHECK-NEXT:    [[TMP6:%.*]] = add i32 [[TMP4]], 0
; CHECK-NEXT:    [[TMP7:%.*]] = add i32 [[TMP6]], 0
; CHECK-NEXT:    [[TMP8:%.*]] = getelementptr half, ptr addrspace(7) [[PTR:%.*]], i32 [[TMP7]]
; CHECK-NEXT:    [[TMP9:%.*]] = extractelement <16 x half> [[TMP5]], i64 0
; CHECK-NEXT:    store half [[TMP9]], ptr addrspace(7) [[TMP8]], align 2
; CHECK-NEXT:    [[TMP10:%.*]] = add i32 [[TMP4]], 160
; CHECK-NEXT:    [[TMP11:%.*]] = add i32 [[TMP10]], 0
; CHECK-NEXT:    [[TMP12:%.*]] = getelementptr half, ptr addrspace(7) [[PTR]], i32 [[TMP11]]
; CHECK-NEXT:    [[TMP13:%.*]] = extractelement <16 x half> [[TMP5]], i64 1
; CHECK-NEXT:    store half [[TMP13]], ptr addrspace(7) [[TMP12]], align 2
; CHECK-NEXT:    [[TMP14:%.*]] = add i32 [[TMP4]], 320
; CHECK-NEXT:    [[TMP15:%.*]] = add i32 [[TMP14]], 0
; CHECK-NEXT:    [[TMP16:%.*]] = getelementptr half, ptr addrspace(7) [[PTR]], i32 [[TMP15]]
; CHECK-NEXT:    [[TMP17:%.*]] = extractelement <16 x half> [[TMP5]], i64 2
; CHECK-NEXT:    store half [[TMP17]], ptr addrspace(7) [[TMP16]], align 2
; CHECK-NEXT:    [[TMP18:%.*]] = add i32 [[TMP4]], 480
; CHECK-NEXT:    [[TMP19:%.*]] = add i32 [[TMP18]], 0
; CHECK-NEXT:    [[TMP20:%.*]] = getelementptr half, ptr addrspace(7) [[PTR]], i32 [[TMP19]]
; CHECK-NEXT:    [[TMP21:%.*]] = extractelement <16 x half> [[TMP5]], i64 3
; CHECK-NEXT:    store half [[TMP21]], ptr addrspace(7) [[TMP20]], align 2
; CHECK-NEXT:    [[TMP22:%.*]] = add i32 [[TMP4]], 640
; CHECK-NEXT:    [[TMP23:%.*]] = add i32 [[TMP22]], 0
; CHECK-NEXT:    [[TMP24:%.*]] = getelementptr half, ptr addrspace(7) [[PTR]], i32 [[TMP23]]
; CHECK-NEXT:    [[TMP25:%.*]] = extractelement <16 x half> [[TMP5]], i64 4
; CHECK-NEXT:    store half [[TMP25]], ptr addrspace(7) [[TMP24]], align 2
; CHECK-NEXT:    [[TMP26:%.*]] = add i32 [[TMP4]], 800
; CHECK-NEXT:    [[TMP27:%.*]] = add i32 [[TMP26]], 0
; CHECK-NEXT:    [[TMP28:%.*]] = getelementptr half, ptr addrspace(7) [[PTR]], i32 [[TMP27]]
; CHECK-NEXT:    [[TMP29:%.*]] = extractelement <16 x half> [[TMP5]], i64 5
; CHECK-NEXT:    store half [[TMP29]], ptr addrspace(7) [[TMP28]], align 2
; CHECK-NEXT:    [[TMP30:%.*]] = add i32 [[TMP4]], 960
; CHECK-NEXT:    [[TMP31:%.*]] = add i32 [[TMP30]], 0
; CHECK-NEXT:    [[TMP32:%.*]] = getelementptr half, ptr addrspace(7) [[PTR]], i32 [[TMP31]]
; CHECK-NEXT:    [[TMP33:%.*]] = extractelement <16 x half> [[TMP5]], i64 6
; CHECK-NEXT:    store half [[TMP33]], ptr addrspace(7) [[TMP32]], align 2
; CHECK-NEXT:    [[TMP34:%.*]] = add i32 [[TMP4]], 1120
; CHECK-NEXT:    [[TMP35:%.*]] = add i32 [[TMP34]], 0
; CHECK-NEXT:    [[TMP36:%.*]] = getelementptr half, ptr addrspace(7) [[PTR]], i32 [[TMP35]]
; CHECK-NEXT:    [[TMP37:%.*]] = extractelement <16 x half> [[TMP5]], i64 7
; CHECK-NEXT:    store half [[TMP37]], ptr addrspace(7) [[TMP36]], align 2
; CHECK-NEXT:    [[TMP38:%.*]] = add i32 [[TMP4]], 1280
; CHECK-NEXT:    [[TMP39:%.*]] = add i32 [[TMP38]], 0
; CHECK-NEXT:    [[TMP40:%.*]] = getelementptr half, ptr addrspace(7) [[PTR]], i32 [[TMP39]]
; CHECK-NEXT:    [[TMP41:%.*]] = extractelement <16 x half> [[TMP5]], i64 8
; CHECK-NEXT:    store half [[TMP41]], ptr addrspace(7) [[TMP40]], align 2
; CHECK-NEXT:    [[TMP42:%.*]] = add i32 [[TMP4]], 1440
; CHECK-NEXT:    [[TMP43:%.*]] = add i32 [[TMP42]], 0
; CHECK-NEXT:    [[TMP44:%.*]] = getelementptr half, ptr addrspace(7) [[PTR]], i32 [[TMP43]]
; CHECK-NEXT:    [[TMP45:%.*]] = extractelement <16 x half> [[TMP5]], i64 9
; CHECK-NEXT:    store half [[TMP45]], ptr addrspace(7) [[TMP44]], align 2
; CHECK-NEXT:    [[TMP46:%.*]] = add i32 [[TMP4]], 1600
; CHECK-NEXT:    [[TMP47:%.*]] = add i32 [[TMP46]], 0
; CHECK-NEXT:    [[TMP48:%.*]] = getelementptr half, ptr addrspace(7) [[PTR]], i32 [[TMP47]]
; CHECK-NEXT:    [[TMP49:%.*]] = extractelement <16 x half> [[TMP5]], i64 10
; CHECK-NEXT:    store half [[TMP49]], ptr addrspace(7) [[TMP48]], align 2
; CHECK-NEXT:    [[TMP50:%.*]] = add i32 [[TMP4]], 1760
; CHECK-NEXT:    [[TMP51:%.*]] = add i32 [[TMP50]], 0
; CHECK-NEXT:    [[TMP52:%.*]] = getelementptr half, ptr addrspace(7) [[PTR]], i32 [[TMP51]]
; CHECK-NEXT:    [[TMP53:%.*]] = extractelement <16 x half> [[TMP5]], i64 11
; CHECK-NEXT:    store half [[TMP53]], ptr addrspace(7) [[TMP52]], align 2
; CHECK-NEXT:    [[TMP54:%.*]] = add i32 [[TMP4]], 1920
; CHECK-NEXT:    [[TMP55:%.*]] = add i32 [[TMP54]], 0
; CHECK-NEXT:    [[TMP56:%.*]] = getelementptr half, ptr addrspace(7) [[PTR]], i32 [[TMP55]]
; CHECK-NEXT:    [[TMP57:%.*]] = extractelement <16 x half> [[TMP5]], i64 12
; CHECK-NEXT:    store half [[TMP57]], ptr addrspace(7) [[TMP56]], align 2
; CHECK-NEXT:    [[TMP58:%.*]] = add i32 [[TMP4]], 2080
; CHECK-NEXT:    [[TMP59:%.*]] = add i32 [[TMP58]], 0
; CHECK-NEXT:    [[TMP60:%.*]] = getelementptr half, ptr addrspace(7) [[PTR]], i32 [[TMP59]]
; CHECK-NEXT:    [[TMP61:%.*]] = extractelement <16 x half> [[TMP5]], i64 13
; CHECK-NEXT:    store half [[TMP61]], ptr addrspace(7) [[TMP60]], align 2
; CHECK-NEXT:    [[TMP62:%.*]] = add i32 [[TMP4]], 2240
; CHECK-NEXT:    [[TMP63:%.*]] = add i32 [[TMP62]], 0
; CHECK-NEXT:    [[TMP64:%.*]] = getelementptr half, ptr addrspace(7) [[PTR]], i32 [[TMP63]]
; CHECK-NEXT:    [[TMP65:%.*]] = extractelement <16 x half> [[TMP5]], i64 14
; CHECK-NEXT:    store half [[TMP65]], ptr addrspace(7) [[TMP64]], align 2
; CHECK-NEXT:    [[TMP66:%.*]] = add i32 [[TMP4]], 2400
; CHECK-NEXT:    [[TMP67:%.*]] = add i32 [[TMP66]], 0
; CHECK-NEXT:    [[TMP68:%.*]] = getelementptr half, ptr addrspace(7) [[PTR]], i32 [[TMP67]]
; CHECK-NEXT:    [[TMP69:%.*]] = extractelement <16 x half> [[TMP5]], i64 15
; CHECK-NEXT:    store half [[TMP69]], ptr addrspace(7) [[TMP68]], align 2
; CHECK-NEXT:    ret void
;
  call void @lgc.cooperative.matrix.store.p7.i32.i1.i32.i32.i32.v8f32(ptr addrspace(7) %ptr, i32 320, i1 false, i32 1, i32 0, i32 0, <8 x float> %a)
  ret void
}

define void @test_f16_cd_layout(ptr addrspace(7) %ptr, <8 x float> %a) !spirv.ExecutionModel !8 !lgc.shaderstage !9 {
; CHECK-LABEL: @test_f16_cd_layout(
; CHECK-NEXT:    [[TMP1:%.*]] = call i32 @llvm.amdgcn.mbcnt.lo(i32 -1, i32 0)
; CHECK-NEXT:    [[TMP2:%.*]] = call i32 @llvm.amdgcn.mbcnt.hi(i32 -1, i32 [[TMP1]])
; CHECK-NEXT:    [[TMP3:%.*]] = srem i32 [[TMP2]], 16
; CHECK-NEXT:    [[TMP4:%.*]] = udiv i32 [[TMP2]], 16
; CHECK-NEXT:    [[TMP5:%.*]] = mul i32 [[TMP4]], 160
; CHECK-NEXT:    [[TMP6:%.*]] = add i32 [[TMP5]], [[TMP3]]
; CHECK-NEXT:    [[TMP7:%.*]] = bitcast <8 x float> [[A:%.*]] to <16 x half>
; CHECK-NEXT:    [[TMP8:%.*]] = shufflevector <16 x half> [[TMP7]], <16 x half> poison, <4 x i32> <i32 0, i32 2, i32 4, i32 6>
; CHECK-NEXT:    [[TMP9:%.*]] = add i32 [[TMP6]], 0
; CHECK-NEXT:    [[TMP10:%.*]] = add i32 [[TMP9]], 0
; CHECK-NEXT:    [[TMP11:%.*]] = getelementptr half, ptr addrspace(7) [[PTR:%.*]], i32 [[TMP10]]
; CHECK-NEXT:    [[TMP12:%.*]] = extractelement <4 x half> [[TMP8]], i64 0
; CHECK-NEXT:    store half [[TMP12]], ptr addrspace(7) [[TMP11]], align 2
; CHECK-NEXT:    [[TMP13:%.*]] = add i32 [[TMP6]], 640
; CHECK-NEXT:    [[TMP14:%.*]] = add i32 [[TMP13]], 0
; CHECK-NEXT:    [[TMP15:%.*]] = getelementptr half, ptr addrspace(7) [[PTR]], i32 [[TMP14]]
; CHECK-NEXT:    [[TMP16:%.*]] = extractelement <4 x half> [[TMP8]], i64 1
; CHECK-NEXT:    store half [[TMP16]], ptr addrspace(7) [[TMP15]], align 2
; CHECK-NEXT:    [[TMP17:%.*]] = add i32 [[TMP6]], 1280
; CHECK-NEXT:    [[TMP18:%.*]] = add i32 [[TMP17]], 0
; CHECK-NEXT:    [[TMP19:%.*]] = getelementptr half, ptr addrspace(7) [[PTR]], i32 [[TMP18]]
; CHECK-NEXT:    [[TMP20:%.*]] = extractelement <4 x half> [[TMP8]], i64 2
; CHECK-NEXT:    store half [[TMP20]], ptr addrspace(7) [[TMP19]], align 2
; CHECK-NEXT:    [[TMP21:%.*]] = add i32 [[TMP6]], 1920
; CHECK-NEXT:    [[TMP22:%.*]] = add i32 [[TMP21]], 0
; CHECK-NEXT:    [[TMP23:%.*]] = getelementptr half, ptr addrspace(7) [[PTR]], i32 [[TMP22]]
; CHECK-NEXT:    [[TMP24:%.*]] = extractelement <4 x half> [[TMP8]], i64 3
; CHECK-NEXT:    store half [[TMP24]], ptr addrspace(7) [[TMP23]], align 2
; CHECK-NEXT:    ret void
;
  call void @lgc.cooperative.matrix.store.p7.i32.i1.i32.i32.i32.v8f32(ptr addrspace(7) %ptr, i32 320, i1 false, i32 1, i32 1, i32 0, <8 x float> %a)
  ret void
}

define void @test_i16_ab_layout(ptr addrspace(7) %ptr, <8 x i32> %a) !spirv.ExecutionModel !8 !lgc.shaderstage !9 {
; CHECK-LABEL: @test_i16_ab_layout(
; CHECK-NEXT:    [[TMP1:%.*]] = call i32 @llvm.amdgcn.mbcnt.lo(i32 -1, i32 0)
; CHECK-NEXT:    [[TMP2:%.*]] = call i32 @llvm.amdgcn.mbcnt.hi(i32 -1, i32 [[TMP1]])
; CHECK-NEXT:    [[TMP3:%.*]] = srem i32 [[TMP2]], 16
; CHECK-NEXT:    [[TMP4:%.*]] = add i32 0, [[TMP3]]
; CHECK-NEXT:    [[TMP5:%.*]] = bitcast <8 x i32> [[A:%.*]] to <16 x i16>
; CHECK-NEXT:    [[TMP6:%.*]] = add i32 [[TMP4]], 0
; CHECK-NEXT:    [[TMP7:%.*]] = add i32 [[TMP6]], 0
; CHECK-NEXT:    [[TMP8:%.*]] = getelementptr i16, ptr addrspace(7) [[PTR:%.*]], i32 [[TMP7]]
; CHECK-NEXT:    [[TMP9:%.*]] = extractelement <16 x i16> [[TMP5]], i64 0
; CHECK-NEXT:    store i16 [[TMP9]], ptr addrspace(7) [[TMP8]], align 2
; CHECK-NEXT:    [[TMP10:%.*]] = add i32 [[TMP4]], 160
; CHECK-NEXT:    [[TMP11:%.*]] = add i32 [[TMP10]], 0
; CHECK-NEXT:    [[TMP12:%.*]] = getelementptr i16, ptr addrspace(7) [[PTR]], i32 [[TMP11]]
; CHECK-NEXT:    [[TMP13:%.*]] = extractelement <16 x i16> [[TMP5]], i64 1
; CHECK-NEXT:    store i16 [[TMP13]], ptr addrspace(7) [[TMP12]], align 2
; CHECK-NEXT:    [[TMP14:%.*]] = add i32 [[TMP4]], 320
; CHECK-NEXT:    [[TMP15:%.*]] = add i32 [[TMP14]], 0
; CHECK-NEXT:    [[TMP16:%.*]] = getelementptr i16, ptr addrspace(7) [[PTR]], i32 [[TMP15]]
; CHECK-NEXT:    [[TMP17:%.*]] = extractelement <16 x i16> [[TMP5]], i64 2
; CHECK-NEXT:    store i16 [[TMP17]], ptr addrspace(7) [[TMP16]], align 2
; CHECK-NEXT:    [[TMP18:%.*]] = add i32 [[TMP4]], 480
; CHECK-NEXT:    [[TMP19:%.*]] = add i32 [[TMP18]], 0
; CHECK-NEXT:    [[TMP20:%.*]] = getelementptr i16, ptr addrspace(7) [[PTR]], i32 [[TMP19]]
; CHECK-NEXT:    [[TMP21:%.*]] = extractelement <16 x i16> [[TMP5]], i64 3
; CHECK-NEXT:    store i16 [[TMP21]], ptr addrspace(7) [[TMP20]], align 2
; CHECK-NEXT:    [[TMP22:%.*]] = add i32 [[TMP4]], 640
; CHECK-NEXT:    [[TMP23:%.*]] = add i32 [[TMP22]], 0
; CHECK-NEXT:    [[TMP24:%.*]] = getelementptr i16, ptr addrspace(7) [[PTR]], i32 [[TMP23]]
; CHECK-NEXT:    [[TMP25:%.*]] = extractelement <16 x i16> [[TMP5]], i64 4
; CHECK-NEXT:    store i16 [[TMP25]], ptr addrspace(7) [[TMP24]], align 2
; CHECK-NEXT:    [[TMP26:%.*]] = add i32 [[TMP4]], 800
; CHECK-NEXT:    [[TMP27:%.*]] = add i32 [[TMP26]], 0
; CHECK-NEXT:    [[TMP28:%.*]] = getelementptr i16, ptr addrspace(7) [[PTR]], i32 [[TMP27]]
; CHECK-NEXT:    [[TMP29:%.*]] = extractelement <16 x i16> [[TMP5]], i64 5
; CHECK-NEXT:    store i16 [[TMP29]], ptr addrspace(7) [[TMP28]], align 2
; CHECK-NEXT:    [[TMP30:%.*]] = add i32 [[TMP4]], 960
; CHECK-NEXT:    [[TMP31:%.*]] = add i32 [[TMP30]], 0
; CHECK-NEXT:    [[TMP32:%.*]] = getelementptr i16, ptr addrspace(7) [[PTR]], i32 [[TMP31]]
; CHECK-NEXT:    [[TMP33:%.*]] = extractelement <16 x i16> [[TMP5]], i64 6
; CHECK-NEXT:    store i16 [[TMP33]], ptr addrspace(7) [[TMP32]], align 2
; CHECK-NEXT:    [[TMP34:%.*]] = add i32 [[TMP4]], 1120
; CHECK-NEXT:    [[TMP35:%.*]] = add i32 [[TMP34]], 0
; CHECK-NEXT:    [[TMP36:%.*]] = getelementptr i16, ptr addrspace(7) [[PTR]], i32 [[TMP35]]
; CHECK-NEXT:    [[TMP37:%.*]] = extractelement <16 x i16> [[TMP5]], i64 7
; CHECK-NEXT:    store i16 [[TMP37]], ptr addrspace(7) [[TMP36]], align 2
; CHECK-NEXT:    [[TMP38:%.*]] = add i32 [[TMP4]], 1280
; CHECK-NEXT:    [[TMP39:%.*]] = add i32 [[TMP38]], 0
; CHECK-NEXT:    [[TMP40:%.*]] = getelementptr i16, ptr addrspace(7) [[PTR]], i32 [[TMP39]]
; CHECK-NEXT:    [[TMP41:%.*]] = extractelement <16 x i16> [[TMP5]], i64 8
; CHECK-NEXT:    store i16 [[TMP41]], ptr addrspace(7) [[TMP40]], align 2
; CHECK-NEXT:    [[TMP42:%.*]] = add i32 [[TMP4]], 1440
; CHECK-NEXT:    [[TMP43:%.*]] = add i32 [[TMP42]], 0
; CHECK-NEXT:    [[TMP44:%.*]] = getelementptr i16, ptr addrspace(7) [[PTR]], i32 [[TMP43]]
; CHECK-NEXT:    [[TMP45:%.*]] = extractelement <16 x i16> [[TMP5]], i64 9
; CHECK-NEXT:    store i16 [[TMP45]], ptr addrspace(7) [[TMP44]], align 2
; CHECK-NEXT:    [[TMP46:%.*]] = add i32 [[TMP4]], 1600
; CHECK-NEXT:    [[TMP47:%.*]] = add i32 [[TMP46]], 0
; CHECK-NEXT:    [[TMP48:%.*]] = getelementptr i16, ptr addrspace(7) [[PTR]], i32 [[TMP47]]
; CHECK-NEXT:    [[TMP49:%.*]] = extractelement <16 x i16> [[TMP5]], i64 10
; CHECK-NEXT:    store i16 [[TMP49]], ptr addrspace(7) [[TMP48]], align 2
; CHECK-NEXT:    [[TMP50:%.*]] = add i32 [[TMP4]], 1760
; CHECK-NEXT:    [[TMP51:%.*]] = add i32 [[TMP50]], 0
; CHECK-NEXT:    [[TMP52:%.*]] = getelementptr i16, ptr addrspace(7) [[PTR]], i32 [[TMP51]]
; CHECK-NEXT:    [[TMP53:%.*]] = extractelement <16 x i16> [[TMP5]], i64 11
; CHECK-NEXT:    store i16 [[TMP53]], ptr addrspace(7) [[TMP52]], align 2
; CHECK-NEXT:    [[TMP54:%.*]] = add i32 [[TMP4]], 1920
; CHECK-NEXT:    [[TMP55:%.*]] = add i32 [[TMP54]], 0
; CHECK-NEXT:    [[TMP56:%.*]] = getelementptr i16, ptr addrspace(7) [[PTR]], i32 [[TMP55]]
; CHECK-NEXT:    [[TMP57:%.*]] = extractelement <16 x i16> [[TMP5]], i64 12
; CHECK-NEXT:    store i16 [[TMP57]], ptr addrspace(7) [[TMP56]], align 2
; CHECK-NEXT:    [[TMP58:%.*]] = add i32 [[TMP4]], 2080
; CHECK-NEXT:    [[TMP59:%.*]] = add i32 [[TMP58]], 0
; CHECK-NEXT:    [[TMP60:%.*]] = getelementptr i16, ptr addrspace(7) [[PTR]], i32 [[TMP59]]
; CHECK-NEXT:    [[TMP61:%.*]] = extractelement <16 x i16> [[TMP5]], i64 13
; CHECK-NEXT:    store i16 [[TMP61]], ptr addrspace(7) [[TMP60]], align 2
; CHECK-NEXT:    [[TMP62:%.*]] = add i32 [[TMP4]], 2240
; CHECK-NEXT:    [[TMP63:%.*]] = add i32 [[TMP62]], 0
; CHECK-NEXT:    [[TMP64:%.*]] = getelementptr i16, ptr addrspace(7) [[PTR]], i32 [[TMP63]]
; CHECK-NEXT:    [[TMP65:%.*]] = extractelement <16 x i16> [[TMP5]], i64 14
; CHECK-NEXT:    store i16 [[TMP65]], ptr addrspace(7) [[TMP64]], align 2
; CHECK-NEXT:    [[TMP66:%.*]] = add i32 [[TMP4]], 2400
; CHECK-NEXT:    [[TMP67:%.*]] = add i32 [[TMP66]], 0
; CHECK-NEXT:    [[TMP68:%.*]] = getelementptr i16, ptr addrspace(7) [[PTR]], i32 [[TMP67]]
; CHECK-NEXT:    [[TMP69:%.*]] = extractelement <16 x i16> [[TMP5]], i64 15
; CHECK-NEXT:    store i16 [[TMP69]], ptr addrspace(7) [[TMP68]], align 2
; CHECK-NEXT:    ret void
;
  call void @lgc.cooperative.matrix.store.p7.i32.i1.i32.i32.i32.v8i32(ptr addrspace(7) %ptr, i32 320, i1 false, i32 4, i32 0, i32 0, <8 x i32> %a)
  ret void
}

define void @test_i16_cd_layout(ptr addrspace(7) %ptr, <8 x i32> %a) !spirv.ExecutionModel !8 !lgc.shaderstage !9 {
; CHECK-LABEL: @test_i16_cd_layout(
; CHECK-NEXT:    [[TMP1:%.*]] = call i32 @llvm.amdgcn.mbcnt.lo(i32 -1, i32 0)
; CHECK-NEXT:    [[TMP2:%.*]] = call i32 @llvm.amdgcn.mbcnt.hi(i32 -1, i32 [[TMP1]])
; CHECK-NEXT:    [[TMP3:%.*]] = srem i32 [[TMP2]], 16
; CHECK-NEXT:    [[TMP4:%.*]] = udiv i32 [[TMP2]], 16
; CHECK-NEXT:    [[TMP5:%.*]] = mul i32 [[TMP4]], 160
; CHECK-NEXT:    [[TMP6:%.*]] = add i32 [[TMP5]], [[TMP3]]
; CHECK-NEXT:    [[TMP7:%.*]] = bitcast <8 x i32> [[A:%.*]] to <16 x i16>
; CHECK-NEXT:    [[TMP8:%.*]] = shufflevector <16 x i16> [[TMP7]], <16 x i16> poison, <4 x i32> <i32 0, i32 2, i32 4, i32 6>
; CHECK-NEXT:    [[TMP9:%.*]] = add i32 [[TMP6]], 0
; CHECK-NEXT:    [[TMP10:%.*]] = add i32 [[TMP9]], 0
; CHECK-NEXT:    [[TMP11:%.*]] = getelementptr i16, ptr addrspace(7) [[PTR:%.*]], i32 [[TMP10]]
; CHECK-NEXT:    [[TMP12:%.*]] = extractelement <4 x i16> [[TMP8]], i64 0
; CHECK-NEXT:    store i16 [[TMP12]], ptr addrspace(7) [[TMP11]], align 2
; CHECK-NEXT:    [[TMP13:%.*]] = add i32 [[TMP6]], 640
; CHECK-NEXT:    [[TMP14:%.*]] = add i32 [[TMP13]], 0
; CHECK-NEXT:    [[TMP15:%.*]] = getelementptr i16, ptr addrspace(7) [[PTR]], i32 [[TMP14]]
; CHECK-NEXT:    [[TMP16:%.*]] = extractelement <4 x i16> [[TMP8]], i64 1
; CHECK-NEXT:    store i16 [[TMP16]], ptr addrspace(7) [[TMP15]], align 2
; CHECK-NEXT:    [[TMP17:%.*]] = add i32 [[TMP6]], 1280
; CHECK-NEXT:    [[TMP18:%.*]] = add i32 [[TMP17]], 0
; CHECK-NEXT:    [[TMP19:%.*]] = getelementptr i16, ptr addrspace(7) [[PTR]], i32 [[TMP18]]
; CHECK-NEXT:    [[TMP20:%.*]] = extractelement <4 x i16> [[TMP8]], i64 2
; CHECK-NEXT:    store i16 [[TMP20]], ptr addrspace(7) [[TMP19]], align 2
; CHECK-NEXT:    [[TMP21:%.*]] = add i32 [[TMP6]], 1920
; CHECK-NEXT:    [[TMP22:%.*]] = add i32 [[TMP21]], 0
; CHECK-NEXT:    [[TMP23:%.*]] = getelementptr i16, ptr addrspace(7) [[PTR]], i32 [[TMP22]]
; CHECK-NEXT:    [[TMP24:%.*]] = extractelement <4 x i16> [[TMP8]], i64 3
; CHECK-NEXT:    store i16 [[TMP24]], ptr addrspace(7) [[TMP23]], align 2
; CHECK-NEXT:    ret void
;
  call void @lgc.cooperative.matrix.store.p7.i32.i1.i32.i32.i32.v8i32(ptr addrspace(7) %ptr, i32 320, i1 false, i32 4, i32 1, i32 0, <8 x i32> %a)
  ret void
}

define void @test_f32_cd_layout(ptr addrspace(7) %ptr, <8 x float> %a) !spirv.ExecutionModel !8 !lgc.shaderstage !9 {
; CHECK-LABEL: @test_f32_cd_layout(
; CHECK-NEXT:    [[TMP1:%.*]] = call i32 @llvm.amdgcn.mbcnt.lo(i32 -1, i32 0)
; CHECK-NEXT:    [[TMP2:%.*]] = call i32 @llvm.amdgcn.mbcnt.hi(i32 -1, i32 [[TMP1]])
; CHECK-NEXT:    [[TMP3:%.*]] = srem i32 [[TMP2]], 16
; CHECK-NEXT:    [[TMP4:%.*]] = udiv i32 [[TMP2]], 16
; CHECK-NEXT:    [[TMP5:%.*]] = mul i32 [[TMP4]], 160
; CHECK-NEXT:    [[TMP6:%.*]] = add i32 [[TMP5]], [[TMP3]]
; CHECK-NEXT:    [[TMP7:%.*]] = shufflevector <8 x float> [[A:%.*]], <8 x float> poison, <4 x i32> <i32 0, i32 1, i32 2, i32 3>
; CHECK-NEXT:    [[TMP8:%.*]] = add i32 [[TMP6]], 0
; CHECK-NEXT:    [[TMP9:%.*]] = add i32 [[TMP8]], 0
; CHECK-NEXT:    [[TMP10:%.*]] = getelementptr float, ptr addrspace(7) [[PTR:%.*]], i32 [[TMP9]]
; CHECK-NEXT:    [[TMP11:%.*]] = extractelement <4 x float> [[TMP7]], i64 0
; CHECK-NEXT:    store float [[TMP11]], ptr addrspace(7) [[TMP10]], align 4
; CHECK-NEXT:    [[TMP12:%.*]] = add i32 [[TMP6]], 640
; CHECK-NEXT:    [[TMP13:%.*]] = add i32 [[TMP12]], 0
; CHECK-NEXT:    [[TMP14:%.*]] = getelementptr float, ptr addrspace(7) [[PTR]], i32 [[TMP13]]
; CHECK-NEXT:    [[TMP15:%.*]] = extractelement <4 x float> [[TMP7]], i64 1
; CHECK-NEXT:    store float [[TMP15]], ptr addrspace(7) [[TMP14]], align 4
; CHECK-NEXT:    [[TMP16:%.*]] = add i32 [[TMP6]], 1280
; CHECK-NEXT:    [[TMP17:%.*]] = add i32 [[TMP16]], 0
; CHECK-NEXT:    [[TMP18:%.*]] = getelementptr float, ptr addrspace(7) [[PTR]], i32 [[TMP17]]
; CHECK-NEXT:    [[TMP19:%.*]] = extractelement <4 x float> [[TMP7]], i64 2
; CHECK-NEXT:    store float [[TMP19]], ptr addrspace(7) [[TMP18]], align 4
; CHECK-NEXT:    [[TMP20:%.*]] = add i32 [[TMP6]], 1920
; CHECK-NEXT:    [[TMP21:%.*]] = add i32 [[TMP20]], 0
; CHECK-NEXT:    [[TMP22:%.*]] = getelementptr float, ptr addrspace(7) [[PTR]], i32 [[TMP21]]
; CHECK-NEXT:    [[TMP23:%.*]] = extractelement <4 x float> [[TMP7]], i64 3
; CHECK-NEXT:    store float [[TMP23]], ptr addrspace(7) [[TMP22]], align 4
; CHECK-NEXT:    ret void
;
  call void @lgc.cooperative.matrix.store.p7.i32.i1.i32.i32.i32.v8f32(ptr addrspace(7) %ptr, i32 640, i1 false, i32 2, i32 1, i32 0, <8 x float> %a)
  ret void
}

define void @test_i32_cd_layout(ptr addrspace(7) %ptr, <8 x i32> %a) !spirv.ExecutionModel !8 !lgc.shaderstage !9 {
; CHECK-LABEL: @test_i32_cd_layout(
; CHECK-NEXT:    [[TMP1:%.*]] = call i32 @llvm.amdgcn.mbcnt.lo(i32 -1, i32 0)
; CHECK-NEXT:    [[TMP2:%.*]] = call i32 @llvm.amdgcn.mbcnt.hi(i32 -1, i32 [[TMP1]])
; CHECK-NEXT:    [[TMP3:%.*]] = srem i32 [[TMP2]], 16
; CHECK-NEXT:    [[TMP4:%.*]] = udiv i32 [[TMP2]], 16
; CHECK-NEXT:    [[TMP5:%.*]] = mul i32 [[TMP4]], 160
; CHECK-NEXT:    [[TMP6:%.*]] = add i32 [[TMP5]], [[TMP3]]
; CHECK-NEXT:    [[TMP7:%.*]] = shufflevector <8 x i32> [[A:%.*]], <8 x i32> poison, <4 x i32> <i32 0, i32 1, i32 2, i32 3>
; CHECK-NEXT:    [[TMP8:%.*]] = add i32 [[TMP6]], 0
; CHECK-NEXT:    [[TMP9:%.*]] = add i32 [[TMP8]], 0
; CHECK-NEXT:    [[TMP10:%.*]] = getelementptr i32, ptr addrspace(7) [[PTR:%.*]], i32 [[TMP9]]
; CHECK-NEXT:    [[TMP11:%.*]] = extractelement <4 x i32> [[TMP7]], i64 0
; CHECK-NEXT:    store i32 [[TMP11]], ptr addrspace(7) [[TMP10]], align 4
; CHECK-NEXT:    [[TMP12:%.*]] = add i32 [[TMP6]], 640
; CHECK-NEXT:    [[TMP13:%.*]] = add i32 [[TMP12]], 0
; CHECK-NEXT:    [[TMP14:%.*]] = getelementptr i32, ptr addrspace(7) [[PTR]], i32 [[TMP13]]
; CHECK-NEXT:    [[TMP15:%.*]] = extractelement <4 x i32> [[TMP7]], i64 1
; CHECK-NEXT:    store i32 [[TMP15]], ptr addrspace(7) [[TMP14]], align 4
; CHECK-NEXT:    [[TMP16:%.*]] = add i32 [[TMP6]], 1280
; CHECK-NEXT:    [[TMP17:%.*]] = add i32 [[TMP16]], 0
; CHECK-NEXT:    [[TMP18:%.*]] = getelementptr i32, ptr addrspace(7) [[PTR]], i32 [[TMP17]]
; CHECK-NEXT:    [[TMP19:%.*]] = extractelement <4 x i32> [[TMP7]], i64 2
; CHECK-NEXT:    store i32 [[TMP19]], ptr addrspace(7) [[TMP18]], align 4
; CHECK-NEXT:    [[TMP20:%.*]] = add i32 [[TMP6]], 1920
; CHECK-NEXT:    [[TMP21:%.*]] = add i32 [[TMP20]], 0
; CHECK-NEXT:    [[TMP22:%.*]] = getelementptr i32, ptr addrspace(7) [[PTR]], i32 [[TMP21]]
; CHECK-NEXT:    [[TMP23:%.*]] = extractelement <4 x i32> [[TMP7]], i64 3
; CHECK-NEXT:    store i32 [[TMP23]], ptr addrspace(7) [[TMP22]], align 4
; CHECK-NEXT:    ret void
;
  call void @lgc.cooperative.matrix.store.p7.i32.i1.i32.i32.i32.v8i32(ptr addrspace(7) %ptr, i32 640, i1 false, i32 5, i32 1, i32 0, <8 x i32> %a)
  ret void
}

declare void @lgc.cooperative.matrix.store.p7.i32.i1.i32.i32.i32.v8f32([4 x float] addrspace(7)*, i32, i1, i32, i32, i32, <8 x float>)
declare void @lgc.cooperative.matrix.store.p7.i32.i1.i32.i32.i32.v8i32([4 x float] addrspace(7)*, i32, i1, i32, i32, i32, <8 x i32>)

!llpc.compute.mode = !{!0}
!lgc.client = !{!1}
!lgc.options = !{!2}
!lgc.options.CS = !{!3}

!0 = !{i32 128, i32 2, i32 1}
!1 = !{!"Vulkan"}
!2 = !{i32 -2108299168, i32 -1199997545, i32 1667044824, i32 -422575072, i32 1, i32 0, i32 0, i32 0, i32 0, i32 0, i32 0, i32 0, i32 0, i32 0, i32 1, i32 0, i32 0, i32 -1}
!3 = !{i32 219437737, i32 -1317595285, i32 0, i32 0, i32 0, i32 0, i32 0, i32 0, i32 0, i32 0, i32 64, i32 64, i32 0, i32 0, i32 3, i32 0, i32 0, i32 0, i32 0, i32 0, i32 0, i32 20, i32 1800}
!8 = !{i32 5}
!9 = !{i32 7}
