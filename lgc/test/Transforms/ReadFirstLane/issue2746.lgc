; NOTE: Assertions have been autogenerated by utils/update_test_checks.py UTC_ARGS: --tool lgc --version 3
; RUN: lgc -o - -passes=lgc-patch-read-first-lane %s | FileCheck --check-prefixes=CHECK %s

define i32 @f() {
; CHECK-LABEL: define i32 @f() {
; CHECK-NEXT:    [[MBC:%.*]] = call i32 @llvm.amdgcn.mbcnt.lo(i32 -1, i32 0)
; CHECK-NEXT:    [[RFL:%.*]] = call i32 @llvm.amdgcn.readfirstlane(i32 [[MBC]])
; CHECK-NEXT:    [[CMP:%.*]] = icmp eq i32 [[MBC]], [[RFL]]
; CHECK-NEXT:    [[BAL:%.*]] = call i32 @llvm.amdgcn.ballot.i32(i1 [[CMP]])
; CHECK-NEXT:    ret i32 [[BAL]]
;
  %mbc = call i32 @llvm.amdgcn.mbcnt.lo(i32 -1, i32 0)
  %rfl = call i32 @llvm.amdgcn.readfirstlane(i32 %mbc)
  %cmp = icmp eq i32 %mbc, %rfl
  %bal = call i32 @llvm.amdgcn.ballot.i64(i1 %cmp)
  ret i32 %bal
}

declare i32 @llvm.amdgcn.mbcnt.lo(i32, i32)
declare i32 @llvm.amdgcn.readfirstlane(i32)
declare i32 @llvm.amdgcn.ballot.i64(i1)
