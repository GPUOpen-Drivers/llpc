; NOTE: Assertions have been autogenerated by tool/update_llpc_test_checks.py
; RUN: amdllpc -trim-debug-info=false -v -gfxip 10.1 %s | FileCheck -check-prefixes=CHECK %s

[CsSpirv]
; SPIR-V
; Version: 1.0
; Generator: Khronos Glslang Reference Front End; 11
; Bound: 146
; Schema: 0
               OpCapability Shader
               OpCapability Float64
               OpExtension "SPV_KHR_non_semantic_info"
          %2 = OpExtInstImport "NonSemantic.Shader.DebugInfo.100"
          %3 = OpExtInstImport "GLSL.std.450"
               OpMemoryModel Logical GLSL450
               OpEntryPoint GLCompute %main "main" %gl_GlobalInvocationID %gl_WorkGroupID %gl_NumWorkGroups
               OpExecutionMode %main LocalSize 1 1 1
          %1 = OpString "builtIncompute.comp"
          %9 = OpString "uint"
         %15 = OpString "main"
         %18 = OpString "// OpModuleProcessed client vulkan100
// OpModuleProcessed target-env vulkan1.0
// OpModuleProcessed entry-point main
#line 1
#version 460 core
#extension GL_KHR_shader_subgroup_basic : enable
layout (local_size_x = 1, local_size_y = 1, local_size_z = 1) in;
layout (local_size_x_id = 0, local_size_y_id = 1, local_size_z_id = 2) in;
layout(set = 0, binding = 0) uniform Stride
{
	uvec2 u_stride;
}stride;
layout(set = 0, binding = 1, std430) buffer Output
{
	uvec3 result[];
} sb_out;

void main (void)
{
    double sx = double(gl_WorkGroupSize.x);
    double sy = double(gl_WorkGroupSize.y);
    double sz = double(gl_WorkGroupSize.z);
	highp uint offset = stride.u_stride.x*gl_GlobalInvocationID.z + stride.u_stride.y*gl_GlobalInvocationID.y + gl_GlobalInvocationID.x;
    uint wgidx = gl_WorkGroupID.x;
    uint wgidy = gl_WorkGroupID.y;
	sb_out.result[offset] = gl_NumWorkGroups;
}"
         %29 = OpString "float"
         %35 = OpString "sx"
         %50 = OpString "sy"
         %58 = OpString "sz"
         %67 = OpString "offset"
         %73 = OpString "u_stride"
         %77 = OpString "Stride"
         %81 = OpString "stride"
         %83 = OpString "int"
         %92 = OpString "gl_GlobalInvocationID"
        %110 = OpString "wgidx"
        %114 = OpString "gl_WorkGroupID"
        %121 = OpString "wgidy"
        %131 = OpString "result"
        %134 = OpString "Output"
        %138 = OpString "sb_out"
        %142 = OpString "gl_NumWorkGroups"
               OpSourceExtension "GL_KHR_shader_subgroup_basic"
               OpName %main "main"
               OpName %sx "sx"
               OpName %sy "sy"
               OpName %sz "sz"
               OpName %offset "offset"
               OpName %Stride "Stride"
               OpMemberName %Stride 0 "u_stride"
               OpName %stride "stride"
               OpName %gl_GlobalInvocationID "gl_GlobalInvocationID"
               OpName %wgidx "wgidx"
               OpName %gl_WorkGroupID "gl_WorkGroupID"
               OpName %wgidy "wgidy"
               OpName %Output "Output"
               OpMemberName %Output 0 "result"
               OpName %sb_out "sb_out"
               OpName %gl_NumWorkGroups "gl_NumWorkGroups"
               OpDecorate %38 SpecId 0
               OpDecorate %39 SpecId 1
               OpDecorate %40 SpecId 2
               OpDecorate %gl_WorkGroupSize BuiltIn WorkgroupSize
               OpMemberDecorate %Stride 0 Offset 0
               OpDecorate %Stride Block
               OpDecorate %stride DescriptorSet 0
               OpDecorate %stride Binding 0
               OpDecorate %gl_GlobalInvocationID BuiltIn GlobalInvocationId
               OpDecorate %gl_WorkGroupID BuiltIn WorkgroupId
               OpDecorate %_runtimearr_v3uint ArrayStride 16
               OpMemberDecorate %Output 0 Offset 0
               OpDecorate %Output BufferBlock
               OpDecorate %sb_out DescriptorSet 0
               OpDecorate %sb_out Binding 1
               OpDecorate %gl_NumWorkGroups BuiltIn NumWorkgroups
       %void = OpTypeVoid
          %5 = OpTypeFunction %void
       %uint = OpTypeInt 32 0
    %uint_32 = OpConstant %uint 32
     %uint_6 = OpConstant %uint 6
     %uint_0 = OpConstant %uint 0
          %8 = OpExtInst %void %2 DebugTypeBasic %9 %uint_32 %uint_6 %uint_0
     %uint_3 = OpConstant %uint 3
          %6 = OpExtInst %void %2 DebugTypeFunction %uint_3 %void
         %17 = OpExtInst %void %2 DebugSource %1 %18
     %uint_1 = OpConstant %uint 1
     %uint_4 = OpConstant %uint 4
     %uint_2 = OpConstant %uint 2
         %19 = OpExtInst %void %2 DebugCompilationUnit %uint_1 %uint_4 %17 %uint_2
         %16 = OpExtInst %void %2 DebugFunction %15 %6 %17 %uint_0 %uint_0 %19 %15 %uint_3 %uint_0
    %uint_16 = OpConstant %uint 16
     %double = OpTypeFloat 64
    %uint_64 = OpConstant %uint 64
         %30 = OpExtInst %void %2 DebugTypeBasic %29 %uint_64 %uint_3 %uint_0
%_ptr_Function_double = OpTypePointer Function %double
         %34 = OpExtInst %void %2 DebugLocalVariable %35 %30 %17 %uint_16 %uint_0 %16 %uint_4
         %37 = OpExtInst %void %2 DebugExpression
         %38 = OpSpecConstant %uint 1
         %39 = OpSpecConstant %uint 1
         %40 = OpSpecConstant %uint 1
     %v3uint = OpTypeVector %uint 3
         %42 = OpExtInst %void %2 DebugTypeVector %8 %uint_3
%gl_WorkGroupSize = OpSpecConstantComposite %v3uint %38 %39 %40
    %uint_17 = OpConstant %uint 17
         %49 = OpExtInst %void %2 DebugLocalVariable %50 %30 %17 %uint_17 %uint_0 %16 %uint_4
    %uint_18 = OpConstant %uint 18
         %57 = OpExtInst %void %2 DebugLocalVariable %58 %30 %17 %uint_18 %uint_0 %16 %uint_4
    %uint_19 = OpConstant %uint 19
%_ptr_Function_uint = OpTypePointer Function %uint
         %66 = OpExtInst %void %2 DebugLocalVariable %67 %8 %17 %uint_19 %uint_0 %16 %uint_4
     %v2uint = OpTypeVector %uint 2
         %70 = OpExtInst %void %2 DebugTypeVector %8 %uint_2
     %Stride = OpTypeStruct %v2uint
     %uint_7 = OpConstant %uint 7
     %uint_8 = OpConstant %uint 8
         %72 = OpExtInst %void %2 DebugTypeMember %73 %70 %17 %uint_7 %uint_8 %uint_0 %uint_0 %uint_3
         %76 = OpExtInst %void %2 DebugTypeComposite %77 %uint_1 %17 %uint_19 %uint_0 %19 %77 %uint_0 %uint_3 %72
%_ptr_Uniform_Stride = OpTypePointer Uniform %Stride
     %stride = OpVariable %_ptr_Uniform_Stride Uniform
         %80 = OpExtInst %void %2 DebugGlobalVariable %81 %76 %17 %uint_19 %uint_0 %19 %81 %stride %uint_8
        %int = OpTypeInt 32 1
         %84 = OpExtInst %void %2 DebugTypeBasic %83 %uint_32 %uint_4 %uint_0
      %int_0 = OpConstant %int 0
%_ptr_Uniform_uint = OpTypePointer Uniform %uint
%_ptr_Input_v3uint = OpTypePointer Input %v3uint
%gl_GlobalInvocationID = OpVariable %_ptr_Input_v3uint Input
         %91 = OpExtInst %void %2 DebugGlobalVariable %92 %42 %17 %uint_19 %uint_0 %19 %92 %gl_GlobalInvocationID %uint_8
%_ptr_Input_uint = OpTypePointer Input %uint
    %uint_20 = OpConstant %uint 20
        %109 = OpExtInst %void %2 DebugLocalVariable %110 %8 %17 %uint_20 %uint_0 %16 %uint_4
%gl_WorkGroupID = OpVariable %_ptr_Input_v3uint Input
        %113 = OpExtInst %void %2 DebugGlobalVariable %114 %42 %17 %uint_20 %uint_0 %19 %114 %gl_WorkGroupID %uint_8
    %uint_21 = OpConstant %uint 21
        %120 = OpExtInst %void %2 DebugLocalVariable %121 %8 %17 %uint_21 %uint_0 %16 %uint_4
    %uint_22 = OpConstant %uint 22
%_runtimearr_v3uint = OpTypeRuntimeArray %v3uint
        %128 = OpExtInst %void %2 DebugTypeArray %42 %uint_0
     %Output = OpTypeStruct %_runtimearr_v3uint
    %uint_11 = OpConstant %uint 11
        %130 = OpExtInst %void %2 DebugTypeMember %131 %128 %17 %uint_11 %uint_8 %uint_0 %uint_0 %uint_3
        %133 = OpExtInst %void %2 DebugTypeComposite %134 %uint_1 %17 %uint_22 %uint_0 %19 %134 %uint_0 %uint_3 %130
%_ptr_Uniform_Output = OpTypePointer Uniform %Output
     %sb_out = OpVariable %_ptr_Uniform_Output Uniform
        %137 = OpExtInst %void %2 DebugGlobalVariable %138 %133 %17 %uint_22 %uint_0 %19 %138 %sb_out %uint_8
%gl_NumWorkGroups = OpVariable %_ptr_Input_v3uint Input
        %141 = OpExtInst %void %2 DebugGlobalVariable %142 %42 %17 %uint_22 %uint_0 %19 %142 %gl_NumWorkGroups %uint_8
%_ptr_Uniform_v3uint = OpTypePointer Uniform %v3uint
               OpLine %1 14 16
       %main = OpFunction %void None %5
         %23 = OpLabel
         %sx = OpVariable %_ptr_Function_double Function
         %sy = OpVariable %_ptr_Function_double Function
         %sz = OpVariable %_ptr_Function_double Function
     %offset = OpVariable %_ptr_Function_uint Function
      %wgidx = OpVariable %_ptr_Function_uint Function
      %wgidy = OpVariable %_ptr_Function_uint Function
         %24 = OpExtInst %void %2 DebugFunctionDefinition %16 %main
         %25 = OpExtInst %void %2 DebugScope %16
         %26 = OpExtInst %void %2 DebugLine %17 %uint_16 %uint_16 %uint_0 %uint_0
         %36 = OpExtInst %void %2 DebugDeclare %34 %sx %37
         %44 = OpCompositeExtract %uint %gl_WorkGroupSize 0
         %45 = OpConvertUToF %double %44
               OpStore %sx %45
         %46 = OpExtInst %void %2 DebugLine %17 %uint_17 %uint_17 %uint_0 %uint_0
         %51 = OpExtInst %void %2 DebugDeclare %49 %sy %37
         %52 = OpCompositeExtract %uint %gl_WorkGroupSize 1
         %53 = OpConvertUToF %double %52
               OpStore %sy %53
         %54 = OpExtInst %void %2 DebugLine %17 %uint_18 %uint_18 %uint_0 %uint_0
         %59 = OpExtInst %void %2 DebugDeclare %57 %sz %37
         %60 = OpCompositeExtract %uint %gl_WorkGroupSize 2
         %61 = OpConvertUToF %double %60
               OpStore %sz %61
         %62 = OpExtInst %void %2 DebugLine %17 %uint_19 %uint_19 %uint_0 %uint_0
         %68 = OpExtInst %void %2 DebugDeclare %66 %offset %37
         %87 = OpAccessChain %_ptr_Uniform_uint %stride %int_0 %uint_0
         %88 = OpLoad %uint %87
         %94 = OpAccessChain %_ptr_Input_uint %gl_GlobalInvocationID %uint_2
         %95 = OpLoad %uint %94
         %96 = OpIMul %uint %88 %95
         %97 = OpAccessChain %_ptr_Uniform_uint %stride %int_0 %uint_1
         %98 = OpLoad %uint %97
         %99 = OpAccessChain %_ptr_Input_uint %gl_GlobalInvocationID %uint_1
        %100 = OpLoad %uint %99
        %101 = OpIMul %uint %98 %100
        %102 = OpIAdd %uint %96 %101
        %103 = OpAccessChain %_ptr_Input_uint %gl_GlobalInvocationID %uint_0
        %104 = OpLoad %uint %103
        %105 = OpIAdd %uint %102 %104
               OpStore %offset %105
        %106 = OpExtInst %void %2 DebugLine %17 %uint_20 %uint_20 %uint_0 %uint_0
        %111 = OpExtInst %void %2 DebugDeclare %109 %wgidx %37
        %115 = OpAccessChain %_ptr_Input_uint %gl_WorkGroupID %uint_0
        %116 = OpLoad %uint %115
               OpStore %wgidx %116
        %117 = OpExtInst %void %2 DebugLine %17 %uint_21 %uint_21 %uint_0 %uint_0
        %122 = OpExtInst %void %2 DebugDeclare %120 %wgidy %37
        %123 = OpAccessChain %_ptr_Input_uint %gl_WorkGroupID %uint_1
        %124 = OpLoad %uint %123
               OpStore %wgidy %124
        %125 = OpExtInst %void %2 DebugLine %17 %uint_22 %uint_22 %uint_0 %uint_0
        %139 = OpLoad %uint %offset
        %143 = OpLoad %v3uint %gl_NumWorkGroups
        %145 = OpAccessChain %_ptr_Uniform_v3uint %sb_out %int_0 %139
               OpStore %145 %143
               OpReturn
               OpFunctionEnd

[CsInfo]
entryPoint = main
userDataNode[0].visibility = 128
userDataNode[0].type = DescriptorTableVaPtr
userDataNode[0].offsetInDwords = 0
userDataNode[0].sizeInDwords = 1
userDataNode[0].next[0].type = DescriptorConstBuffer
userDataNode[0].next[0].offsetInDwords = 0
userDataNode[0].next[0].sizeInDwords = 4
userDataNode[0].next[0].set = 0x00000000
userDataNode[0].next[0].binding = 0
userDataNode[0].next[1].type = DescriptorBuffer
userDataNode[0].next[1].offsetInDwords = 4
userDataNode[0].next[1].sizeInDwords = 4
userDataNode[0].next[1].set = 0x00000000
userDataNode[0].next[1].binding = 1
userDataNode[1].visibility = 2
userDataNode[1].type = StreamOutTableVaPtr
userDataNode[1].offsetInDwords = 1
userDataNode[1].sizeInDwords = 1
; CHECK-LABEL: // LLPC SPIRV-to-LLVM translation results
: CHECK-NEXT : [[TMP1:!.*]] = !DIFile(filename: "builtIncompute.comp"
: CHECK-NEXT : [[TMP2:!.*]] = distinct !DISubprogram(name: "main", linkageName: "main", scope: null, file: [[TMP1]],
: CHECK-NEXT : [[TMP3:!.*]] = !DISubroutineType(flags: DIFlagPublic
: CHECK-NEXT : [[TMP4:!.*]] = !DILocalVariable(name: "sx", scope: [[TMP2]], file: [[TMP1]], line: 16, type: [[TMP5]])
: CHECK-NEXT : [[TMP5:!.*]] = !DIBasicType(name: "float", size: 64, encoding: DW_ATE_float)
: CHECK-NEXT : [[TMP6:!.*]] = !DILocalVariable(name: "sy", scope: [[TMP2]], file: [[TMP1]], line: 17, type: [[TMP5]])
: CHECK-NEXT : [[TMP7:!.*]] = !DILocalVariable(name: "sz", scope: [[TMP2]], file: [[TMP1]], line: 18, type: [[TMP5]])
: CHECK-NEXT : [[TMP8:!.*]] = !DILocalVariable(name: "offset", scope: [[TMP2]], file: [[TMP1]], line: 19, type: [[TMP9]])
: CHECK-NEXT : [[TMP9:!.*]] = !DIBasicType(name: "uint", size: 32, encoding: DW_ATE_unsigned)
: CHECK-NEXT : [[TMP10:!.*]] = !DILocalVariable(name: "wgidx", scope: [[TMP2]], file: [[TMP1]], line: 20, type: [[TMP9]])
: CHECK-NEXT : [[TMP11:!.*]] = !DILocalVariable(name: "wgidy", scope: [[TMP2]], file: [[TMP1]], line: 21, type: [[TMP9]])
: CHECK-NEXT : [[TMP12:!.*]] = !DILocation(line: 14, column: 16, scope: [[TMP2]])
: CHECK-NEXT : [[TMP13:!.*]] = !DILocation(line: 16, scope: [[TMP2]])
: CHECK-NEXT : [[TMP14:!.*]] = !DILocation(line: 17, scope: [[TMP2]])
: CHECK-NEXT : [[TMP15:!.*]] = !DILocation(line: 18, scope: [[TMP2]])
: CHECK-NEXT : [[TMP16:!.*]] = !DILocation(line: 19, scope: [[TMP2]])
: CHECK-NEXT : [[TMP17:!.*]] = !DILocation(line: 20, scope: [[TMP2]])
: CHECK-NEXT : [[TMP18:!.*]] = !DILocation(line: 21, scope: [[TMP2]])
: CHECK-NEXT : [[TMP19:!.*]] = !DILocation(line: 22, scope: [[TMP2]])
