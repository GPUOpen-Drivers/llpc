; NOTE: Assertions have been autogenerated by tool/update_llpc_test_checks.py UTC_ARGS: --check-globals
; RUN: amdllpc --print-after=lgc-patch-prepare-pipeline-abi -trim-debug-info=false 2>&1 %s | FileCheck -check-prefix=SHADERTEST %s

[Version]
version = 53

[VsSpirv]
; SPIR-V
; Version: 1.0
; Generator: Khronos Glslang Reference Front End; 11
; Bound: 43
; Schema: 0
               OpCapability Shader
               OpExtension "SPV_KHR_non_semantic_info"
          %2 = OpExtInstImport "NonSemantic.Shader.DebugInfo.100"
          %3 = OpExtInstImport "GLSL.std.450"
               OpMemoryModel Logical GLSL450
               OpEntryPoint Vertex %main "main" %positionOut %position
          %1 = OpString "test.vert"
          %8 = OpString "uint"
         %15 = OpString "main"
         %18 = OpString "// OpModuleProcessed client vulkan100
// OpModuleProcessed target-env vulkan1.0
// OpModuleProcessed entry-point main
#line 1
#version 450
layout(location = 0) in vec4 position;
layout(location = 0) out vec4 positionOut;

void main (void)
{
    positionOut = position;
}"
         %29 = OpString "float"
         %36 = OpString "positionOut"
         %41 = OpString "position"
               OpName %main "main"
               OpName %positionOut "positionOut"
               OpName %position "position"
               OpDecorate %positionOut Location 0
               OpDecorate %position Location 0
       %void = OpTypeVoid
          %5 = OpTypeFunction %void
       %uint = OpTypeInt 32 0
    %uint_32 = OpConstant %uint 32
     %uint_6 = OpConstant %uint 6
     %uint_0 = OpConstant %uint 0
          %9 = OpExtInst %void %2 DebugTypeBasic %8 %uint_32 %uint_6 %uint_0
     %uint_3 = OpConstant %uint 3
          %6 = OpExtInst %void %2 DebugTypeFunction %uint_3 %void
         %17 = OpExtInst %void %2 DebugSource %1 %18
     %uint_1 = OpConstant %uint 1
     %uint_4 = OpConstant %uint 4
     %uint_2 = OpConstant %uint 2
         %19 = OpExtInst %void %2 DebugCompilationUnit %uint_1 %uint_4 %17 %uint_2
         %16 = OpExtInst %void %2 DebugFunction %15 %6 %17 %uint_0 %uint_0 %19 %15 %uint_3 %uint_0
     %uint_7 = OpConstant %uint 7
      %float = OpTypeFloat 32
         %30 = OpExtInst %void %2 DebugTypeBasic %29 %uint_32 %uint_3 %uint_0
    %v4float = OpTypeVector %float 4
         %32 = OpExtInst %void %2 DebugTypeVector %30 %uint_4
%_ptr_Output_v4float = OpTypePointer Output %v4float
%positionOut = OpVariable %_ptr_Output_v4float Output
     %uint_8 = OpConstant %uint 8
         %35 = OpExtInst %void %2 DebugGlobalVariable %36 %32 %17 %uint_7 %uint_0 %19 %36 %positionOut %uint_8
%_ptr_Input_v4float = OpTypePointer Input %v4float
   %position = OpVariable %_ptr_Input_v4float Input
         %40 = OpExtInst %void %2 DebugGlobalVariable %41 %32 %17 %uint_7 %uint_0 %19 %41 %position %uint_8
               OpLine %1 5 16
       %main = OpFunction %void None %5
         %23 = OpLabel
         %24 = OpExtInst %void %2 DebugFunctionDefinition %16 %main
         %25 = OpExtInst %void %2 DebugScope %16
         %26 = OpExtInst %void %2 DebugLine %17 %uint_7 %uint_7 %uint_0 %uint_0
         %42 = OpLoad %v4float %position
               OpStore %positionOut %42
               OpReturn
               OpFunctionEnd

[VsInfo]
entryPoint = main

[GsSpirv]
; SPIR-V
; Version: 1.0
; Generator: Khronos Glslang Reference Front End; 11
; Bound: 86
; Schema: 0
               OpCapability Geometry
               OpExtension "SPV_KHR_non_semantic_info"
          %2 = OpExtInstImport "NonSemantic.Shader.DebugInfo.100"
          %3 = OpExtInstImport "GLSL.std.450"
               OpMemoryModel Logical GLSL450
               OpEntryPoint Geometry %main "main" %_ %gl_in %position
               OpExecutionMode %main InputPoints
               OpExecutionMode %main Invocations 1
               OpExecutionMode %main OutputPoints
               OpExecutionMode %main OutputVertices 1
          %1 = OpString "test.geom"
          %8 = OpString "uint"
         %15 = OpString "main"
         %18 = OpString "// OpModuleProcessed client vulkan100
// OpModuleProcessed target-env vulkan1.0
// OpModuleProcessed entry-point main
#line 1
#version 450
layout(points) in;
layout(points, max_vertices = 1) out;
layout(location = 0) in vec4 position[];

void main (void)
{
    gl_Position = gl_in[0].gl_Position;
    EmitVertex();
    EndPrimitive();
}"
         %29 = OpString "float"
         %37 = OpString "gl_Position"
         %40 = OpString "gl_PointSize"
         %43 = OpString "gl_CullDistance"
         %47 = OpString "gl_PerVertex"
         %51 = OpString ""
         %53 = OpString "int"
         %70 = OpString "gl_in"
         %85 = OpString "position"
               OpName %main "main"
               OpName %gl_PerVertex "gl_PerVertex"
               OpMemberName %gl_PerVertex 0 "gl_Position"
               OpMemberName %gl_PerVertex 1 "gl_PointSize"
               OpMemberName %gl_PerVertex 2 "gl_ClipDistance"
               OpMemberName %gl_PerVertex 3 "gl_CullDistance"
               OpName %_ ""
               OpName %gl_PerVertex_0 "gl_PerVertex"
               OpMemberName %gl_PerVertex_0 0 "gl_Position"
               OpMemberName %gl_PerVertex_0 1 "gl_PointSize"
               OpMemberName %gl_PerVertex_0 2 "gl_ClipDistance"
               OpMemberName %gl_PerVertex_0 3 "gl_CullDistance"
               OpName %gl_in "gl_in"
               OpName %position "position"
               OpMemberDecorate %gl_PerVertex 0 BuiltIn Position
               OpMemberDecorate %gl_PerVertex 1 BuiltIn PointSize
               OpMemberDecorate %gl_PerVertex 2 BuiltIn ClipDistance
               OpMemberDecorate %gl_PerVertex 3 BuiltIn CullDistance
               OpDecorate %gl_PerVertex Block
               OpMemberDecorate %gl_PerVertex_0 0 BuiltIn Position
               OpMemberDecorate %gl_PerVertex_0 1 BuiltIn PointSize
               OpMemberDecorate %gl_PerVertex_0 2 BuiltIn ClipDistance
               OpMemberDecorate %gl_PerVertex_0 3 BuiltIn CullDistance
               OpDecorate %gl_PerVertex_0 Block
               OpDecorate %position Location 0
       %void = OpTypeVoid
          %5 = OpTypeFunction %void
       %uint = OpTypeInt 32 0
    %uint_32 = OpConstant %uint 32
     %uint_6 = OpConstant %uint 6
     %uint_0 = OpConstant %uint 0
          %9 = OpExtInst %void %2 DebugTypeBasic %8 %uint_32 %uint_6 %uint_0
     %uint_3 = OpConstant %uint 3
          %6 = OpExtInst %void %2 DebugTypeFunction %uint_3 %void
         %17 = OpExtInst %void %2 DebugSource %1 %18
     %uint_1 = OpConstant %uint 1
     %uint_4 = OpConstant %uint 4
     %uint_2 = OpConstant %uint 2
         %19 = OpExtInst %void %2 DebugCompilationUnit %uint_1 %uint_4 %17 %uint_2
         %16 = OpExtInst %void %2 DebugFunction %15 %6 %17 %uint_0 %uint_0 %19 %15 %uint_3 %uint_0
     %uint_8 = OpConstant %uint 8
      %float = OpTypeFloat 32
         %30 = OpExtInst %void %2 DebugTypeBasic %29 %uint_32 %uint_3 %uint_0
    %v4float = OpTypeVector %float 4
         %32 = OpExtInst %void %2 DebugTypeVector %30 %uint_4
%_arr_float_uint_1 = OpTypeArray %float %uint_1
         %34 = OpExtInst %void %2 DebugTypeArray %30 %uint_1
%gl_PerVertex = OpTypeStruct %v4float %float %_arr_float_uint_1 %_arr_float_uint_1
   %uint_215 = OpConstant %uint 215
         %36 = OpExtInst %void %2 DebugTypeMember %37 %32 %17 %uint_2 %uint_215 %uint_0 %uint_0 %uint_3
   %uint_233 = OpConstant %uint 233
         %39 = OpExtInst %void %2 DebugTypeMember %40 %30 %17 %uint_2 %uint_233 %uint_0 %uint_0 %uint_3
     %uint_7 = OpConstant %uint 7
         %42 = OpExtInst %void %2 DebugTypeMember %43 %34 %17 %uint_3 %uint_7 %uint_0 %uint_0 %uint_3
         %45 = OpExtInst %void %2 DebugTypeMember %43 %34 %17 %uint_3 %uint_7 %uint_0 %uint_0 %uint_3
         %46 = OpExtInst %void %2 DebugTypeComposite %47 %uint_1 %17 %uint_8 %uint_0 %19 %47 %uint_0 %uint_3 %36 %39 %42 %45
%_ptr_Output_gl_PerVertex = OpTypePointer Output %gl_PerVertex
          %_ = OpVariable %_ptr_Output_gl_PerVertex Output
         %50 = OpExtInst %void %2 DebugGlobalVariable %51 %46 %17 %uint_8 %uint_0 %19 %51 %_ %uint_8
        %int = OpTypeInt 32 1
         %54 = OpExtInst %void %2 DebugTypeBasic %53 %uint_32 %uint_4 %uint_0
      %int_0 = OpConstant %int 0
%gl_PerVertex_0 = OpTypeStruct %v4float %float %_arr_float_uint_1 %_arr_float_uint_1
    %uint_23 = OpConstant %uint 23
         %57 = OpExtInst %void %2 DebugTypeMember %37 %32 %17 %uint_2 %uint_23 %uint_0 %uint_0 %uint_3
    %uint_41 = OpConstant %uint 41
         %59 = OpExtInst %void %2 DebugTypeMember %40 %30 %17 %uint_2 %uint_41 %uint_0 %uint_0 %uint_3
    %uint_84 = OpConstant %uint 84
         %61 = OpExtInst %void %2 DebugTypeMember %43 %34 %17 %uint_2 %uint_84 %uint_0 %uint_0 %uint_3
         %63 = OpExtInst %void %2 DebugTypeMember %43 %34 %17 %uint_2 %uint_84 %uint_0 %uint_0 %uint_3
         %64 = OpExtInst %void %2 DebugTypeComposite %47 %uint_1 %17 %uint_8 %uint_0 %19 %47 %uint_0 %uint_3 %57 %59 %61 %63
%_arr_gl_PerVertex_0_uint_1 = OpTypeArray %gl_PerVertex_0 %uint_1
         %66 = OpExtInst %void %2 DebugTypeArray %64 %uint_1
%_ptr_Input__arr_gl_PerVertex_0_uint_1 = OpTypePointer Input %_arr_gl_PerVertex_0_uint_1
      %gl_in = OpVariable %_ptr_Input__arr_gl_PerVertex_0_uint_1 Input
         %69 = OpExtInst %void %2 DebugGlobalVariable %70 %66 %17 %uint_8 %uint_0 %19 %70 %gl_in %uint_8
%_ptr_Input_v4float = OpTypePointer Input %v4float
%_ptr_Output_v4float = OpTypePointer Output %v4float
     %uint_9 = OpConstant %uint 9
    %uint_10 = OpConstant %uint 10
%_arr_v4float_uint_1 = OpTypeArray %v4float %uint_1
         %81 = OpExtInst %void %2 DebugTypeArray %32 %uint_1
%_ptr_Input__arr_v4float_uint_1 = OpTypePointer Input %_arr_v4float_uint_1
   %position = OpVariable %_ptr_Input__arr_v4float_uint_1 Input
         %84 = OpExtInst %void %2 DebugGlobalVariable %85 %81 %17 %uint_10 %uint_0 %19 %85 %position %uint_8
               OpLine %1 6 16
       %main = OpFunction %void None %5
         %23 = OpLabel
         %24 = OpExtInst %void %2 DebugFunctionDefinition %16 %main
         %25 = OpExtInst %void %2 DebugScope %16
         %26 = OpExtInst %void %2 DebugLine %17 %uint_8 %uint_8 %uint_0 %uint_0
         %72 = OpAccessChain %_ptr_Input_v4float %gl_in %int_0 %int_0
         %73 = OpLoad %v4float %72
         %75 = OpAccessChain %_ptr_Output_v4float %_ %int_0
               OpStore %75 %73
         %76 = OpExtInst %void %2 DebugLine %17 %uint_9 %uint_9 %uint_0 %uint_0
               OpEmitVertex
         %78 = OpExtInst %void %2 DebugLine %17 %uint_10 %uint_10 %uint_0 %uint_0
               OpEndPrimitive
               OpReturn
               OpFunctionEnd

[GsInfo]
entryPoint = main


[ResourceMapping]
userDataNode[0].visibility = 82
userDataNode[0].type = PushConst
userDataNode[0].offsetInDwords = 0
userDataNode[0].sizeInDwords = 13
userDataNode[0].set = 0xFFFFFFFF
userDataNode[0].binding = 0
userDataNode[1].visibility = 32
userDataNode[1].type = StreamOutTableVaPtr
userDataNode[1].offsetInDwords = 13
userDataNode[1].sizeInDwords = 1
userDataNode[2].visibility = 2
userDataNode[2].type = IndirectUserDataVaPtr
userDataNode[2].offsetInDwords = 14
userDataNode[2].sizeInDwords = 1
userDataNode[2].indirectUserDataCount = 4

[GraphicsPipelineState]
topology = VK_PRIMITIVE_TOPOLOGY_POINT_LIST
nggState.enableNgg = 1


[VertexInputState]
binding[0].binding = 0
binding[0].stride = 16
binding[0].inputRate = VK_VERTEX_INPUT_RATE_VERTEX
attribute[0].location = 0
attribute[0].binding = 0
attribute[0].format = VK_FORMAT_R32G32B32A32_SFLOAT
attribute[0].offset = 0
;.
; SHADERTEST: @[[LDS_GS:[a-zA-Z0-9_$"\\.-]+]] = external addrspace(3) global [640 x i32], align 4
;.
; SHADERTEST-LABEL: define dllexport amdgpu_gs void @_amdgpu_gs_main(
; SHADERTEST-NEXT:  .entry:
; SHADERTEST-NEXT:    call void @llvm.amdgcn.init.exec(i64 -1)
; SHADERTEST-NEXT:    [[TMP15:%.*]] = call i32 @llvm.amdgcn.mbcnt.lo(i32 -1, i32 0)
; SHADERTEST-NEXT:    [[THREADIDINWAVE:%.*]] = call i32 @llvm.amdgcn.mbcnt.hi(i32 -1, i32 [[TMP15]])
; SHADERTEST-NEXT:    [[ESVERTCOUNT:%.*]] = call i32 @llvm.amdgcn.ubfe.i32(i32 [[MERGEDWAVEINFO:%.*]], i32 0, i32 8)
; SHADERTEST-NEXT:    [[GSPRIMCOUNT:%.*]] = call i32 @llvm.amdgcn.ubfe.i32(i32 [[MERGEDWAVEINFO]], i32 8, i32 8)
; SHADERTEST-NEXT:    [[GSWAVEID:%.*]] = call i32 @llvm.amdgcn.ubfe.i32(i32 [[MERGEDWAVEINFO]], i32 16, i32 8)
; SHADERTEST-NEXT:    [[WAVEINSUBGROUP:%.*]] = call i32 @llvm.amdgcn.ubfe.i32(i32 [[MERGEDWAVEINFO]], i32 24, i32 4)
; SHADERTEST-NEXT:    [[TMP16:%.*]] = mul i32 [[WAVEINSUBGROUP]], 320
; SHADERTEST-NEXT:    [[VALIDESVERT:%.*]] = icmp ult i32 [[THREADIDINWAVE]], [[ESVERTCOUNT]]
; SHADERTEST-NEXT:    br i1 [[VALIDESVERT]], label [[DOTBEGINES:%.*]], label [[DOTENDES:%.*]]
; SHADERTEST:       .beginEs:
; SHADERTEST-NEXT:    [[TMP17:%.*]] = extractelement <4 x i32> [[TMP5:%.*]], i64 0
; SHADERTEST-NEXT:    [[TMP18:%.*]] = extractelement <4 x i32> [[TMP5]], i64 1
; SHADERTEST-NEXT:    [[TMP19:%.*]] = extractelement <4 x i32> [[TMP5]], i64 2
; SHADERTEST-NEXT:    [[TMP20:%.*]] = extractelement <4 x i32> [[TMP5]], i64 3
; SHADERTEST-NEXT:    call amdgpu_es void @_amdgpu_es_main(i32 [[TMP17]], i32 [[TMP18]], i32 [[TMP19]], i32 [[TMP20]], i32 [[TMP16]], i32 [[TMP11:%.*]], i32 [[TMP12:%.*]], i32 [[TMP13:%.*]], i32 [[TMP14:%.*]]), !dbg [[DBG51:![0-9]+]]
; SHADERTEST-NEXT:    br label [[DOTENDES]]
; SHADERTEST:       .endEs:
; SHADERTEST-NEXT:    fence syncscope("workgroup") release
; SHADERTEST-NEXT:    call void @llvm.amdgcn.s.barrier()
; SHADERTEST-NEXT:    fence syncscope("workgroup") acquire
; SHADERTEST-NEXT:    [[VALIDGSPRIM:%.*]] = icmp ult i32 [[THREADIDINWAVE]], [[GSPRIMCOUNT]]
; SHADERTEST-NEXT:    br i1 [[VALIDGSPRIM]], label [[DOTBEGINGS:%.*]], label [[DOTENDGS:%.*]]
; SHADERTEST:       .beginGs:
; SHADERTEST-NEXT:    [[TMP21:%.*]] = call i32 @llvm.amdgcn.ubfe.i32(i32 [[TMP6:%.*]], i32 0, i32 16)
; SHADERTEST-NEXT:    [[TMP22:%.*]] = call i32 @llvm.amdgcn.ubfe.i32(i32 [[TMP6]], i32 16, i32 16)
; SHADERTEST-NEXT:    [[TMP23:%.*]] = call i32 @llvm.amdgcn.ubfe.i32(i32 poison, i32 0, i32 16)
; SHADERTEST-NEXT:    [[TMP24:%.*]] = call i32 @llvm.amdgcn.ubfe.i32(i32 poison, i32 16, i32 16)
; SHADERTEST-NEXT:    [[TMP25:%.*]] = call i32 @llvm.amdgcn.ubfe.i32(i32 poison, i32 0, i32 16)
; SHADERTEST-NEXT:    [[TMP26:%.*]] = call i32 @llvm.amdgcn.ubfe.i32(i32 poison, i32 16, i32 16)
; SHADERTEST-NEXT:    [[TMP27:%.*]] = extractelement <4 x i32> [[TMP5]], i64 0
; SHADERTEST-NEXT:    [[TMP28:%.*]] = extractelement <4 x i32> [[TMP5]], i64 1
; SHADERTEST-NEXT:    [[TMP29:%.*]] = extractelement <4 x i32> [[TMP5]], i64 2
; SHADERTEST-NEXT:    [[TMP30:%.*]] = extractelement <4 x i32> [[TMP5]], i64 3
; SHADERTEST-NEXT:    call amdgpu_gs void @_amdgpu_gs_main.1(i32 [[TMP27]], i32 [[TMP28]], i32 [[TMP29]], i32 [[TMP30]], i32 [[GSVSOFFSET:%.*]], i32 [[GSWAVEID]], i32 [[TMP21]], i32 [[TMP22]], i32 [[TMP8:%.*]], i32 [[TMP23]], i32 [[TMP24]], i32 [[TMP25]], i32 [[TMP26]], i32 [[TMP9:%.*]]), !dbg [[DBG51]]
; SHADERTEST-NEXT:    br label [[DOTENDGS]]
; SHADERTEST:       .endGs:
; SHADERTEST-NEXT:    ret void
;
;
; SHADERTEST-LABEL: define internal amdgpu_es void @_amdgpu_es_main(
; SHADERTEST-NEXT:  .entry:
; SHADERTEST-NEXT:    ret void, !dbg [[DBG56:![0-9]+]]
;
;
; SHADERTEST-LABEL: define internal amdgpu_gs void @_amdgpu_gs_main.1(
; SHADERTEST-NEXT:  .entry:
; SHADERTEST-NEXT:    [[TMP0:%.*]] = call i32 @llvm.amdgcn.mbcnt.lo(i32 -1, i32 0)
; SHADERTEST-NEXT:    [[TMP1:%.*]] = call i32 @llvm.amdgcn.mbcnt.hi(i32 -1, i32 [[TMP0]])
; SHADERTEST-NEXT:    [[TMP2:%.*]] = getelementptr i32, ptr addrspace(3) @Lds.GS, i32 [[ESGSOFFSET0:%.*]]
; SHADERTEST-NEXT:    [[TMP3:%.*]] = load float, ptr addrspace(3) [[TMP2]], align 4
; SHADERTEST-NEXT:    [[TMP4:%.*]] = getelementptr i8, ptr addrspace(3) [[TMP2]], i32 4
; SHADERTEST-NEXT:    [[TMP5:%.*]] = load float, ptr addrspace(3) [[TMP4]], align 4
; SHADERTEST-NEXT:    [[TMP6:%.*]] = getelementptr i8, ptr addrspace(3) [[TMP2]], i32 8
; SHADERTEST-NEXT:    [[TMP7:%.*]] = load float, ptr addrspace(3) [[TMP6]], align 4
; SHADERTEST-NEXT:    [[TMP8:%.*]] = getelementptr i8, ptr addrspace(3) [[TMP2]], i32 12
; SHADERTEST-NEXT:    [[TMP9:%.*]] = load i32, ptr addrspace(3) [[TMP8]], align 4
; SHADERTEST-NEXT:    [[TMP10:%.*]] = getelementptr i8, ptr addrspace(3) @Lds.GS, i32 [[GSVSOFFSET:%.*]], !dbg [[DBG59:![0-9]+]]
; SHADERTEST-NEXT:    [[TMP11:%.*]] = getelementptr i8, ptr addrspace(3) [[TMP10]], i32 1280, !dbg [[DBG59]]
; SHADERTEST-NEXT:    [[DOTIDX:%.*]] = mul i32 [[TMP1]], 20, !dbg [[DBG59]]
; SHADERTEST-NEXT:    [[TMP12:%.*]] = getelementptr i8, ptr addrspace(3) [[TMP11]], i32 [[DOTIDX]], !dbg [[DBG59]]
; SHADERTEST-NEXT:    store float [[TMP3]], ptr addrspace(3) [[TMP12]], align 4, !dbg [[DBG59]]
; SHADERTEST-NEXT:    [[TMP13:%.*]] = getelementptr i8, ptr addrspace(3) [[TMP12]], i32 4, !dbg [[DBG59]]
; SHADERTEST-NEXT:    store float [[TMP5]], ptr addrspace(3) [[TMP13]], align 4, !dbg [[DBG59]]
; SHADERTEST-NEXT:    [[TMP14:%.*]] = getelementptr i8, ptr addrspace(3) [[TMP12]], i32 8, !dbg [[DBG59]]
; SHADERTEST-NEXT:    store float [[TMP7]], ptr addrspace(3) [[TMP14]], align 4, !dbg [[DBG59]]
; SHADERTEST-NEXT:    [[TMP15:%.*]] = getelementptr i8, ptr addrspace(3) [[TMP12]], i32 12, !dbg [[DBG59]]
; SHADERTEST-NEXT:    store i32 [[TMP9]], ptr addrspace(3) [[TMP15]], align 4, !dbg [[DBG59]]
; SHADERTEST-NEXT:    call void @llvm.amdgcn.s.sendmsg(i32 34, i32 [[GSWAVEID:%.*]]), !dbg [[DBG59]]
; SHADERTEST-NEXT:    call void @llvm.amdgcn.s.sendmsg(i32 18, i32 [[GSWAVEID]]), !dbg [[DBG60:![0-9]+]]
; SHADERTEST-NEXT:    fence syncscope("workgroup") release, !dbg [[DBG60]]
; SHADERTEST-NEXT:    call void @llvm.amdgcn.s.sendmsg(i32 3, i32 [[GSWAVEID]]), !dbg [[DBG60]]
; SHADERTEST-NEXT:    ret void, !dbg [[DBG60]]
;
;
; SHADERTEST-LABEL: define dllexport amdgpu_vs void @_amdgpu_vs_main(
; SHADERTEST-NEXT:    [[TMP1:%.*]] = getelementptr i32, ptr addrspace(3) @Lds.GS, i32 [[VERTEXOFFSET:%.*]]
; SHADERTEST-NEXT:    [[TMP2:%.*]] = getelementptr i8, ptr addrspace(3) [[TMP1]], i32 1280
; SHADERTEST-NEXT:    [[TMP3:%.*]] = load <4 x float>, ptr addrspace(3) [[TMP2]], align 4, !invariant.load !49
; SHADERTEST-NEXT:    [[DOTI3:%.*]] = extractelement <4 x float> [[TMP3]], i64 3
; SHADERTEST-NEXT:    [[DOTI2:%.*]] = extractelement <4 x float> [[TMP3]], i64 2
; SHADERTEST-NEXT:    [[DOTI1:%.*]] = extractelement <4 x float> [[TMP3]], i64 1
; SHADERTEST-NEXT:    [[DOTI0:%.*]] = extractelement <4 x float> [[TMP3]], i64 0
; SHADERTEST-NEXT:    call void @llvm.amdgcn.exp.f32(i32 12, i32 15, float [[DOTI0]], float [[DOTI1]], float [[DOTI2]], float [[DOTI3]], i1 true, i1 false)
; SHADERTEST-NEXT:    ret void
;
;
; SHADERTEST-LABEL: @_amdgpu_ps_main(
; SHADERTEST-NEXT:    ret void
;
;.
; SHADERTEST: attributes #[[ATTR0:[0-9]+]] = { "amdgpu-flat-work-group-size"="128,128" "amdgpu-memory-bound"="false" "amdgpu-unroll-threshold"="700" "amdgpu-wave-limiter"="false" "target-features"=",+wavefrontsize64" }
; SHADERTEST: attributes #[[ATTR1:[0-9]+]] = { alwaysinline nounwind memory(readwrite) "amdgpu-memory-bound"="false" "amdgpu-unroll-threshold"="700" "amdgpu-wave-limiter"="false" "denormal-fp-math-f32"="preserve-sign" "target-features"=",+wavefrontsize64" }
; SHADERTEST: attributes #[[ATTR2:[0-9]+]] = { nounwind willreturn memory(none) }
; SHADERTEST: attributes #[[ATTR3:[0-9]+]] = { nounwind }
; SHADERTEST: attributes #[[ATTR4:[0-9]+]] = { nounwind willreturn memory(read) }
; SHADERTEST: attributes #[[ATTR5:[0-9]+]] = { "target-features"=",+wavefrontsize64" }
; SHADERTEST: attributes #[[ATTR6:[0-9]+]] = { memory(readwrite) "InitialPSInputAddr"="0" "amdgpu-color-export"="0" "amdgpu-depth-export"="0" "amdgpu-memory-bound"="false" "amdgpu-unroll-threshold"="700" "amdgpu-wave-limiter"="false" "target-features"=",+wavefrontsize64" }
; SHADERTEST: attributes #[[ATTR7:[0-9]+]] = { nounwind memory(none) }
; SHADERTEST: attributes #[[ATTR8:[0-9]+]] = { nocallback nofree nosync nounwind willreturn memory(read) }
; SHADERTEST: attributes #[[ATTR9:[0-9]+]] = { nocallback nofree nosync nounwind speculatable willreturn memory(none) }
; SHADERTEST: attributes #[[ATTR10:[0-9]+]] = { nocallback nofree nosync nounwind willreturn memory(none) }
; SHADERTEST: attributes #[[ATTR11:[0-9]+]] = { nocallback nofree nosync nounwind willreturn memory(inaccessiblemem: write) }
; SHADERTEST: attributes #[[ATTR12:[0-9]+]] = { convergent nocallback nofree nounwind willreturn }
;.
; SHADERTEST: [[META0:![0-9]+]] = distinct !DICompileUnit(language: DW_LANG_C, file: !1, producer: "spirv", isOptimized: false, runtimeVersion: 0, emissionKind: FullDebug, globals: !2)
; SHADERTEST: [[META1:![0-9]+]] = !DIFile(filename: "test.vert", directory: ".", source: "// OpModuleProcessed client vulkan100\0A// OpModuleProcessed target-env vulkan1.0\0A// OpModuleProcessed entry-point main\0A#line 1\0A#version 450\0Alayout(location = 0) in vec4 position
; SHADERTEST: [[META2:![0-9]+]] = !{!3, !9}
; SHADERTEST: [[META3:![0-9]+]] = !DIGlobalVariableExpression(var: !4, expr: !DIExpression())
; SHADERTEST: [[META4:![0-9]+]] = distinct !DIGlobalVariable(name: "positionOut", linkageName: "positionOut", scope: !0, file: !1, line: 7, type: !5, isLocal: false, isDefinition: true)
; SHADERTEST: [[META5:![0-9]+]] = !DICompositeType(tag: DW_TAG_array_type, baseType: !6, size: 128, flags: DIFlagVector, elements: !7)
; SHADERTEST: [[META6:![0-9]+]] = !DIBasicType(name: "float", size: 32, encoding: DW_ATE_float)
; SHADERTEST: [[META7:![0-9]+]] = !{!8}
; SHADERTEST: [[META8:![0-9]+]] = !DISubrange(count: 4, lowerBound: 0)
; SHADERTEST: [[META9:![0-9]+]] = !DIGlobalVariableExpression(var: !10, expr: !DIExpression())
; SHADERTEST: [[META10:![0-9]+]] = distinct !DIGlobalVariable(name: "position", linkageName: "position", scope: !0, file: !1, line: 7, type: !5, isLocal: false, isDefinition: true)
; SHADERTEST: [[META11:![0-9]+]] = distinct !DICompileUnit(language: DW_LANG_C, file: !12, producer: "spirv", isOptimized: false, runtimeVersion: 0, emissionKind: FullDebug, globals: !13)
; SHADERTEST: [[META12:![0-9]+]] = !DIFile(filename: "test.geom", directory: ".", source: "// OpModuleProcessed client vulkan100\0A// OpModuleProcessed target-env vulkan1.0\0A// OpModuleProcessed entry-point main\0A#line 1\0A#version 450\0Alayout(points) in
; SHADERTEST: [[META13:![0-9]+]] = !{!14, !24, !30}
; SHADERTEST: [[META14:![0-9]+]] = !DIGlobalVariableExpression(var: !15, expr: !DIExpression())
; SHADERTEST: [[META15:![0-9]+]] = distinct !DIGlobalVariable(scope: !11, file: !12, line: 8, type: !16, isLocal: false, isDefinition: true)
; SHADERTEST: [[META16:![0-9]+]] = !DICompositeType(tag: DW_TAG_structure_type, name: "gl_PerVertex", file: !12, line: 8, flags: DIFlagPublic, elements: !17, identifier: "gl_PerVertex")
; SHADERTEST: [[META17:![0-9]+]] = !{!18, !19, !20, !20}
; SHADERTEST: [[META18:![0-9]+]] = !DIDerivedType(tag: DW_TAG_member, name: "gl_Position", file: !12, line: 2, baseType: !5, flags: DIFlagPublic)
; SHADERTEST: [[META19:![0-9]+]] = !DIDerivedType(tag: DW_TAG_member, name: "gl_PointSize", file: !12, line: 2, baseType: !6, flags: DIFlagPublic)
; SHADERTEST: [[META20:![0-9]+]] = !DIDerivedType(tag: DW_TAG_member, name: "gl_CullDistance", file: !12, line: 3, baseType: !21, flags: DIFlagPublic)
; SHADERTEST: [[META21:![0-9]+]] = !DICompositeType(tag: DW_TAG_array_type, baseType: !6, size: 32, elements: !22)
; SHADERTEST: [[META22:![0-9]+]] = !{!23}
; SHADERTEST: [[META23:![0-9]+]] = !DISubrange(count: 1, lowerBound: 0)
; SHADERTEST: [[META24:![0-9]+]] = !DIGlobalVariableExpression(var: !25, expr: !DIExpression())
; SHADERTEST: [[META25:![0-9]+]] = distinct !DIGlobalVariable(name: "gl_in", linkageName: "gl_in", scope: !11, file: !12, line: 8, type: !26, isLocal: false, isDefinition: true)
; SHADERTEST: [[META26:![0-9]+]] = !DICompositeType(tag: DW_TAG_array_type, baseType: !27, elements: !22)
; SHADERTEST: [[META27:![0-9]+]] = !DICompositeType(tag: DW_TAG_structure_type, name: "gl_PerVertex", file: !12, line: 8, flags: DIFlagPublic, elements: !28, identifier: "gl_PerVertex")
; SHADERTEST: [[META28:![0-9]+]] = !{!18, !19, !29, !29}
; SHADERTEST: [[META29:![0-9]+]] = !DIDerivedType(tag: DW_TAG_member, name: "gl_CullDistance", file: !12, line: 2, baseType: !21, flags: DIFlagPublic)
; SHADERTEST: [[META30:![0-9]+]] = !DIGlobalVariableExpression(var: !31, expr: !DIExpression())
; SHADERTEST: [[META31:![0-9]+]] = distinct !DIGlobalVariable(name: "position", linkageName: "position", scope: !11, file: !12, line: 10, type: !32, isLocal: false, isDefinition: true)
; SHADERTEST: [[META32:![0-9]+]] = !DICompositeType(tag: DW_TAG_array_type, baseType: !5, size: 128, elements: !22)
; SHADERTEST: [[META33:![0-9]+]] = distinct !DICompileUnit(language: DW_LANG_C99, file: !34, producer: "lgc", isOptimized: false, runtimeVersion: 0, emissionKind: FullDebug)
; SHADERTEST: [[META34:![0-9]+]] = !DIFile(filename: "internal", directory: "")
; SHADERTEST: [[META35:![0-9]+]] = !{!"Vulkan"}
; SHADERTEST: [[META36:![0-9]+]] = !{i32 {{.*}}, i32 {{.*}}, i32 {{.*}}, i32 {{.*}}, i32 0, i32 0, i32 0, i32 0, i32 0, i32 0, i32 0, i32 0, i32 0, i32 0, i32 1, i32 0, i32 0, i32 2, i32 1
; SHADERTEST: [[META37:![0-9]+]] = !{i32 {{.*}}, i32 {{.*}}, i32 0, i32 0, i32 0, i32 0, i32 0, i32 0, i32 0, i32 0, i32 0, i32 64, i32 0, i32 0, i32 3, i32 0, i32 0, i32 0, i32 0, i32 0, i32 0, i32 20, i32 1800, i32 0, i32 0, i32 1}
; SHADERTEST: [[META38:![0-9]+]] = !{i32 {{.*}}, i32 {{.*}}, i32 0, i32 0, i32 0, i32 0, i32 0, i32 0, i32 0, i32 0, i32 0, i32 64, i32 0, i32 0, i32 3, i32 0, i32 0, i32 0, i32 0, i32 0, i32 0, i32 20, i32 1800, i32 0, i32 0, i32 1}
; SHADERTEST: [[META39:![0-9]+]] = !{!"PushConst", i32 9, i32 82, i32 0, i32 13, i64 4294967295, i32 0, i32 4}
; SHADERTEST: [[META40:![0-9]+]] = !{!"StreamOutTableVaPtr", i32 11, i32 32, i32 13, i32 1, i32 0}
; SHADERTEST: [[META41:![0-9]+]] = !{!"IndirectUserDataVaPtr", i32 8, i32 2, i32 14, i32 1, i32 4}
; SHADERTEST: [[META42:![0-9]+]] = !{i32 0, i32 0, i32 0, i32 16, i32 14, i32 7}
; SHADERTEST: [[META43:![0-9]+]] = !{!"\82\B0amdpal.pipelines{{.*}}AEamdpal.version\92\03\00"}
; SHADERTEST: [[META44:![0-9]+]] = !{i32 7, !"Dwarf Version", i32 4}
; SHADERTEST: [[META45:![0-9]+]] = !{i32 2, !"Debug Info Version", i32 3}
; SHADERTEST: [[META46:![0-9]+]] = !{i32 0, i32 0, i32 1, i32 1}
; SHADERTEST: [[META47:![0-9]+]] = distinct !DISubprogram(name: "lgc.shader.ESGS.main", scope: !34, file: !34, type: !48, flags: DIFlagArtificial, spFlags: DISPFlagDefinition, unit: !33)
; SHADERTEST: [[META48:![0-9]+]] = !DISubroutineType(types: !49)
; SHADERTEST: [[META49:![0-9]+]] = !{}
; SHADERTEST: [[META50:![0-9]+]] = !{i32 4}
; SHADERTEST: [[DBG51]] = !DILocation(line: 0, scope: !47)
; SHADERTEST: [[META52:![0-9]+]] = distinct !DISubprogram(name: "main", linkageName: "main", scope: null, file: !1, type: !53, flags: DIFlagPublic, spFlags: DISPFlagDefinition, unit: !0, templateParams: !49)
; SHADERTEST: [[META53:![0-9]+]] = !DISubroutineType(flags: DIFlagPublic, types: !54)
; SHADERTEST: [[META54:![0-9]+]] = !{null}
; SHADERTEST: [[META55:![0-9]+]] = !{i32 0}
; SHADERTEST: [[DBG56]] = !DILocation(line: 7, scope: !52)
; SHADERTEST: [[META57:![0-9]+]] = distinct !DISubprogram(name: "main", linkageName: "main", scope: null, file: !12, type: !53, flags: DIFlagPublic, spFlags: DISPFlagDefinition, unit: !11, templateParams: !49)
; SHADERTEST: [[META58:![0-9]+]] = !{i32 3}
; SHADERTEST: [[DBG59]] = !DILocation(line: 9, scope: !57)
; SHADERTEST: [[DBG60]] = !DILocation(line: 10, scope: !57)
; SHADERTEST: [[META61:![0-9]+]] = !{i32 8}
; SHADERTEST: [[META62:![0-9]+]] = !{i32 6}
;.
