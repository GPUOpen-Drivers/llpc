; NOTE: Assertions have been autogenerated by tool/update_llpc_test_checks.py UTC_ARGS: --check-pal-metadata
; Test color export format: VK_FORMAT_A8_UNORM_KHR which must contain alpha channel.

; RUN: amdllpc -o - -filetype=asm %s | FileCheck -check-prefix=CHECK %s

[Version]
version = 65

[VsGlsl]
#version 450
layout(push_constant, std430) uniform PushConstants
{
    float texWidth;
    float texHeight;
} pushc;

layout(location = 0) in vec2 inPosition;
layout(location = 1) in vec2 inTexCoord;
layout(location = 0) out vec2 fragTexCoord;
void main() {
    gl_Position = vec4(inPosition, 0.0, 1.0);
    fragTexCoord = vec2(inTexCoord.x, inTexCoord.y);
}

[VsInfo]
entryPoint = main

[FsGlsl]
#version 450
layout(set = 0, binding = 0) uniform sampler2D texSampler;
layout(location = 0) in vec2 fragTexCoord;
layout(location = 0) out vec4 outColor;
void main() {
    outColor = texture(texSampler, fragTexCoord);
}

[FsInfo]
entryPoint = main

[ResourceMapping]
userDataNode[0].visibility = 64
userDataNode[0].type = DescriptorTableVaPtr
userDataNode[0].offsetInDwords = 0
userDataNode[0].sizeInDwords = 1
userDataNode[0].next[0].type = DescriptorCombinedTexture
userDataNode[0].next[0].offsetInDwords = 0
userDataNode[0].next[0].sizeInDwords = 12
userDataNode[0].next[0].set = 0x00000000
userDataNode[0].next[0].binding = 0
userDataNode[0].next[0].strideInDwords = 0
userDataNode[1].visibility = 66
userDataNode[1].type = PushConst
userDataNode[1].offsetInDwords = 1
userDataNode[1].sizeInDwords = 2
userDataNode[1].set = 0xFFFFFFFF
userDataNode[1].binding = 0
userDataNode[1].strideInDwords = 0
userDataNode[2].visibility = 4
userDataNode[2].type = StreamOutTableVaPtr
userDataNode[2].offsetInDwords = 3
userDataNode[2].sizeInDwords = 1
userDataNode[3].visibility = 2
userDataNode[3].type = IndirectUserDataVaPtr
userDataNode[3].offsetInDwords = 4
userDataNode[3].sizeInDwords = 1
userDataNode[3].indirectUserDataCount = 4

[GraphicsPipelineState]
topology = VK_PRIMITIVE_TOPOLOGY_TRIANGLE_LIST
colorBuffer[0].format = VK_FORMAT_A8_UNORM_KHR
colorBuffer[0].channelWriteMask = 15
colorBuffer[0].blendEnable = 0
colorBuffer[0].blendSrcAlphaToColor = 0

[VertexInputState]
binding[0].binding = 0
binding[0].stride = 16
binding[0].inputRate = VK_VERTEX_INPUT_RATE_VERTEX
attribute[0].location = 0
attribute[0].binding = 0
attribute[0].format = VK_FORMAT_R32G32_SFLOAT
attribute[0].offset = 0
attribute[1].location = 1
attribute[1].binding = 0
attribute[1].format = VK_FORMAT_R32G32_SFLOAT
attribute[1].offset = 8

; CHECK-LABEL: amdgpu_vs_main:
; CHECK:         s_getpc_b64 s[4:5]
; CHECK-NEXT:    s_mov_b32 s0, s1
; CHECK-NEXT:    s_mov_b32 s1, s5
; CHECK-NEXT:    v_add_nc_u32_e32 v0, s2, v0
; CHECK-NEXT:    s_load_dwordx4 s[4:7], s[0:1], 0x0
; CHECK-NEXT:    v_mov_b32_e32 v4, 1.0
; CHECK-NEXT:    v_mov_b32_e32 v5, 0
; CHECK-NEXT:    s_waitcnt lgkmcnt(0)
; CHECK-NEXT:    tbuffer_load_format_xyzw v[0:3], v0, s[4:7], 0 format:[BUF_FMT_32_32_32_32_FLOAT] idxen
; CHECK-NEXT:    s_waitcnt vmcnt(0)
; CHECK-NEXT:    exp pos0 v0, v1, v5, v4 done
; CHECK-NEXT:    exp param0 v2, v3, off, off
; CHECK-NEXT:    s_endpgm
;
; CHECK-LABEL: amdgpu_ps_main:
; CHECK:         s_mov_b64 s[12:13], exec
; CHECK-NEXT:    s_wqm_b64 exec, exec
; CHECK-NEXT:    s_mov_b32 s8, s1
; CHECK-NEXT:    s_getpc_b64 s[0:1]
; CHECK-NEXT:    s_mov_b32 m0, s2
; CHECK-NEXT:    s_mov_b32 s9, s1
; CHECK-NEXT:    s_clause 0x1
; CHECK-NEXT:    s_load_dwordx8 s[0:7], s[8:9], 0x0
; CHECK-NEXT:    s_load_dwordx4 s[8:11], s[8:9], 0x20
; CHECK-NEXT:    v_interp_p1_f32_e32 v2, v0, attr0.x
; CHECK-NEXT:    v_interp_p1_f32_e32 v3, v0, attr0.y
; CHECK-NEXT:    v_interp_p2_f32_e32 v2, v1, attr0.x
; CHECK-NEXT:    v_interp_p2_f32_e32 v3, v1, attr0.y
; CHECK-NEXT:    s_and_b64 exec, exec, s[12:13]
; CHECK-NEXT:    s_waitcnt lgkmcnt(0)
; CHECK-NEXT:    s_and_b32 s12, s3, 0xfffffff
; CHECK-NEXT:    s_cmp_lt_i32 s3, 0
; CHECK-NEXT:    s_cselect_b32 s3, s3, s12
; CHECK-NEXT:    image_sample v[0:3], v[2:3], s[0:7], s[8:11] dmask:0xf dim:SQ_RSRC_IMG_2D
; CHECK-NEXT:    s_waitcnt vmcnt(0)
; CHECK-NEXT:    v_cvt_pkrtz_f16_f32_e32 v0, v0, v1
; CHECK-NEXT:    v_cvt_pkrtz_f16_f32_e32 v1, v2, v3
; CHECK-NEXT:    exp mrt0 v0, v0, v1, v1 done compr vm
; CHECK-NEXT:    s_endpgm
;
; CHECK-LABEL: .amdgpu_pal_metadata
; CHECK-NEXT: ---
; CHECK-NEXT: amdpal.pipelines:
; CHECK-NEXT:   - .api:            Vulkan
; CHECK-NEXT:     .graphics_registers:
; CHECK-NEXT:       .aa_coverage_to_shader_select: InputCoverage
; CHECK-NEXT:       .cb_shader_mask:
; CHECK-NEXT:         .output0_enable: 0xf
; CHECK-NEXT:         .output1_enable: 0
; CHECK-NEXT:         .output2_enable: 0
; CHECK-NEXT:         .output3_enable: 0
; CHECK-NEXT:         .output4_enable: 0
; CHECK-NEXT:         .output5_enable: 0
; CHECK-NEXT:         .output6_enable: 0
; CHECK-NEXT:         .output7_enable: 0
; CHECK-NEXT:       .db_shader_control:
; CHECK-NEXT:         .alpha_to_mask_disable: true
; CHECK-NEXT:         .conservative_z_export: 0
; CHECK-NEXT:         .depth_before_shader: 0
; CHECK-NEXT:         .exec_on_hier_fail: false
; CHECK-NEXT:         .exec_on_noop:   false
; CHECK-NEXT:         .kill_enable:    false
; CHECK-NEXT:         .mask_export_enable: false
; CHECK-NEXT:         .pre_shader_depth_coverage_enable: 0
; CHECK-NEXT:         .primitive_ordered_pixel_shader: false
; CHECK-NEXT:         .stencil_test_val_export_enable: 0
; CHECK-NEXT:         .z_export_enable: 0
; CHECK-NEXT:         .z_order:        0x1
; CHECK-NEXT:       .ia_multi_vgt_param:
; CHECK-NEXT:         .primgroup_size: 0x7f
; CHECK-NEXT:       .pa_cl_clip_cntl:
; CHECK-NEXT:         .dx_linear_attr_clip_ena: true
; CHECK-NEXT:         .rasterization_kill: false
; CHECK-NEXT:         .vte_vport_provoke_disable: false
; CHECK-NEXT:       .pa_cl_vte_cntl:
; CHECK-NEXT:         .vtx_w0_fmt:     true
; CHECK-NEXT:         .x_offset_ena:   true
; CHECK-NEXT:         .x_scale_ena:    true
; CHECK-NEXT:         .y_offset_ena:   true
; CHECK-NEXT:         .y_scale_ena:    true
; CHECK-NEXT:         .z_offset_ena:   true
; CHECK-NEXT:         .z_scale_ena:    true
; CHECK-NEXT:       .pa_sc_shader_control:
; CHECK-NEXT:         .wave_break_region_size: 0
; CHECK-NEXT:       .pa_su_vtx_cntl:
; CHECK-NEXT:         .pix_center:     0x1
; CHECK-NEXT:         .quant_mode:     0x5
; CHECK-NEXT:         .round_mode:     0x2
; CHECK-NEXT:       .ps_extra_lds_size: 0
; CHECK-NEXT:       .ps_iter_sample: false
; CHECK-NEXT:       .spi_baryc_cntl:
; CHECK-NEXT:         .front_face_all_bits: true
; CHECK-NEXT:         .pos_float_location: 0
; CHECK-NEXT:       .spi_ps_in_control:
; CHECK-NEXT:         .num_interps:    0x1
; CHECK-NEXT:         .ps_w32_en:      false
; CHECK-NEXT:       .spi_ps_input_addr:
; CHECK-NEXT:         .ancillary_ena:  false
; CHECK-NEXT:         .front_face_ena: false
; CHECK-NEXT:         .line_stipple_tex_ena: false
; CHECK-NEXT:         .linear_center_ena: false
; CHECK-NEXT:         .linear_centroid_ena: false
; CHECK-NEXT:         .linear_sample_ena: false
; CHECK-NEXT:         .persp_center_ena: true
; CHECK-NEXT:         .persp_centroid_ena: false
; CHECK-NEXT:         .persp_pull_model_ena: false
; CHECK-NEXT:         .persp_sample_ena: false
; CHECK-NEXT:         .pos_fixed_pt_ena: false
; CHECK-NEXT:         .pos_w_float_ena: false
; CHECK-NEXT:         .pos_x_float_ena: false
; CHECK-NEXT:         .pos_y_float_ena: false
; CHECK-NEXT:         .pos_z_float_ena: false
; CHECK-NEXT:         .sample_coverage_ena: false
; CHECK-NEXT:       .spi_ps_input_cntl:
; CHECK-NEXT:         - .attr0_valid:    0
; CHECK-NEXT:           .attr1_valid:    0
; CHECK-NEXT:           .flat_shade:     false
; CHECK-NEXT:           .fp16_interp_mode: false
; CHECK-NEXT:           .offset:         0
; CHECK-NEXT:           .prim_attr:      false
; CHECK-NEXT:           .pt_sprite_tex:  false
; CHECK-NEXT:       .spi_ps_input_ena:
; CHECK-NEXT:         .ancillary_ena:  false
; CHECK-NEXT:         .front_face_ena: false
; CHECK-NEXT:         .line_stipple_tex_ena: false
; CHECK-NEXT:         .linear_center_ena: false
; CHECK-NEXT:         .linear_centroid_ena: false
; CHECK-NEXT:         .linear_sample_ena: false
; CHECK-NEXT:         .persp_center_ena: true
; CHECK-NEXT:         .persp_centroid_ena: false
; CHECK-NEXT:         .persp_pull_model_ena: false
; CHECK-NEXT:         .persp_sample_ena: false
; CHECK-NEXT:         .pos_fixed_pt_ena: false
; CHECK-NEXT:         .pos_w_float_ena: false
; CHECK-NEXT:         .pos_x_float_ena: false
; CHECK-NEXT:         .pos_y_float_ena: false
; CHECK-NEXT:         .pos_z_float_ena: false
; CHECK-NEXT:         .sample_coverage_ena: false
; CHECK-NEXT:       .spi_shader_col_format:
; CHECK-NEXT:         .col_0_export_format: 0x4
; CHECK-NEXT:         .col_1_export_format: 0
; CHECK-NEXT:         .col_2_export_format: 0
; CHECK-NEXT:         .col_3_export_format: 0
; CHECK-NEXT:         .col_4_export_format: 0
; CHECK-NEXT:         .col_5_export_format: 0
; CHECK-NEXT:         .col_6_export_format: 0
; CHECK-NEXT:         .col_7_export_format: 0
; CHECK-NEXT:       .spi_shader_pos_format:
; CHECK-NEXT:         - 0x4
; CHECK-NEXT:         - 0
; CHECK-NEXT:         - 0
; CHECK-NEXT:         - 0
; CHECK-NEXT:         - 0
; CHECK-NEXT:       .spi_vs_out_config:
; CHECK-NEXT:         .vs_export_count: 0
; CHECK-NEXT:       .vgt_reuse_off:  false
; CHECK-NEXT:       .vgt_shader_stages_en:
; CHECK-NEXT:         .max_primgroup_in_wave: 0x2
; CHECK-NEXT:         .vs_stage_en:    0
; CHECK-NEXT:         .vs_w32_en:      true
; CHECK-NEXT:       .vgt_strmout_buffer_config:
; CHECK-NEXT:         .stream_0_buffer_en: 0
; CHECK-NEXT:         .stream_1_buffer_en: 0
; CHECK-NEXT:         .stream_2_buffer_en: 0
; CHECK-NEXT:         .stream_3_buffer_en: 0
; CHECK-NEXT:       .vgt_strmout_config:
; CHECK-NEXT:         .streamout_0_en: false
; CHECK-NEXT:         .streamout_1_en: false
; CHECK-NEXT:         .streamout_2_en: false
; CHECK-NEXT:         .streamout_3_en: false
; CHECK-NEXT:       .vs_so_base0_en: false
; CHECK-NEXT:       .vs_so_base1_en: false
; CHECK-NEXT:       .vs_so_base2_en: false
; CHECK-NEXT:       .vs_so_base3_en: false
; CHECK-NEXT:       .vs_streamout_en: false
;
