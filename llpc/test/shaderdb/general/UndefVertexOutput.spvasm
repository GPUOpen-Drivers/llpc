; NOTE: Assertions have been autogenerated by tool/update_llpc_test_checks.py
; RUN: amdllpc -o - -filetype=asm -gfxip 10.1 %s | FileCheck -check-prefixes=CHECK %s

; Make sure that the export channels match the location in the spir-v.
; This is how the PS knows which channel from which to read the value.

               OpCapability Shader
          %1 = OpExtInstImport "GLSL.std.450"
               OpMemoryModel Logical GLSL450
               OpEntryPoint Vertex %2 "main" %3 %gl_Position %5 %6 %7 %9 %11
          %8 = OpString ""
               OpDecorate %3 Location 1
               OpDecorate %3 Binding 0
               OpDecorate %gl_Position Binding 0
               OpDecorate %gl_Position BuiltIn Position
               OpDecorate %5 Location 5
               OpDecorate %5 Binding 0
               OpDecorate %6 Location 7
               OpDecorate %6 Binding 0
               OpDecorate %7 Location 8
               OpDecorate %7 Binding 0
               OpDecorate %9 Location 9
               OpDecorate %9 Component 0
               OpDecorate %9 Binding 0
               OpDecorate %11 Location 9
               OpDecorate %11 Component 1
               OpDecorate %11 Binding 0
       %void = OpTypeVoid
         %10 = OpTypeFunction %void
      %float = OpTypeFloat 32
    %v3float = OpTypeVector %float 3
    %v4float = OpTypeVector %float 4
%_ptr_Input_v4float = OpTypePointer Input %v4float
          %3 = OpVariable %_ptr_Input_v4float Input
%_ptr_Output_v4float = OpTypePointer Output %v4float
%gl_Position = OpVariable %_ptr_Output_v4float Output
%_ptr_Output_v3float = OpTypePointer Output %v3float
%_ptr_Output_float = OpTypePointer Output %float
          %5 = OpVariable %_ptr_Output_v3float Output
          %6 = OpVariable %_ptr_Output_v4float Output
          %7 = OpVariable %_ptr_Output_v4float Output
          %9 = OpVariable %_ptr_Output_float Output
         %11 = OpVariable %_ptr_Output_float Output
         %17 = OpUndef %v3float
         %24 = OpUndef %float
    %float_0 = OpConstant %float 0
    %float_1 = OpConstant %float 1
         %20 = OpConstantComposite %v4float %float_1 %float_0 %float_0 %float_1
         %21 = OpConstantComposite %v4float %float_0 %float_0 %float_1 %float_1
          %2 = OpFunction %void None %10
         %22 = OpLabel
         %23 = OpLoad %v4float %3
               OpStore %gl_Position %23
               OpStore %5 %17
               OpStore %6 %21
               OpStore %7 %20
               OpStore %9 %24
               OpStore %11 %float_0
               OpReturn
               OpFunctionEnd
; CHECK-LABEL: amdgpu_gs_main:
; CHECK:         s_mov_b32 exec_lo, -1
; CHECK-NEXT:    s_bfe_u32 s3, s3, 0x40018
; CHECK-NEXT:    s_bfe_u32 s4, s2, 0x90016
; CHECK-NEXT:    s_bfe_u32 s1, s2, 0x9000c
; CHECK-NEXT:    s_mov_b32 s0, s9
; CHECK-NEXT:    s_cmp_lg_u32 s3, 0
; CHECK-NEXT:    s_barrier
; CHECK-NEXT:    s_cbranch_scc1 .LBB0_2
; CHECK-NEXT:    s_lshl_b32 s2, s4, 12
; CHECK-NEXT:    s_or_b32 m0, s2, s1
; CHECK-NEXT:    s_sendmsg sendmsg(MSG_GS_ALLOC_REQ)
; CHECK-NEXT:  .LBB0_2:
; CHECK-NEXT:    v_mbcnt_lo_u32_b32 v1, -1, 0
; CHECK-NEXT:    v_lshl_or_b32 v1, s3, 5, v1
; CHECK-NEXT:    v_cmp_gt_u32_e32 vcc_lo, s4, v1
; CHECK-NEXT:    s_and_saveexec_b32 s2, vcc_lo
; CHECK-NEXT:    s_cbranch_execz .LBB0_4
; CHECK-NEXT:    exp prim v0, off, off, off done
; CHECK-NEXT:  .LBB0_4:
; CHECK-NEXT:    s_waitcnt expcnt(0)
; CHECK-NEXT:    s_or_b32 exec_lo, exec_lo, s2
; CHECK-NEXT:    v_cmp_gt_u32_e32 vcc_lo, s1, v1
; CHECK-NEXT:    s_and_saveexec_b32 s1, vcc_lo
; CHECK-NEXT:    s_cbranch_execz .LBB0_6
; CHECK-NEXT:    s_getpc_b64 s[2:3]
; CHECK-NEXT:    v_add_nc_u32_e32 v0, s10, v5
; CHECK-NEXT:    s_mov_b32 s1, s3
; CHECK-NEXT:    v_mov_b32_e32 v4, 1.0
; CHECK-NEXT:    s_load_dwordx4 s[0:3], s[0:1], 0x10
; CHECK-NEXT:    v_mov_b32_e32 v5, 0
; CHECK-NEXT:    s_waitcnt lgkmcnt(0)
; CHECK-NEXT:    tbuffer_load_format_xyzw v[0:3], v0, s[0:3], 0 format:[BUF_FMT_32_32_32_32_FLOAT] idxen
; CHECK-NEXT:    s_waitcnt vmcnt(0)
; CHECK-NEXT:    exp pos0 v0, v1, v2, v3 done
; CHECK-NEXT:    exp param7 v5, v5, v4, v4
; CHECK-NEXT:    exp param9 off, v5, off, off
; CHECK-NEXT:    exp param8 v4, v5, v5, v4
; CHECK-NEXT:  .LBB0_6:
; CHECK-NEXT:    s_endpgm
