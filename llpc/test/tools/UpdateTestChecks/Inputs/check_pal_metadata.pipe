; NOTE: Assertions have been autogenerated by tool/update_llpc_test_checks.py UTC_ARGS: --check-pal-metadata
; Test that the layer input is not output when multiview is enabled.
; For GFX10+, dummy generic output is no longer needed
; If multiview is enabled, it will fail to build with relocatable ELF.

; RUN: amdllpc -enable-relocatable-shader-elf -filetype=asm -o - -gfxip=10.3 %s | FileCheck -check-prefix=SHADERTEST %s

;; Copyright (c) 2025 Advanced Micro Devices, Inc. All Rights Reserved. ;;


[Version]
version = 52

[VsGlsl]
#version 450

layout(location = 0) in vec4 _17;

void main()
{
    gl_Position = _17;
}

[VsInfo]
entryPoint = main

[FsGlsl]
#version 450

layout(location = 0) out vec4 _9;

void main()
{
    _9 = vec4(0,0,0,0);
}

[FsInfo]
entryPoint = main

[ResourceMapping]
userDataNode[0].visibility = 1
userDataNode[0].type = IndirectUserDataVaPtr
userDataNode[0].offsetInDwords = 0
userDataNode[0].sizeInDwords = 1
userDataNode[0].indirectUserDataCount = 8

[GraphicsPipelineState]
topology = VK_PRIMITIVE_TOPOLOGY_TRIANGLE_STRIP
enableMultiView = 1
colorBuffer[0].format = VK_FORMAT_R8G8B8A8_UNORM
colorBuffer[0].channelWriteMask = 15
colorBuffer[0].blendEnable = 0
colorBuffer[0].blendSrcAlphaToColor = 1


[VertexInputState]
binding[0].binding = 0
binding[0].stride = 16
binding[0].inputRate = VK_VERTEX_INPUT_RATE_VERTEX
attribute[0].location = 0
attribute[0].binding = 0
attribute[0].format = VK_FORMAT_R32G32B32A32_SFLOAT
attribute[0].offset = 0
; SHADERTEST-LABEL: amdgpu_vs_main:
; SHADERTEST:         s_getpc_b64 s[4:5]
; SHADERTEST-NEXT:    s_mov_b32 s0, s3
; SHADERTEST-NEXT:    s_mov_b32 s3, s5
; SHADERTEST-NEXT:    v_add_nc_u32_e32 v0, s0, v0
; SHADERTEST-NEXT:    s_load_dwordx4 s[4:7], s[2:3], 0x0
; SHADERTEST-NEXT:    v_mov_b32_e32 v4, s1
; SHADERTEST-NEXT:    s_waitcnt lgkmcnt(0)
; SHADERTEST-NEXT:    tbuffer_load_format_xyzw v[0:3], v0, s[4:7], 0 format:[BUF_FMT_32_32_32_32_FLOAT] idxen
; SHADERTEST-NEXT:    s_waitcnt vmcnt(0)
; SHADERTEST-NEXT:    exp pos0 v0, v1, v2, v3
; SHADERTEST-NEXT:    exp pos1 off, off, v4, off done
; SHADERTEST-NEXT:    s_endpgm
;
; SHADERTEST-LABEL: amdgpu_ps_main:
; SHADERTEST:         v_mov_b32_e32 v0, 0
; SHADERTEST-NEXT:    exp mrt0 v0, v0, v0, v0 done compr vm
; SHADERTEST-NEXT:    s_endpgm
;
; SHADERTEST-LABEL: .amdgpu_pal_metadata
; SHADERTEST-NEXT: ---
; SHADERTEST-NEXT: amdpal.pipelines:
; SHADERTEST-NEXT:   - .api:            Vulkan
; SHADERTEST-NEXT:     .graphics_registers:
; SHADERTEST-NEXT:       .aa_coverage_to_shader_select: InputCoverage
; SHADERTEST-NEXT:       .cb_shader_mask:
; SHADERTEST-NEXT:         .output0_enable: 0xf
; SHADERTEST-NEXT:         .output1_enable: 0
; SHADERTEST-NEXT:         .output2_enable: 0
; SHADERTEST-NEXT:         .output3_enable: 0
; SHADERTEST-NEXT:         .output4_enable: 0
; SHADERTEST-NEXT:         .output5_enable: 0
; SHADERTEST-NEXT:         .output6_enable: 0
; SHADERTEST-NEXT:         .output7_enable: 0
; SHADERTEST-NEXT:       .db_shader_control:
; SHADERTEST-NEXT:         .alpha_to_mask_disable: true
; SHADERTEST-NEXT:         .conservative_z_export: 0
; SHADERTEST-NEXT:         .depth_before_shader: 0
; SHADERTEST-NEXT:         .exec_on_hier_fail: false
; SHADERTEST-NEXT:         .exec_on_noop:   false
; SHADERTEST-NEXT:         .kill_enable:    false
; SHADERTEST-NEXT:         .mask_export_enable: false
; SHADERTEST-NEXT:         .pre_shader_depth_coverage_enable: 0
; SHADERTEST-NEXT:         .primitive_ordered_pixel_shader: false
; SHADERTEST-NEXT:         .stencil_test_val_export_enable: 0
; SHADERTEST-NEXT:         .z_export_enable: 0
; SHADERTEST-NEXT:         .z_order:        0x1
; SHADERTEST-NEXT:       .ia_multi_vgt_param:
; SHADERTEST-NEXT:         .primgroup_size: 0x7f
; SHADERTEST-NEXT:       .pa_cl_clip_cntl:
; SHADERTEST-NEXT:         .dx_linear_attr_clip_ena: true
; SHADERTEST-NEXT:         .rasterization_kill: false
; SHADERTEST-NEXT:         .vte_vport_provoke_disable: false
; SHADERTEST-NEXT:       .pa_cl_vs_out_cntl:
; SHADERTEST-NEXT:         .use_vtx_point_size: false
; SHADERTEST-NEXT:         .use_vtx_render_target_indx: true
; SHADERTEST-NEXT:         .use_vtx_viewport_indx: false
; SHADERTEST-NEXT:         .vs_out_misc_side_bus_ena: true
; SHADERTEST-NEXT:         .vs_out_misc_vec_ena: true
; SHADERTEST-NEXT:       .pa_cl_vte_cntl:
; SHADERTEST-NEXT:         .vtx_w0_fmt:     true
; SHADERTEST-NEXT:         .x_offset_ena:   true
; SHADERTEST-NEXT:         .x_scale_ena:    true
; SHADERTEST-NEXT:         .y_offset_ena:   true
; SHADERTEST-NEXT:         .y_scale_ena:    true
; SHADERTEST-NEXT:         .z_offset_ena:   true
; SHADERTEST-NEXT:         .z_scale_ena:    true
; SHADERTEST-NEXT:       .pa_sc_shader_control:
; SHADERTEST-NEXT:         .wave_break_region_size: 0
; SHADERTEST-NEXT:       .pa_su_vtx_cntl:
; SHADERTEST-NEXT:         .pix_center:     0x1
; SHADERTEST-NEXT:         .quant_mode:     0x5
; SHADERTEST-NEXT:         .round_mode:     0x2
; SHADERTEST-NEXT:       .ps_extra_lds_size: 0
; SHADERTEST-NEXT:       .ps_iter_sample: false
; SHADERTEST-NEXT:       .spi_baryc_cntl:
; SHADERTEST-NEXT:         .front_face_all_bits: true
; SHADERTEST-NEXT:         .pos_float_location: 0
; SHADERTEST-NEXT:       .spi_ps_in_control:
; SHADERTEST-NEXT:         .num_interps:    0
; SHADERTEST-NEXT:         .num_prim_interp: 0
; SHADERTEST-NEXT:         .ps_w32_en:      false
; SHADERTEST-NEXT:       .spi_ps_input_addr:
; SHADERTEST-NEXT:         .ancillary_ena:  false
; SHADERTEST-NEXT:         .front_face_ena: false
; SHADERTEST-NEXT:         .line_stipple_tex_ena: false
; SHADERTEST-NEXT:         .linear_center_ena: false
; SHADERTEST-NEXT:         .linear_centroid_ena: false
; SHADERTEST-NEXT:         .linear_sample_ena: false
; SHADERTEST-NEXT:         .persp_center_ena: false
; SHADERTEST-NEXT:         .persp_centroid_ena: false
; SHADERTEST-NEXT:         .persp_pull_model_ena: false
; SHADERTEST-NEXT:         .persp_sample_ena: true
; SHADERTEST-NEXT:         .pos_fixed_pt_ena: false
; SHADERTEST-NEXT:         .pos_w_float_ena: false
; SHADERTEST-NEXT:         .pos_x_float_ena: false
; SHADERTEST-NEXT:         .pos_y_float_ena: false
; SHADERTEST-NEXT:         .pos_z_float_ena: false
; SHADERTEST-NEXT:         .sample_coverage_ena: false
; SHADERTEST-NEXT:       .spi_ps_input_cntl:
; SHADERTEST-NEXT:         - .attr0_valid:    0
; SHADERTEST-NEXT:           .attr1_valid:    0
; SHADERTEST-NEXT:           .flat_shade:     false
; SHADERTEST-NEXT:           .fp16_interp_mode: false
; SHADERTEST-NEXT:           .offset:         0
; SHADERTEST-NEXT:           .prim_attr:      false
; SHADERTEST-NEXT:           .pt_sprite_tex:  false
; SHADERTEST-NEXT:       .spi_ps_input_ena:
; SHADERTEST-NEXT:         .ancillary_ena:  false
; SHADERTEST-NEXT:         .front_face_ena: false
; SHADERTEST-NEXT:         .line_stipple_tex_ena: false
; SHADERTEST-NEXT:         .linear_center_ena: false
; SHADERTEST-NEXT:         .linear_centroid_ena: false
; SHADERTEST-NEXT:         .linear_sample_ena: false
; SHADERTEST-NEXT:         .persp_center_ena: false
; SHADERTEST-NEXT:         .persp_centroid_ena: false
; SHADERTEST-NEXT:         .persp_pull_model_ena: false
; SHADERTEST-NEXT:         .persp_sample_ena: true
; SHADERTEST-NEXT:         .pos_fixed_pt_ena: false
; SHADERTEST-NEXT:         .pos_w_float_ena: false
; SHADERTEST-NEXT:         .pos_x_float_ena: false
; SHADERTEST-NEXT:         .pos_y_float_ena: false
; SHADERTEST-NEXT:         .pos_z_float_ena: false
; SHADERTEST-NEXT:         .sample_coverage_ena: false
; SHADERTEST-NEXT:       .spi_shader_col_format:
; SHADERTEST-NEXT:         .col_0_export_format: 0x4
; SHADERTEST-NEXT:         .col_1_export_format: 0
; SHADERTEST-NEXT:         .col_2_export_format: 0
; SHADERTEST-NEXT:         .col_3_export_format: 0
; SHADERTEST-NEXT:         .col_4_export_format: 0
; SHADERTEST-NEXT:         .col_5_export_format: 0
; SHADERTEST-NEXT:         .col_6_export_format: 0
; SHADERTEST-NEXT:         .col_7_export_format: 0
; SHADERTEST-NEXT:       .spi_shader_pos_format:
; SHADERTEST-NEXT:         - 0x4
; SHADERTEST-NEXT:         - 0x4
; SHADERTEST-NEXT:         - 0
; SHADERTEST-NEXT:         - 0
; SHADERTEST-NEXT:         - 0
; SHADERTEST-NEXT:       .spi_vs_out_config:
; SHADERTEST-NEXT:         .no_pc_export:   true
; SHADERTEST-NEXT:       .vgt_reuse_off:  false
; SHADERTEST-NEXT:       .vgt_shader_stages_en:
; SHADERTEST-NEXT:         .max_primgroup_in_wave: 0x2
; SHADERTEST-NEXT:         .vs_stage_en:    0
; SHADERTEST-NEXT:         .vs_w32_en:      true
; SHADERTEST-NEXT:       .vgt_strmout_buffer_config:
; SHADERTEST-NEXT:         .stream_0_buffer_en: 0
; SHADERTEST-NEXT:         .stream_1_buffer_en: 0
; SHADERTEST-NEXT:         .stream_2_buffer_en: 0
; SHADERTEST-NEXT:         .stream_3_buffer_en: 0
; SHADERTEST-NEXT:       .vgt_strmout_config:
; SHADERTEST-NEXT:         .streamout_0_en: false
; SHADERTEST-NEXT:         .streamout_1_en: false
; SHADERTEST-NEXT:         .streamout_2_en: false
; SHADERTEST-NEXT:         .streamout_3_en: false
; SHADERTEST-NEXT:       .vs_so_base0_en: false
; SHADERTEST-NEXT:       .vs_so_base1_en: false
; SHADERTEST-NEXT:       .vs_so_base2_en: false
; SHADERTEST-NEXT:       .vs_so_base3_en: false
; SHADERTEST-NEXT:       .vs_streamout_en: false
; SHADERTEST-NEXT:     .hardware_stages:
; SHADERTEST-NEXT:       .ps:
; SHADERTEST-NEXT:         .checksum_value: 0xb4d39ea3
; SHADERTEST-NEXT:         .debug_mode:     false
; SHADERTEST-NEXT:         .entry_point:    _amdgpu_ps_main
; SHADERTEST-NEXT:         .float_mode:     0xc0
; SHADERTEST-NEXT:         .ieee_mode:      false
; SHADERTEST-NEXT:         .lds_size:       0
; SHADERTEST-NEXT:         .mem_ordered:    true
; SHADERTEST-NEXT:         .scratch_en:     false
; SHADERTEST-NEXT:         .scratch_memory_size: 0
; SHADERTEST-NEXT:         .sgpr_count:     0x2
; SHADERTEST-NEXT:         .sgpr_limit:     0x6a
; SHADERTEST-NEXT:         .trap_present:   0
; SHADERTEST-NEXT:         .user_data_reg_map:
; SHADERTEST-NEXT:           - 0x10000000
; SHADERTEST-NEXT:           - 0xffffffff
; SHADERTEST-NEXT:           - 0xffffffff
; SHADERTEST-NEXT:           - 0xffffffff
; SHADERTEST-NEXT:           - 0xffffffff
; SHADERTEST-NEXT:           - 0xffffffff
; SHADERTEST-NEXT:           - 0xffffffff
; SHADERTEST-NEXT:           - 0xffffffff
; SHADERTEST-NEXT:           - 0xffffffff
; SHADERTEST-NEXT:           - 0xffffffff
; SHADERTEST-NEXT:           - 0xffffffff
; SHADERTEST-NEXT:           - 0xffffffff
; SHADERTEST-NEXT:           - 0xffffffff
; SHADERTEST-NEXT:           - 0xffffffff
; SHADERTEST-NEXT:           - 0xffffffff
; SHADERTEST-NEXT:           - 0xffffffff
; SHADERTEST-NEXT:           - 0xffffffff
; SHADERTEST-NEXT:           - 0xffffffff
; SHADERTEST-NEXT:           - 0xffffffff
; SHADERTEST-NEXT:           - 0xffffffff
; SHADERTEST-NEXT:           - 0xffffffff
; SHADERTEST-NEXT:           - 0xffffffff
; SHADERTEST-NEXT:           - 0xffffffff
; SHADERTEST-NEXT:           - 0xffffffff
; SHADERTEST-NEXT:           - 0xffffffff
; SHADERTEST-NEXT:           - 0xffffffff
; SHADERTEST-NEXT:           - 0xffffffff
; SHADERTEST-NEXT:           - 0xffffffff
; SHADERTEST-NEXT:           - 0xffffffff
; SHADERTEST-NEXT:           - 0xffffffff
; SHADERTEST-NEXT:           - 0xffffffff
; SHADERTEST-NEXT:           - 0xffffffff
; SHADERTEST-NEXT:         .user_sgprs:     0x1
; SHADERTEST-NEXT:         .uses_uavs:      false
; SHADERTEST-NEXT:         .vgpr_count:     0x2
; SHADERTEST-NEXT:         .vgpr_limit:     0x100
; SHADERTEST-NEXT:         .wavefront_size: 0x40
; SHADERTEST-NEXT:         .wgp_mode:       false
; SHADERTEST-NEXT:         .writes_depth:   0
; SHADERTEST-NEXT:         .writes_uavs:    false
; SHADERTEST-NEXT:       .vs:
; SHADERTEST-NEXT:         .checksum_value: 0xcd42e2e5
; SHADERTEST-NEXT:         .debug_mode:     false
; SHADERTEST-NEXT:         .entry_point:    _amdgpu_vs_main
; SHADERTEST-NEXT:         .float_mode:     0xc0
; SHADERTEST-NEXT:         .ieee_mode:      false
; SHADERTEST-NEXT:         .lds_size:       0
; SHADERTEST-NEXT:         .mem_ordered:    true
; SHADERTEST-NEXT:         .scratch_en:     false
; SHADERTEST-NEXT:         .scratch_memory_size: 0
; SHADERTEST-NEXT:         .sgpr_count:     0x8
; SHADERTEST-NEXT:         .sgpr_limit:     0x6a
; SHADERTEST-NEXT:         .trap_present:   0
; SHADERTEST-NEXT:         .user_data_reg_map:
; SHADERTEST-NEXT:           - 0x10000000
; SHADERTEST-NEXT:           - 0x1000000b
; SHADERTEST-NEXT:           - 0x1000000f
; SHADERTEST-NEXT:           - 0x10000003
; SHADERTEST-NEXT:           - 0x10000004
; SHADERTEST-NEXT:           - 0xffffffff
; SHADERTEST-NEXT:           - 0xffffffff
; SHADERTEST-NEXT:           - 0xffffffff
; SHADERTEST-NEXT:           - 0xffffffff
; SHADERTEST-NEXT:           - 0xffffffff
; SHADERTEST-NEXT:           - 0xffffffff
; SHADERTEST-NEXT:           - 0xffffffff
; SHADERTEST-NEXT:           - 0xffffffff
; SHADERTEST-NEXT:           - 0xffffffff
; SHADERTEST-NEXT:           - 0xffffffff
; SHADERTEST-NEXT:           - 0xffffffff
; SHADERTEST-NEXT:           - 0xffffffff
; SHADERTEST-NEXT:           - 0xffffffff
; SHADERTEST-NEXT:           - 0xffffffff
; SHADERTEST-NEXT:           - 0xffffffff
; SHADERTEST-NEXT:           - 0xffffffff
; SHADERTEST-NEXT:           - 0xffffffff
; SHADERTEST-NEXT:           - 0xffffffff
; SHADERTEST-NEXT:           - 0xffffffff
; SHADERTEST-NEXT:           - 0xffffffff
; SHADERTEST-NEXT:           - 0xffffffff
; SHADERTEST-NEXT:           - 0xffffffff
; SHADERTEST-NEXT:           - 0xffffffff
; SHADERTEST-NEXT:           - 0xffffffff
; SHADERTEST-NEXT:           - 0xffffffff
; SHADERTEST-NEXT:           - 0xffffffff
; SHADERTEST-NEXT:           - 0xffffffff
; SHADERTEST-NEXT:         .user_sgprs:     0x5
; SHADERTEST-NEXT:         .vgpr_count:     0x5
; SHADERTEST-NEXT:         .vgpr_limit:     0x100
; SHADERTEST-NEXT:         .wavefront_size: 0x20
; SHADERTEST-NEXT:         .wgp_mode:       false
; SHADERTEST-NEXT:     .internal_pipeline_hash:
; SHADERTEST-NEXT:       - 0x{{[0-9a-f]+}}
; SHADERTEST-NEXT:       - 0x{{[0-9a-f]+}}
; SHADERTEST-NEXT:     .num_interpolants: 0x1
; SHADERTEST-NEXT:     .registers:      {}
; SHADERTEST-NEXT:     .shaders:
; SHADERTEST-NEXT:       .pixel:
; SHADERTEST-NEXT:         .api_shader_hash:
; SHADERTEST-NEXT:           - 0x{{[0-9a-f]+}}
; SHADERTEST-NEXT:           - 0
; SHADERTEST-NEXT:         .hardware_mapping:
; SHADERTEST-NEXT:           - .ps
; SHADERTEST-NEXT:       .vertex:
; SHADERTEST-NEXT:         .api_shader_hash:
; SHADERTEST-NEXT:           - 0x{{[0-9a-f]+}}
; SHADERTEST-NEXT:           - 0
; SHADERTEST-NEXT:         .hardware_mapping:
; SHADERTEST-NEXT:           - .vs
; SHADERTEST-NEXT:     .spill_threshold: 0xffff
; SHADERTEST-NEXT:     .streamout_vertex_strides:
; SHADERTEST-NEXT:       - 0
; SHADERTEST-NEXT:       - 0
; SHADERTEST-NEXT:       - 0
; SHADERTEST-NEXT:       - 0
; SHADERTEST-NEXT:     .type:           VsPs
; SHADERTEST-NEXT:     .user_data_limit: 0x1
; SHADERTEST-NEXT:     .xgl_cache_info:
; SHADERTEST-NEXT:       .128_bit_cache_hash:
; SHADERTEST-NEXT:         - 0x{{[0-9a-f]+}}
; SHADERTEST-NEXT:         - 0x{{[0-9a-f]+}}
; SHADERTEST-NEXT:       .llpc_version: {{.*}}
; SHADERTEST-NEXT: amdpal.version:
; SHADERTEST-NEXT:   - 0x3
; SHADERTEST-NEXT:   - 0
; SHADERTEST-NEXT: ...
